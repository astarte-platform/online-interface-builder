(this["webpackJsonpastarte-dashboard"]=this["webpackJsonpastarte-dashboard"]||[]).push([[0],{1425:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(53),c=n.n(i),s=(n(650),n(22)),o=n(99),l=n(265),d=n(190),u=n(68),j=n(2),h=n(6),b=n(1445),p=n(1431),m=n(263),f=n.n(m),O=n(613),g=n.n(O),v=function(e,t){Object(a.useEffect)((function(){if(null==t)return function(){return null};var n=setInterval(e,t);return function(){return clearInterval(n)}}),[e,t])};f.a.extend(g.a);var x=function(e){var t=Object(a.useState)(f()(e).fromNow()),n=Object(h.a)(t,2),r=n[0],i=n[1],c=Object(a.useCallback)((function(){i(f()(e).fromNow())}),[e]);return v(c,1e3),r},y=n(0),k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timeout,n=Object(a.useRef)([]),r=Object(a.useState)([]),i=Object(h.a)(r,2),c=i[0],s=i[1];Object(a.useEffect)((function(){var e=n.current;return function(){return e.forEach(clearTimeout)}}),[]);var o=Object(a.useCallback)((function(e){s((function(t){var n=t.length,a=t.filter((function(t){return t.id!==e.id}));return n>a.length&&e.options.onClose&&e.options.onClose(),a}))}),[s]),l=Object(a.useCallback)((function(){c.forEach(o)}),[c,o]),d=Object(a.useCallback)((function(e,t){var a={id:Object(b.a)(),message:e,options:Object(j.a)({},t),timestamp:Date.now(),close:function(){return o(a)}};if(a.options.timeout){var r=window.setTimeout((function(){o(a),n.current.splice(n.current.indexOf(r),1)}),a.options.timeout);n.current.push(r)}return s((function(e){return e.concat(a)})),a.options.onOpen&&a.options.onOpen(),a}),[o,s]),u=Object(a.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object(j.a)(Object(j.a)({},n),{},{variant:"success",timeout:t||0});return d(e,a)}),[d]),p=Object(a.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object(j.a)(Object(j.a)({},n),{},{variant:"warning",timeout:t||0});return d(e,a)}),[d]),m=Object(a.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object(j.a)(Object(j.a)({},n),{},{variant:"danger",timeout:t||0});return d(e,a)}),[d]),f=Object(a.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object(j.a)(Object(j.a)({},n),{},{variant:"info",timeout:t||0});return d(e,a)}),[d]);return{alerts:c,close:o,closeAll:l,showSuccess:u,showWarning:p,showError:m,showInfo:f}},C=Object(a.createContext)(null),w=Object(a.createContext)([]),N=function(e){var t=e.alert,n=x(t.timestamp);return Object(y.jsx)(o.a,{xs:12,children:Object(y.jsxs)(p.a,{variant:t.options.variant,onClose:t.close,dismissible:!0,className:"d-flex justify-content-between flex-wrap",children:[t.message,Object(y.jsx)("div",{className:"col text-right",children:n})]})})},I=function(e){var t=e.alerts;return Object(y.jsx)(d.a,{children:t.map((function(e){return Object(y.jsx)(N,{alert:e},e.id)}))})},_=function(){var e=k();return Object(j.a)(Object(j.a)({},e),{},{Alerts:function(){return Object(y.jsx)(I,{alerts:e.alerts})}})},S=function(e){var t=e.children,n=Object(u.a)(e,["children"]),r=Object(a.useRef)(null),i=k({timeout:5e3}),c=i.alerts,s=i.close,o=i.closeAll,l=i.showSuccess,d=i.showWarning,h=i.showError,b=i.showInfo;return r.current={close:s,closeAll:o,showSuccess:l,showWarning:d,showError:h,showInfo:b},Object(y.jsx)(C.Provider,Object(j.a)(Object(j.a)({value:r},n),{},{children:Object(y.jsx)(w.Provider,Object(j.a)(Object(j.a)({value:c},n),{},{children:t}))}))},A=Object(a.createContext)(null),R=function(){return Object(a.useContext)(A)},T=function(e){var t=e.children,n=e.config,r=Object(u.a)(e,["children","config"]),i=Object(a.useMemo)((function(){return{auth:{methods:n.auth,defaultMethod:n.defaultAuth||"token",defaultRealm:n.defaultRealm},features:{flow:!!n.enableFlowPreview}}}),[n]);return Object(y.jsx)(A.Provider,Object(j.a)(Object(j.a)({value:i},r),{},{children:t}))},D=n(1440),M=n(266),P=n(1433),q=n(264),E=n(1438),L=n(30),U=n(624),F=n(43),G=n(5),H=n.n(G),$=n(33),V=n(20),B=n(26),z=n(11),K=n(157),J=n.n(K),W=n(614),Z=n(3),Y=n.n(Z),Q=function(){function e(t){Object(V.a)(this,e),this.name=void 0,this.source=void 0,this.type=void 0,this.schema=void 0,this.name=t.name,this.source=t.source,this.type=t.type,this.schema=t.schema}return Object(B.a)(e,null,[{key:"fromObject",value:function(t){return new e(t)}}]),e}(),X=function(){function e(t){Object(V.a)(this,e),this.name=void 0,this.type=void 0,this.schema=void 0,this.beamModule=void 0,this.name=t.name,this.type=t.type,this.schema=t.schema,this.beamModule=t.beam_module}return Object(B.a)(e,null,[{key:"fromObject",value:function(t){return new e(t)}}]),e}(),ee=function(e){return"beam_module"in e?X.fromObject(e):Q.fromObject(e)},te=function(e){return RegExp("^[a-z][a-z0-9]{0,47}$").test(e)&&!e.startsWith("astarte")&&!e.startsWith("system")},ne=n(385),ae=n(615),re=n.n(ae),ie=n(7),ce=Object(ne.a)(/^(JOIN|WATCH|\.\*)::(.+)$/,{action:1,resource:2}),se=Object(ne.a)(/^(DELETE|GET|PATCH|POST|PUT|\.\*)::(.+)$/,{action:1,resource:2}),oe=function(e,t){var n=e.exec(t).groups,a=n.action,r=n.resource;return{action:new RegExp(a),resource:new RegExp(r)}},le=ie.g({exp:ie.f().integer().min(0).notRequired(),iat:ie.f().integer().min(0).notRequired(),iss:ie.h().notRequired(),a_aea:ie.a(ie.h().required().matches(se)),a_ch:ie.a(ie.h().required().matches(ce)),a_f:ie.a(ie.h().required().matches(se)),a_hka:ie.a(ie.h().required().matches(se)),a_pa:ie.a(ie.h().required().matches(se)),a_rma:ie.a(ie.h().required().matches(se))}).required(),de=function(){function e(t){Object(V.a)(this,e),this.$claims=void 0,this.$expirationDate=void 0,this.$issueDate=void 0,this.$issuer=void 0;var n=re.a.decode(t,{complete:!0,ignoreExpiration:!0}),a=le.validateSync(n&&n.payload);this.$expirationDate=a.exp?new Date(1e3*a.exp):null,this.$issueDate=a.iat?new Date(1e3*a.iat):null,this.$issuer=a.iss||null,this.$claims={appEngine:(a.a_aea||[]).map((function(e){return oe(se,e)})),channels:(a.a_ch||[]).map((function(e){return oe(ce,e)})),flow:(a.a_f||[]).map((function(e){return oe(se,e)})),houseKeeping:(a.a_hka||[]).map((function(e){return oe(se,e)})),pairing:(a.a_pa||[]).map((function(e){return oe(se,e)})),realmManagement:(a.a_rma||[]).map((function(e){return oe(se,e)}))}}return Object(B.a)(e,[{key:"can",value:function(e,t,n){return this.$claims[e].some((function(e){return e.action.test(t)&&e.resource.test(n)}))}},{key:"hasAstarteClaims",get:function(){return Object.values(this.$claims).some((function(e){return e.length>0}))}},{key:"isExpired",get:function(){return null!=this.$expirationDate&&this.$expirationDate<=new Date}},{key:"isValid",get:function(){return!this.isExpired&&this.hasAstarteClaims}}],[{key:"validate",value:function(t){try{var n=new e(t);return n.isValid?"valid":n.isExpired?"expired":n.hasAstarteClaims?"invalid":"noAstarteClaims"}catch(a){return"invalid"}}}]),e}(),ue=function(e,t){return function(n){return Y.a.isMap(n)&&Array.from(n.entries()).every((function(n){var a=Object(h.a)(n,2),r=a[0],i=a[1];return e.isValidSync(r)&&t.isValidSync(i)}))}},je=ie.g({name:ie.h().required(),major:ie.f().integer().min(0).required(),minor:ie.f().integer().min(0).required().when("major",{is:0,then:ie.f().integer().min(1).required(),otherwise:ie.f().integer().min(0).required()}),exchangedMessages:ie.f().integer().min(0).required(),exchangedBytes:ie.f().integer().min(0).required()}).required(),he=ie.g({id:ie.h().required(),aliases:ie.e().required().test("aliases-values","${path} must be a Map of string -> string",ue(ie.h().required(),ie.h().required())),metadata:ie.e().required().test("metadata-values","${path} must be a Map of string -> string",ue(ie.h().required(),ie.h().required())),isConnected:ie.b().required(),introspection:ie.e().required().test("introspection-values","${path} must be a Map of string -> interface stats object",ue(ie.h().required(),je)),totalReceivedMessages:ie.f().integer().min(0).required(),totalReceivedBytes:ie.f().integer().min(0).required(),hasCredentialsInhibited:ie.b().required(),groups:ie.a().of(ie.h().required()).defined(),previousInterfaces:ie.a().of(je).defined(),firstRegistration:ie.c().notRequired(),firstCredentialsRequest:ie.c().notRequired(),lastDisconnection:ie.c().notRequired(),lastConnection:ie.c().notRequired(),lastSeenIp:ie.h().notRequired(),lastCredentialsRequestIp:ie.h().notRequired()}).required(),be=function(){function e(t){Object(V.a)(this,e),this.id=void 0,this.aliases=void 0,this.metadata=void 0,this.isConnected=void 0,this.introspection=void 0,this.totalReceivedMessages=void 0,this.totalReceivedBytes=void 0,this.hasCredentialsInhibited=void 0,this.groups=void 0,this.previousInterfaces=void 0,this.firstRegistration=void 0,this.firstCredentialsRequest=void 0,this.lastDisconnection=void 0,this.lastConnection=void 0,this.lastSeenIp=void 0,this.lastCredentialsRequestIp=void 0;var n=he.validateSync(t);this.id=n.id,this.aliases=n.aliases,this.metadata=n.metadata,this.isConnected=n.isConnected,this.introspection=n.introspection,this.totalReceivedMessages=n.totalReceivedMessages,this.totalReceivedBytes=n.totalReceivedBytes,this.hasCredentialsInhibited=n.hasCredentialsInhibited,this.groups=n.groups,this.previousInterfaces=n.previousInterfaces,this.firstRegistration=n.firstRegistration,this.firstCredentialsRequest=n.firstCredentialsRequest,this.lastDisconnection=n.lastDisconnection,this.lastConnection=n.lastConnection,this.lastSeenIp=n.lastSeenIp,this.lastCredentialsRequestIp=n.lastCredentialsRequestIp}return Object(B.a)(e,[{key:"hasNameAlias",get:function(){return this.aliases.has("name")}},{key:"name",get:function(){return this.hasNameAlias?this.aliases.get("name"):this.id}},{key:"connectionStatus",get:function(){return null==this.lastConnection?"never_connected":this.isConnected?"connected":"disconnected"}}]),e}(),pe=function(){function e(t){Object(V.a)(this,e),this.name=void 0,this.pipeline=void 0,this.config=void 0,this.name=t.name,this.pipeline=t.pipeline,null!=t.config&&(this.config=t.config)}return Object(B.a)(e,null,[{key:"fromObject",value:function(t){return new e(t)}}]),e}(),me=function(e){var t,n=Y.a.isString(e);return n||(t="Pipeline name must be a string"),{isValid:n,error:t,warning:undefined}},fe=function(e){var t,n=Y.a.isString(e);return n||(t="Pipeline description must be a string"),{isValid:n,error:t,warning:undefined}},Oe=function(e){var t,n=Y.a.isPlainObject(e);return n||(t="Pipeline schema must be a string"),{isValid:n,error:t,warning:undefined}},ge=function(e){var t,n=Y.a.isString(e);return n||(t="Pipeline source must be a string"),{isValid:n,error:t,warning:undefined}},ve=function(e){var t={isValid:!0,errors:[],warnings:[],properties:{}};return t.properties.name=me(e.name),t.properties.description=fe(e.description),t.properties.schema=Oe(e.schema),t.properties.source=ge(e.source),Object.values(t.properties).forEach((function(e){e.isValid||(t.isValid=!1),e.error&&t.errors.push(e.error),e.warning&&t.warnings.push(e.warning)})),t.isValid||0!==t.errors.length||t.errors.push("Pipeline is not valid"),t},xe=me,ye=fe,ke=Oe,Ce=ge,we=function e(t){Object(V.a)(this,e),this.name=void 0,this.description=void 0,this.schema=void 0,this.source=void 0;var n=ve(t);if(!n.isValid)throw new Error(n.errors.join("\n"));this.name=t.name,this.description=t.description,this.schema=t.schema,this.source=t.source};we.validatePipeline=ve,we.validatePipelineName=xe,we.validatePipelineDescription=ye,we.validatePipelineSchema=ke,we.validatePipelineSource=Ce;var Ne=function(e){return new De({endpoint:e.endpoint,type:e.type,reliability:e.reliability,retention:e.retention,expiry:e.expiry,databaseRetentionPolicy:e.database_retention_policy,databaseRetentionTtl:e.database_retention_ttl,allowUnset:e.allow_unset,explicitTimestamp:e.explicit_timestamp,description:e.description,documentation:e.doc})},Ie=function(e){return{endpoint:e.endpoint,type:e.type,reliability:e.reliability,retention:e.retention,expiry:e.expiry,database_retention_policy:e.databaseRetentionPolicy,database_retention_ttl:e.databaseRetentionTtl,allow_unset:e.allowUnset,explicit_timestamp:e.explicitTimestamp,description:e.description,doc:e.documentation}},_e=/^(\/(%{([a-zA-Z][a-zA-Z0-9_]*)}|[a-zA-Z][a-zA-Z0-9_]*)){1,64}$/,Se=/^%{([a-zA-Z][a-zA-Z0-9_]*)}$/,Ae=ie.g({endpoint:ie.h().required().matches(_e,"Interface endpoint must be a UNIX-like path (e.g. /my/path), with optional parameters in the %{name} form"),type:ie.h().required().oneOf(["string","boolean","double","integer","longinteger","binaryblob","datetime","doublearray","integerarray","booleanarray","longintegerarray","stringarray","binaryblobarray","datetimearray"]),reliability:ie.h().oneOf(["unreliable","guaranteed","unique"]).notRequired(),retention:ie.h().oneOf(["discard","volatile","stored"]).notRequired(),expiry:ie.f().integer().min(0).notRequired(),databaseRetentionPolicy:ie.h().oneOf(["no_ttl","use_ttl"]).notRequired(),databaseRetentionTtl:ie.f().integer().min(60).lessThan(63072e4).notRequired(),allowUnset:ie.b().notRequired(),explicitTimestamp:ie.b().notRequired(),description:ie.h().max(1e3).notRequired(),documentation:ie.h().max(1e5).notRequired()}).required(),Re=function(e){return null!=e&&Se.test(e)},Te=function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return n===a||Re(n)||Re(a)},De=function(){function e(t){Object(V.a)(this,e),this.endpoint=void 0,this.type=void 0,this.reliability=void 0,this.retention=void 0,this.expiry=void 0,this.databaseRetentionPolicy=void 0,this.databaseRetentionTtl=void 0,this.allowUnset=void 0,this.explicitTimestamp=void 0,this.description=void 0,this.documentation=void 0;var n=e.validation.validateSync(t,{abortEarly:!1});this.endpoint=n.endpoint,this.type=n.type,this.reliability=n.reliability,this.retention=n.retention,this.expiry=n.expiry,this.databaseRetentionPolicy=n.databaseRetentionPolicy,this.databaseRetentionTtl=n.databaseRetentionTtl,this.allowUnset=n.allowUnset,this.explicitTimestamp=n.explicitTimestamp,this.description=n.description,this.documentation=n.documentation}return Object(B.a)(e,null,[{key:"matchEndpoint",value:function(e,t){return Y.a.zip(e.split("/"),t.split("/")).every(Te)}},{key:"fromJSON",value:function(e){return Ne(e)}},{key:"toJSON",value:function(e){return Ie(e)}}]),e}();De.validation=Ae;var Me=function(e){return new Ge({name:e.interface_name,major:e.version_major,minor:e.version_minor,type:e.type,ownership:e.ownership,aggregation:"datastream"===e.type?e.aggregation:void 0,description:e.description,documentation:e.doc,mappings:(e.mappings||[]).map((function(e){return Ne(e)}))})},Pe=function(e){return function(e){var t=Y.a.cloneDeep(e);return"datastream"===t.type&&"individual"===t.aggregation&&delete t.aggregation,"datastream"===t.type&&(t.mappings=t.mappings.map((function(e){var t=Y.a.cloneDeep(e);return!1===t.explicit_timestamp&&delete t.explicit_timestamp,"unreliable"===t.reliability&&delete t.reliability,"discard"===t.retention&&delete t.retention,"no_ttl"===t.database_retention_policy&&delete t.database_retention_policy,t.retention&&0!==t.expiry||delete t.expiry,t.database_retention_policy||delete t.database_retention_ttl,t}))),"properties"===t.type&&(t.mappings=t.mappings.map((function(e){var t=Y.a.cloneDeep(e);return!1===t.allow_unset&&delete t.allow_unset,t}))),t}("datastream"===e.type?{interface_name:e.name,version_major:e.major,version_minor:e.minor,type:e.type,ownership:e.ownership,aggregation:e.aggregation||"individual",description:e.description,doc:e.documentation,mappings:(e.mappings||[]).map((function(e){return Ie(Object(j.a)(Object(j.a)({},e),{},{explicitTimestamp:e.explicitTimestamp||!1,reliability:e.reliability||"unreliable",retention:e.retention||"discard",expiry:e.expiry||0,databaseRetentionPolicy:e.databaseRetentionPolicy||"no_ttl"}))}))}:{interface_name:e.name,version_major:e.major,version_minor:e.minor,type:e.type,ownership:e.ownership,description:e.description,doc:e.documentation,mappings:(e.mappings||[]).map((function(e){return Ie(Object(j.a)(Object(j.a)({},e),{},{allowUnset:e.allowUnset||!1}))}))})},qe=/^([a-zA-Z][a-zA-Z0-9]*\.([a-zA-Z0-9][a-zA-Z0-9-]*\.)*)?[a-zA-Z][a-zA-Z0-9]*$/,Ee=/%{[a-zA-Z]+[a-zA-Z0-9_]*}/,Le=function(e){return Y.a.isString(e)?e.split("/").slice(0,-1).join("/"):""},Ue=ie.a(De.validation).max(1024).defined().test("unique-mappings","Mappings cannot have conflicting endpoints",(function(e){if(null==e||0===e.length)return!0;var t=e.map((function(e){return e.endpoint})),n=new RegExp(Ee,"g"),a=t.map((function(e){return e.toLowerCase().replace(n,"")}));return Y.a.uniq(a).length===t.length})),Fe=ie.g({name:ie.h().required().max(128).matches(qe,"Interface name has to be an unique, alphanumeric reverse internet domain name, not longer than 128 characters"),major:ie.f().integer().min(0).required(),minor:ie.f().integer().min(0).required().when("major",{is:0,then:ie.f().integer().min(1).required()}),type:ie.h().oneOf(["properties","datastream"]).required(),ownership:ie.h().oneOf(["device","server"]).required(),aggregation:ie.h().oneOf(["individual","object"]).when("type",{is:"datastream",then:ie.h().oneOf(["individual","object"]).notRequired(),otherwise:ie.h().strip(!0)}),description:ie.h().max(1e3).notRequired(),documentation:ie.h().max(1e5).notRequired(),mappings:Ue.when(["type","aggregation"],{is:function(e,t){return"datastream"===e&&"object"===t},then:Ue.test("same-prefix-mappings","Mapping endpoints in Object aggregate interfaces must have the same prefix",(function(e){if(null==e||0===e.length)return!0;var t=e.map((function(e){return e.endpoint})).map(Le);return t.every((function(e){return e===t[0]}))})).test("same-attributes-mappings","Mapping endpoints in Object aggregate interfaces must have the same attributes for retention, reliability, expiry, allowUnset, explicitTimestamp",(function(e){return null==e||0===e.length||e.every((function(t){return t.retention===e[0].retention&&t.reliability===e[0].reliability&&t.expiry===e[0].expiry&&t.allowUnset===e[0].allowUnset&&t.explicitTimestamp===e[0].explicitTimestamp}))}))})}).required(),Ge=function(){function e(t){Object(V.a)(this,e),this.name=void 0,this.major=void 0,this.minor=void 0,this.type=void 0,this.ownership=void 0,this.aggregation=void 0,this.description=void 0,this.documentation=void 0,this.mappings=void 0;var n=e.validation.validateSync(t,{abortEarly:!1});this.name=n.name,this.major=n.major,this.minor=n.minor,this.type=n.type,this.ownership=n.ownership,"datastream"===n.type&&(this.aggregation=n.aggregation||"individual"),this.description=n.description,this.documentation=n.documentation,this.mappings=n.mappings.map((function(e){return"datastream"===n.type?new De(Object(j.a)(Object(j.a)({},e),{},{explicitTimestamp:e.explicitTimestamp||!1,reliability:e.reliability||"unreliable",retention:e.retention||"discard",expiry:e.expiry||0,databaseRetentionPolicy:e.databaseRetentionPolicy||"no_ttl"})):new De(Object(j.a)(Object(j.a)({},e),{},{allowUnset:e.allowUnset||!1}))}))}return Object(B.a)(e,null,[{key:"findEndpointMapping",value:function(e,t){return e.mappings.find((function(e){return De.matchEndpoint(e.endpoint,t)}))||null}},{key:"fromJSON",value:function(e){return Me(e)}},{key:"toJSON",value:function(e){return Pe(e)}}]),e}();Ge.validation=Fe;var He=function(e){var t;if("http_url"in e.action&&null!=e.action.http_url){var n=e.action;t={httpUrl:n.http_url,httpMethod:n.http_method,httpStaticHeaders:n.http_static_headers,ignoreSslErrors:n.ignore_ssl_errors,templateType:n.template_type,template:n.template}}else{var a=e.action;t={amqpExchange:a.amqp_exchange,amqpRoutingKey:a.amqp_routing_key,amqpStaticHeaders:a.amqp_static_headers,amqpMessageExpirationMilliseconds:a.amqp_message_expiration_ms,amqpMessagePriority:a.amqp_message_priority,amqpMessagePersistent:a.amqp_message_persistent}}return new Xe({name:e.name,action:t,simpleTriggers:e.simple_triggers.map((function(e){return"device_trigger"===e.type?{type:e.type,on:e.on,deviceId:e.device_id,groupName:e.group_name}:{type:e.type,on:e.on,deviceId:e.device_id,groupName:e.group_name,interfaceName:e.interface_name,interfaceMajor:e.interface_major,matchPath:e.match_path,valueMatchOperator:e.value_match_operator,knownValue:e.known_value}}))})},$e=function(e){var t;if("httpUrl"in e.action&&null!=e.action.httpUrl){var n=e.action;t={http_url:n.httpUrl,http_method:n.httpMethod,http_static_headers:n.httpStaticHeaders,ignore_ssl_errors:n.ignoreSslErrors,template_type:n.templateType,template:n.template}}else{var a=e.action;t={amqp_exchange:a.amqpExchange,amqp_routing_key:a.amqpRoutingKey,amqp_static_headers:a.amqpStaticHeaders,amqp_message_expiration_ms:a.amqpMessageExpirationMilliseconds,amqp_message_priority:a.amqpMessagePriority,amqp_message_persistent:a.amqpMessagePersistent}}return{name:e.name,action:t,simple_triggers:e.simpleTriggers.map((function(e){return"device_trigger"===e.type?{type:e.type,on:e.on,device_id:e.deviceId,group_name:e.groupName}:{type:e.type,on:e.on,device_id:e.deviceId,group_name:e.groupName,interface_name:e.interfaceName,interface_major:e.interfaceMajor,match_path:e.matchPath,value_match_operator:e.valueMatchOperator,known_value:e.knownValue}}))}},Ve=["connection","content-length","date","host","te","upgrade","x-forwarded-for","x-forwarded-host","x-forwarded-proto","sec-websocket-accept","proxy-authorization","proxy-authenticate"],Be=function(e,t){return function(n){return!!Y.a.isUndefined(n)||Y.a.isObject(n)&&Y.a.isPlainObject(n)&&Object.entries(n).every((function(n){var a=Object(h.a)(n,2),r=a[0],i=a[1];return e.isValidSync(r)&&t.isValidSync(i)}))}},ze=ie.g({httpUrl:ie.h().min("http://a".length).max(8192).required(),httpMethod:ie.h().oneOf(["delete","get","head","options","patch","post","put"]).required(),httpStaticHeaders:ie.e().test("http-static-headers","${path} must be an Object of string -> string",Be(ie.h().required().test("reserved-http-headers","${path} cannot be a reserved HTTP header",(function(e){return!Ve.includes((e||"").toLowerCase())})),ie.h())).notRequired(),ignoreSslErrors:ie.b().notRequired(),templateType:ie.h().oneOf(["mustache"]).notRequired(),template:ie.h().when("templateType",{is:"mustache",then:ie.h().max(1048576).required(),otherwise:ie.h().strip(!0)})}).required(),Ke=ie.g({amqpExchange:ie.h().max(255).required().when("$realm",(function(e){return ie.h().matches(function(e){return e?new RegExp("^astarte_events_".concat(e,"_[a-zA-Z0-9_\\.\\:]+$")):/^astarte_events_[a-zA-Z0-9]+_[a-zA-Z0-9_.:]+$/}(e),"${path} must have astarte_events_".concat(e||"<realm-name>","_<any-allowed-string> format"))})),amqpRoutingKey:ie.h().matches(/^[^{}]+$/,"${path} must not contain { and }").notRequired(),amqpStaticHeaders:ie.e().test("amqp-static-headers","${path} must be an Object of string -> string",Be(ie.h().required(),ie.h())).notRequired(),amqpMessageExpirationMilliseconds:ie.f().integer().positive().required(),amqpMessagePriority:ie.f().integer().min(0).max(9).notRequired(),amqpMessagePersistent:ie.b().required()}).required(),Je=ie.d((function(e){return"httpUrl"in e?ze:Ke})),We=ie.g({type:ie.h().oneOf(["device_trigger"]).required(),on:ie.h().oneOf(["device_disconnected","device_connected","device_error","device_empty_cache_received"]).required(),deviceId:ie.h().notRequired(),groupName:ie.h().notRequired().when("deviceId",(function(e,t){return null!=e?t.strip(!0):t}))}).required(),Ze=ie.g({type:ie.h().oneOf(["data_trigger"]).required(),on:ie.h().oneOf(["incoming_data","value_change","value_change_applied","path_created","path_removed","value_stored"]).required(),deviceId:ie.h().notRequired(),groupName:ie.h().notRequired().when("deviceId",(function(e,t){return null!=e?t.strip(!0):t})),interfaceName:ie.h().test("interface-name","${path} must be either * or a valid interface name",(function(e){return null!=e&&("*"===e||qe.test(e))})).required(),interfaceMajor:ie.f().integer().min(0).notRequired(),matchPath:ie.h().test("match-path","${path} must be either /* or a valid interface mapping path",(function(e){return null!=e&&("/*"===e||_e.test(e))})).when("on",(function(e,t){return t.test("match-path-limit-for-value-changed","${path} cannot be /* for value_change or value_change_applied triggers",(function(t){return"/*"!==t||!["value_change","value_change_applied"].includes(e)}))})).required().when(["$interface","on","valueMatchOperator"],(function(e,t,n,a){return null==e?a:a.test("match-path-of-interface","${path} must be either /* or a valid mapping path for interface ".concat(e.name," v").concat(e.major,".").concat(e.minor),(function(t){return!!t&&("/*"===t||e.mappings.some((function(e){return De.matchEndpoint(e.endpoint,t)})))})).test("match-path-limit-for-datastream-object-interfaces","only incoming_data triggers with /* path and * operator are supported for datastream object interfaces",(function(a){return"object"!==e.aggregation||"incoming_data"===t&&"*"===n&&"/*"===a}))})),valueMatchOperator:ie.h().oneOf(["*","==","!=",">",">=","<","<=","contains","not_contains"]).required(),knownValue:ie.e().when(["matchPath","valueMatchOperator","$interface"],(function(e,t,n){if(!n||!e)return ie.e().strip(!0);var a=n.mappings.find((function(t){return De.matchEndpoint(t.endpoint,e)})),r=a?a.type:null,i=ie.h();return r?["boolean","booleanarray"].includes(r)?i=ie.b():["double","doublearray"].includes(r)?i=ie.f():["integer","integerarray"].includes(r)&&(i=ie.f().integer()):i=ie.h(),"*"===t?i.strip(!0):i.required()}))}).required(),Ye=ie.d((function(e){return"device_trigger"===Y.a.get(e,"type")?We:Ze})),Qe=ie.g({name:ie.h().required(),action:Je,simpleTriggers:ie.a(Ye).required()}).required(),Xe=function(){function e(t){Object(V.a)(this,e),this.name=void 0,this.action=void 0,this.simpleTriggers=void 0;var n=e.validation.validateSync(t,{abortEarly:!1});this.name=n.name,this.action=n.action,this.simpleTriggers=n.simpleTriggers}return Object(B.a)(e,null,[{key:"fromJSON",value:function(e){return He(e)}},{key:"toJSON",value:function(e){return $e(e)}}]),e}();Xe.validation=Qe;var et=function(e,t){var n=Ge.findEndpointMapping(e,t);if(null==n)throw new Error("Could not find an interface mapping for the endpoint ".concat(t));return n.type},tt=function(e){return!Y.a.isUndefined(e)&&(!Y.a.isPlainObject(e)||Y.a.isNull(e))},nt=function(e){return tt(Y.a.get(e,"value"))},at=function(e){return"properties"===e.type?"properties":"object"===e.aggregation?"datastream_object":"datastream_individual"},rt=function(){function e(t){var n=t.interface,a=t.data,r=t.endpoint,i=void 0===r?"":r,c=t.parentNode,s=void 0===c?null:c;if(Object(V.a)(this,e),this.dataKind=void 0,this.endpoint=void 0,this.parent=void 0,this.data=void 0,this.linearizedData=void 0,this.endpoint=i,this.parent=s,this.dataKind=at(n),this.data=a,"properties"===n.type)this.linearizedData=a;else if("datastream"===n.type&&"individual"===n.aggregation){var o=a;this.linearizedData=o.map((function(e){return Object(j.a)({endpoint:e.endpoint,timestamp:e.timestamp},{type:e.type,value:e.value})}))}else{var l=a;this.linearizedData=l.map((function(e){return Object.entries(e.value).map((function(t){var n=Object(h.a)(t,2),a=n[0],r=n[1];return Object(j.a)({endpoint:"".concat(e.endpoint,"/").concat(a),timestamp:e.timestamp},r)}))})).flat()}}return Object(B.a)(e,[{key:"getParentNode",value:function(){return this.parent}},{key:"getNode",value:function(e){return e.replace(/\/$/,"")===this.endpoint?this:null}},{key:"getLeaves",value:function(){return[this]}},{key:"toData",value:function(){return Y.a.isArray(this.data)?this.data:[this.data]}},{key:"toLinearizedData",value:function(){return Y.a.isArray(this.linearizedData)?this.linearizedData:[this.linearizedData]}},{key:"toLastValue",value:function(){if("properties"===this.dataKind)return this.data.value;if("datastream_individual"===this.dataKind){var e=this.data,t=Y.a.last(Y.a.orderBy(e,["timestamp"],["asc"]));return t?t.value:null}var n=this.data,a=Y.a.last(Y.a.orderBy(n,["timestamp"],["asc"]));return a?Y.a.mapValues(a.value,(function(e){return e.value})):null}},{key:"name",get:function(){return null!=this.parent?this.endpoint.replace("".concat(this.parent.endpoint,"/"),""):""}}]),e}(),it=function(){function e(t){var n=this,a=t.interface,r=t.data,i=t.endpoint,c=void 0===i?"":i,s=t.parentNode,o=void 0===s?null:s;Object(V.a)(this,e),this.dataKind=void 0,this.endpoint=void 0,this.parent=void 0,this.children=void 0,this.endpoint=c,this.parent=o,this.dataKind=at(a),"properties"===a.type?this.children=Object.entries(r).map((function(e){var t=Object(h.a)(e,2),r=t[0],i=t[1];return st({interface:a,data:i,endpoint:"".concat(c,"/").concat(r),parentNode:n})})):"datastream"===a.type&&"individual"===a.aggregation?this.children=Object.entries(r).map((function(e){var t=Object(h.a)(e,2),r=t[0],i=t[1];return ot({interface:a,data:i,endpoint:"".concat(c,"/").concat(r),parentNode:n})})):this.children=Object.entries(r).map((function(e){var t=Object(h.a)(e,2),r=t[0],i=t[1];return lt({interface:a,data:i,endpoint:"".concat(c,"/").concat(r),parentNode:n})}))}return Object(B.a)(e,[{key:"getParentNode",value:function(){return this.parent}},{key:"getNode",value:function(e){var t=e.replace(/\/$/,"");if(t===this.endpoint)return this;if(0===this.children.length)return null;var n=null;return this.children.forEach((function(e){var a=e.getNode(t);null!=a&&(n=a)})),n}},{key:"getLeaves",value:function(){return this.children.map((function(e){return e.getLeaves()})).flat()}},{key:"toData",value:function(){return this.getLeaves().map((function(e){return e.toData()})).flat()}},{key:"toLinearizedData",value:function(){return this.getLeaves().map((function(e){return e.toLinearizedData()})).flat()}},{key:"toLastValue",value:function(){return this.children.reduce((function(e,t){return Object(j.a)(Object(j.a)({},e),{},Object(F.a)({},t.name,t.toLastValue()))}),{})}},{key:"name",get:function(){return null!=this.parent?this.endpoint.replace("".concat(this.parent.endpoint,"/"),""):""}}]),e}();function ct(e){return"properties"===e.interface.type?st({interface:e.interface,data:e.data,endpoint:e.endpoint||"",parentNode:null}):"datastream"===e.interface.type&&"individual"===e.interface.aggregation?ot({interface:e.interface,data:e.data,endpoint:e.endpoint||"",parentNode:null}):lt({interface:e.interface,data:e.data,endpoint:e.endpoint||"",parentNode:null})}function st(e){return t=e.data,tt(t)?new rt({interface:e.interface,data:Object(j.a)({endpoint:e.endpoint},{value:e.data,type:et(e.interface,e.endpoint)}),endpoint:e.endpoint,parentNode:e.parentNode}):new it({interface:e.interface,data:e.data,endpoint:e.endpoint,parentNode:e.parentNode});var t}function ot(e){if(n=e.data,Y.a.isArray(n)&&n.every(nt)){var t=e.data.map((function(t){return Object(j.a)({endpoint:e.endpoint,timestamp:t.timestamp},{value:t.value,type:et(e.interface,e.endpoint)})}));return new rt({interface:e.interface,data:t,endpoint:e.endpoint,parentNode:e.parentNode})}var n;if(nt(e.data)){var a=[Object(j.a)({endpoint:e.endpoint,timestamp:e.data.timestamp},{value:e.data.value,type:et(e.interface,e.endpoint)})];return new rt({interface:e.interface,data:a,endpoint:e.endpoint,parentNode:e.parentNode})}return new it({interface:e.interface,data:e.data,endpoint:e.endpoint,parentNode:e.parentNode})}function lt(e){if(n=e.data,Array.isArray(n)){var t=e.data.map((function(t){return{endpoint:e.endpoint,timestamp:t.timestamp,value:Object.entries(Y.a.omit(t,"timestamp")).reduce((function(t,n){var a=Object(h.a)(n,2),r=a[0],i=a[1];return Object(j.a)(Object(j.a)({},t),{},Object(F.a)({},r,{value:i,type:et(e.interface,"".concat(e.endpoint,"/").concat(r))}))}),{})}}));return new rt({interface:e.interface,data:t,endpoint:e.endpoint,parentNode:e.parentNode})}var n;return new it({interface:e.interface,data:e.data,endpoint:e.endpoint,parentNode:e.parentNode})}var dt=function(e){return{name:e.name,major:e.major,minor:e.minor,exchangedMessages:e.exchanged_msgs,exchangedBytes:e.exchanged_bytes}},ut=function(e){return new be({id:e.id,isConnected:!!e.connected,hasCredentialsInhibited:!!e.credentials_inhibited,aliases:new Map(Object.entries(e.aliases||{})),groups:e.groups||[],introspection:new Map(Object.entries(e.introspection||{}).map((function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return[n,dt(Object(j.a)({name:n},a))]}))),metadata:new Map(Object.entries(e.metadata||{})),totalReceivedMessages:e.total_received_msgs||0,totalReceivedBytes:e.total_received_bytes||0,previousInterfaces:(e.previous_interfaces||[]).map(dt),firstRegistration:null!=e.first_registration?new Date(e.first_registration):void 0,firstCredentialsRequest:null!=e.first_credentials_request?new Date(e.first_credentials_request):void 0,lastDisconnection:null!=e.last_disconnection?new Date(e.last_disconnection):void 0,lastConnection:null!=e.last_connection?new Date(e.last_connection):void 0,lastSeenIp:null!=e.last_seen_ip?e.last_seen_ip:void 0,lastCredentialsRequestIp:null!=e.last_credentials_request_ip?e.last_credentials_request_ip:void 0})},jt=[n(619),n(620),n(621),n(622),n(623)],ht=function e(t){if(Object(V.a)(this,e),this.deviceId=void 0,this.timestamp=void 0,!t||!Y.a.isPlainObject(t))throw new Error("Invalid argument");if(!t.device_id||"string"!==typeof t.device_id)throw new Error("Invalid device id");if(!t.timestamp)throw new Error("Missing event timestamp");var n=new Date(t.timestamp);if(!t.timestamp||Number.isNaN(n.getTime()))throw new Error("Invalid timestamp");this.deviceId=t.device_id,this.timestamp=n},bt=n(49),pt=n(56),mt=function(e){Object(bt.a)(n,e);var t=Object(pt.a)(n);function n(e){var a;if(Object(V.a)(this,n),(a=t.call(this,e)).ip=void 0,!e.event||!Y.a.isPlainObject(e.event)||"device_connected"!==e.event.type)throw new Error("Invalid event");if("string"!==typeof e.event.device_ip_address)throw new Error("Invalid device ip address");return a.ip=e.event.device_ip_address,a}return Object(B.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(ht),ft=function(e){Object(bt.a)(n,e);var t=Object(pt.a)(n);function n(e){var a;if(Object(V.a)(this,n),a=t.call(this,e),!e.event||!Y.a.isPlainObject(e.event)||"device_disconnected"!==e.event.type)throw new Error("Invalid event");return a}return Object(B.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(ht);var Ot,gt,vt,xt,yt,kt,Ct,wt,Nt,It,_t,St,At,Rt,Tt,Dt,Mt,Pt,qt,Et,Lt,Ut,Ft,Gt,Ht,$t,Vt,Bt=function(e){Object(bt.a)(n,e);var t=Object(pt.a)(n);function n(e){var a;if(Object(V.a)(this,n),(a=t.call(this,e)).errorName=void 0,a.metadata=void 0,!e.event||!Y.a.isPlainObject(e.event)||"device_error"!==e.event.type)throw new Error("Invalid event");if("string"!==typeof e.event.error_name&&!function(e){switch(e){case"write_on_server_owned_interface":case"invalid_interface":case"invalid_path":case"mapping_not_found":case"interface_loading_failed":case"ambiguous_path":case"undecodable_bson_payload":case"unexpected_value_type":case"value_size_exceeded":case"unexpected_object_key":case"invalid_introspection":case"unexpected_control_message":case"device_session_not_found":case"resend_interface_properties_failed":case"empty_cache_error":return!0;default:return!1}}(e.event.error_name))throw new Error("Invalid device error");return a.errorName=e.event.error_name,a.metadata=e.event.metadata,a}return Object(B.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(ht),zt=function(e){Object(bt.a)(n,e);var t=Object(pt.a)(n);function n(e){var a;if(Object(V.a)(this,n),(a=t.call(this,e)).interfaceName=void 0,a.path=void 0,a.value=void 0,!e.event||!Y.a.isPlainObject(e.event)||"incoming_data"!==e.event.type)throw new Error("Invalid event");if("string"!==typeof e.event.interface)throw new Error("Invalid interface");if("string"!==typeof e.event.path)throw new Error("Invalid path");if(null==e.event.value)throw new Error("Invalid sent value");return a.interfaceName=e.event.interface,a.path=e.event.path,a.value=e.event.value,a}return Object(B.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(ht),Kt=function(e){Object(bt.a)(n,e);var t=Object(pt.a)(n);function n(e){var a;if(Object(V.a)(this,n),(a=t.call(this,e)).interfaceName=void 0,a.path=void 0,!e.event||!Y.a.isPlainObject(e.event)||"incoming_data"!==e.event.type||null!==e.event.value)throw new Error("Invalid event");if("string"!==typeof e.event.interface)throw new Error("Invalid interface");if("string"!==typeof e.event.path)throw new Error("Invalid path");if(e.event.value)throw new Error("Invalid sent value");return a.interfaceName=e.event.interface,a.path=e.event.path,a}return Object(B.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(ht);function Jt(e,t,n){return Wt.apply(this,arguments)}function Wt(){return(Wt=Object(z.a)(H.a.mark((function e(t,n,a){var r,i,c;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.socketUrl,i=t.realm,c=t.token,e.abrupt("return",new Promise((function(e){var t=new W.Socket(r,{params:{realm:i,token:c}});t.onError((function(e){return n(e)})),t.onClose((function(e){return a(e)})),t.onOpen((function(){e(t)})),t.connect()})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zt(e,t){return Yt.apply(this,arguments)}function Yt(){return(Yt=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){var r=t.channel(n,{});r.join().receive("ok",(function(){e(r)})).receive("error",(function(e){a(e)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qt(e){return Xt.apply(this,arguments)}function Xt(){return(Xt=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.leave().receive("ok",(function(){e()})).receive("error",(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function en(e,t){return tn.apply(this,arguments)}function tn(){return(tn=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){t.push("watch",n).receive("ok",(function(){e()})).receive("error",(function(e){a(e)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nn(e,t){for(var n=arguments.length,a=new Array(n>2?n-2:0),r=2;r<n;r++)a[r-2]=arguments[r];return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var c=r[r.length-1]||{},s=[e[1]];return a.forEach((function(t,n){var a=Number.isInteger(t)?r[t]:c[t];s.push(a,e[n+2])})),new URL(s.join(""),t)}}var an=function(){function e(t){Object(V.a)(this,e),this.config=void 0,this.apiConfig=void 0,this.joinedChannels=void 0,this.listeners=void 0,this.onSocketClose=void 0,this.onSocketError=void 0,this.phoenixSocket=void 0,this.token=void 0,this.config={realm:t.realm||""},this.token=t.token||"",this.onSocketClose=t.onSocketClose,this.onSocketError=t.onSocketError,this.phoenixSocket=null,this.joinedChannels={},this.listeners={},this.getConfigAuth=this.getConfigAuth.bind(this),this.getBlocks=this.getBlocks.bind(this),this.getDeviceData=this.getDeviceData.bind(this),this.getDevicesStats=this.getDevicesStats.bind(this),this.getInterface=this.getInterface.bind(this),this.getInterfaceMajors=this.getInterfaceMajors.bind(this),this.getInterfaceNames=this.getInterfaceNames.bind(this),this.getTriggerNames=this.getTriggerNames.bind(this),this.getTrigger=this.getTrigger.bind(this),this.deleteTrigger=this.deleteTrigger.bind(this),this.getAppengineHealth=this.getAppengineHealth.bind(this),this.getRealmManagementHealth=this.getRealmManagementHealth.bind(this),this.getPairingHealth=this.getPairingHealth.bind(this),this.getFlowHealth=this.getFlowHealth.bind(this),this.getPipeline=this.getPipeline.bind(this),this.getPipelines=this.getPipelines.bind(this),this.apiConfig={realmManagementHealth:nn(Ot||(Ot=Object($.a)(["","health"])),t.realmManagementApiUrl),auth:nn(gt||(gt=Object($.a)(["","v1/","/config/auth"])),t.realmManagementApiUrl,"realm"),interfaces:nn(vt||(vt=Object($.a)(["","v1/","/interfaces"])),t.realmManagementApiUrl,"realm"),interfaceMajors:nn(xt||(xt=Object($.a)(["","v1/","/interfaces/",""])),t.realmManagementApiUrl,"realm","interfaceName"),interface:nn(yt||(yt=Object($.a)(["","v1/","/interfaces/","/",""])),t.realmManagementApiUrl,"realm","interfaceName","interfaceMajor"),interfaceData:nn(kt||(kt=Object($.a)(["","v1/","/interfaces/","/",""])),t.realmManagementApiUrl,"realm","interfaceName","interfaceMajor"),trigger:nn(Ct||(Ct=Object($.a)(["","v1/","/triggers/",""])),t.realmManagementApiUrl,"realm","triggerName"),triggers:nn(wt||(wt=Object($.a)(["","v1/","/triggers"])),t.realmManagementApiUrl,"realm"),appengineHealth:nn(Nt||(Nt=Object($.a)(["","health"])),t.appEngineApiUrl),devicesStats:nn(It||(It=Object($.a)(["","v1/","/stats/devices"])),t.appEngineApiUrl,"realm"),devices:nn(_t||(_t=Object($.a)(["","v1/","/devices"])),t.appEngineApiUrl,"realm"),deviceInfo:nn(St||(St=Object($.a)(["","v1/","/devices/",""])),t.appEngineApiUrl,"realm","deviceId"),deviceData:nn(At||(At=Object($.a)(["","v1/","/devices/","/interfaces/","","?keep_milliseconds=true&since=","&since_after=","&to=","&limit=",""])),t.appEngineApiUrl,"realm","deviceId","interfaceName","path","since","sinceAfter","to","limit"),groups:nn(Rt||(Rt=Object($.a)(["","v1/","/groups"])),t.appEngineApiUrl,"realm"),groupDevices:nn(Tt||(Tt=Object($.a)(["","v1/","/groups/","/devices"])),t.appEngineApiUrl,"realm","groupName"),deviceInGroup:nn(Dt||(Dt=Object($.a)(["","v1/","/groups/","/devices/",""])),t.appEngineApiUrl,"realm","groupName","deviceId"),phoenixSocket:nn(Mt||(Mt=Object($.a)(["","v1/socket"])),t.appEngineApiUrl),pairingHealth:nn(Pt||(Pt=Object($.a)(["","health"])),t.pairingApiUrl),registerDevice:nn(qt||(qt=Object($.a)(["","v1/","/agent/devices"])),t.pairingApiUrl,"realm"),deviceAgent:nn(Et||(Et=Object($.a)(["","v1/","/agent/devices/",""])),t.pairingApiUrl,"realm","deviceId"),flowHealth:nn(Lt||(Lt=Object($.a)(["","health"])),t.flowApiUrl),flows:nn(Ut||(Ut=Object($.a)(["","v1/","/flows"])),t.flowApiUrl,"realm"),flowInstance:nn(Ft||(Ft=Object($.a)(["","v1/","/flows/",""])),t.flowApiUrl,"realm","instanceName"),pipelines:nn(Gt||(Gt=Object($.a)(["","v1/","/pipelines"])),t.flowApiUrl,"realm"),pipelineSource:nn(Ht||(Ht=Object($.a)(["","v1/","/pipelines/",""])),t.flowApiUrl,"realm","pipelineId"),blocks:nn($t||($t=Object($.a)(["","v1/","/blocks"])),t.flowApiUrl,"realm"),blockSource:nn(Vt||(Vt=Object($.a)(["","v1/","/blocks/",""])),t.flowApiUrl,"realm","blockId")}}return Object(B.a)(e,[{key:"addListener",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeListener",value:function(e,t){var n=this.listeners[e];n&&(this.listeners[e]=n.filter((function(e){return e!==t})))}},{key:"dispatch",value:function(e){var t=this.listeners[e];t&&t.forEach((function(e){return e()}))}},{key:"setCredentials",value:function(e){this.config.realm=Y.a.get(e,"realm")||"",this.token=Y.a.get(e,"token")||""}},{key:"getConfigAuth",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.auth(this.config));case 2:return t=e.sent,e.abrupt("return",{publicKey:t.data.jwt_public_key_pem});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateConfigAuth",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$put(this.apiConfig.auth(this.config),{jwt_public_key_pem:t.publicKey});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getInterfaceNames",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.interfaces(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInterfaceMajors",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.interfaceMajors(Object(j.a)(Object(j.a)({},this.config),{},{interfaceName:t})));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getInterface",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.interfaceName,a=t.interfaceMajor,e.next=3,this.$get(this.apiConfig.interfaceData(Object(j.a)({interfaceName:n,interfaceMajor:a},this.config)));case 3:return r=e.sent,e.abrupt("return",Me(r.data));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"installInterface",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post(this.apiConfig.interfaces(this.config),Pe(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateInterface",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$put(this.apiConfig.interface(Object(j.a)({interfaceName:t.name,interfaceMajor:t.major},this.config)),Pe(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteInterface",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$delete(this.apiConfig.interface(Object(j.a)(Object(j.a)({},this.config),{},{interfaceName:t,interfaceMajor:n})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTriggerNames",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.triggers(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTrigger",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.trigger(Object(j.a)(Object(j.a)({},this.config),{},{triggerName:t})));case 2:return n=e.sent,e.abrupt("return",He(n.data));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTrigger",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$delete(this.apiConfig.trigger(Object(j.a)(Object(j.a)({},this.config),{},{triggerName:t})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"installTrigger",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post(this.apiConfig.triggers(this.config),$e(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDevicesStats",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.devicesStats(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDevices",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r,i,c;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new URL(this.apiConfig.devices(this.config)),a={},t.details&&(a.details=!0),t.limit&&(a.limit=t.limit),t.from&&(a.from_token=t.from),n.search=new URLSearchParams(a).toString(),e.next=8,this.$get(n.toString());case 8:return r=e.sent,i=r.data.map((function(e){return ut(e)})),c=new URLSearchParams(r.links.next).get("from_token"),e.abrupt("return",{devices:i,nextToken:c});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDeviceInfo",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.deviceInfo(Object(j.a)({deviceId:t},this.config)));case 2:return n=e.sent,e.abrupt("return",ut(n.data));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"insertDeviceAlias",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n,a){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$patch(this.apiConfig.deviceInfo(Object(j.a)({deviceId:t},this.config)),{aliases:Object(F.a)({},n,a)});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"deleteDeviceAlias",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$patch(this.apiConfig.deviceInfo(Object(j.a)({deviceId:t},this.config)),{aliases:Object(F.a)({},n,null)});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"insertDeviceMetadata",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n,a){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$patch(this.apiConfig.deviceInfo(Object(j.a)({deviceId:t},this.config)),{metadata:Object(F.a)({},n,a)});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"deleteDeviceMetadata",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$patch(this.apiConfig.deviceInfo(Object(j.a)({deviceId:t},this.config)),{metadata:Object(F.a)({},n,null)});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"inhibitDeviceCredentialsRequests",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$patch(this.apiConfig.deviceInfo(Object(j.a)({deviceId:t},this.config)),{credentials_inhibited:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDeviceData",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.deviceData(Object(j.a)(Object(j.a)({},t),this.config)));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDeviceDataTree",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r,i;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("interface"in t)){e.next=4;break}n=t.interface,e.next=13;break;case 4:return e.next=6,this.getDeviceInfo(t.deviceId);case 6:if(a=e.sent,r=a.introspection.get(t.interfaceName)){e.next=10;break}throw new Error("Could not find interface ".concat(t.interfaceName," in device introspection"));case 10:return e.next=12,this.getInterface({interfaceName:t.interfaceName,interfaceMajor:r.major});case 12:n=e.sent;case 13:return e.next=15,this.getDeviceData({deviceId:t.deviceId,interfaceName:n.name,path:t.path,since:t.since,sinceAfter:t.sinceAfter,to:t.to,limit:t.limit});case 15:return i=e.sent,e.abrupt("return",ct({interface:n,data:i,endpoint:t.path}));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupList",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.groups(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.groupName,a=t.deviceIds,e.next=3,this.$post(this.apiConfig.groups(this.config),{group_name:n,devices:a});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDevicesInGroup",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r,i,c;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.groupName,a=t.details,n){e.next=3;break}throw new Error("Invalid group name");case 3:return r=encodeURIComponent(encodeURIComponent(n)),i=new URL(this.apiConfig.groupDevices(Object(j.a)(Object(j.a)({},this.config),{},{groupName:r}))),a&&(i.search=new URLSearchParams({details:"true"}).toString()),e.next=8,this.$get(i.toString());case 8:return c=e.sent,e.abrupt("return",c.data.map((function(e){return ut(e)})));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addDeviceToGroup",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.groupName,a=t.deviceId,n){e.next=3;break}throw new Error("Invalid group name");case 3:if(a){e.next=5;break}throw new Error("Invalid device ID");case 5:return r=encodeURIComponent(encodeURIComponent(n)),e.next=8,this.$post(this.apiConfig.groupDevices(Object(j.a)(Object(j.a)({},this.config),{},{groupName:r})),{device_id:a});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeDeviceFromGroup",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.groupName,a=t.deviceId,n){e.next=3;break}throw new Error("Invalid group name");case 3:if(a){e.next=5;break}throw new Error("Invalid device ID");case 5:return r=encodeURIComponent(encodeURIComponent(n)),e.next=8,this.$delete(this.apiConfig.deviceInGroup(Object(j.a)(Object(j.a)({},this.config),{},{groupName:r,deviceId:a})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"registerDevice",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r,i,c;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.deviceId,a=t.introspection,r={hw_id:n},a&&(i=Y.a.mapValues(a,(function(e){return Y.a.pick(e,["minor","major"])})),r.initial_introspection=i),e.next=5,this.$post(this.apiConfig.registerDevice(this.config),r);case 5:return c=e.sent,e.abrupt("return",{credentialsSecret:c.data.credentials_secret});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"wipeDeviceCredentials",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$delete(this.apiConfig.deviceAgent(Object(j.a)({deviceId:t},this.config)));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFlowInstances",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.flows(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFlowDetails",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.flowInstance(Object(j.a)(Object(j.a)({},this.config),{},{instanceName:t})));case 2:return n=e.sent,e.abrupt("return",pe.fromObject(n.data));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createNewFlowInstance",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post(this.apiConfig.flows(this.config),t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteFlowInstance",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$delete(this.apiConfig.flowInstance(Object(j.a)(Object(j.a)({},this.config),{},{instanceName:t})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPipelineNames",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.pipelines(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPipelines",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPipelineNames();case 2:return t=e.sent,e.next=5,Promise.all(t.map(this.getPipeline));case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPipeline",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.pipelineSource(Object(j.a)(Object(j.a)({},this.config),{},{pipelineId:t})));case 2:return n=e.sent,e.abrupt("return",new we({name:(a=n.data).name,description:a.description,schema:a.schema||{},source:a.source}));case 4:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPipelineSource",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.pipelineSource(Object(j.a)(Object(j.a)({},this.config),{},{pipelineId:t})));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"registerPipeline",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$post(this.apiConfig.pipelines(this.config),{name:(n=t).name,description:n.description,schema:Y.a.isEmpty(n.schema)?void 0:n.schema,source:n.source});case 2:case"end":return e.stop()}var n}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deletePipeline",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$delete(this.apiConfig.pipelineSource(Object(j.a)(Object(j.a)({},this.config),{},{pipelineId:t})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBlocks",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t,n,a,r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=jt,e.next=3,this.$get(this.apiConfig.blocks(this.config));case 3:return n=e.sent,a=n.data,r=Y.a.uniqBy(a.concat(t),"name"),e.abrupt("return",r.map((function(e){return ee(e)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"registerBlock",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!jt.map((function(e){return e.name})).includes(t.name)){e.next=3;break}throw new Error("The block's name already exists");case 3:return e.next=5,this.$post(this.apiConfig.blocks(this.config),t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBlock",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!jt.map((function(e){return e.name})).includes(t)){e.next=5;break}n=jt.find((function(e){return e.name===t})),e.next=9;break;case 5:return e.next=7,this.$get(this.apiConfig.blockSource(Object(j.a)(Object(j.a)({},this.config),{},{blockId:t})));case 7:a=e.sent,n=a.data;case 9:return e.abrupt("return",ee(n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteBlock",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!jt.map((function(e){return e.name})).includes(t)){e.next=3;break}throw new Error("Cannot delete a native block");case 3:return e.next=5,this.$delete(this.apiConfig.blockSource(Object(j.a)(Object(j.a)({},this.config),{},{blockId:t})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRealmManagementHealth",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.realmManagementHealth(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAppengineHealth",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.appengineHealth(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPairingHealth",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.pairingHealth(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFlowHealth",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$get(this.apiConfig.flowHealth(this.config));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"$get",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J()({method:"get",url:t,headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json;charset=UTF-8"}}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"$post",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J()({method:"post",url:t,headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json;charset=UTF-8"},data:{data:n}}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"$put",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J()({method:"put",url:t,headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json;charset=UTF-8"},data:{data:n}}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"$patch",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J()({method:"patch",url:t,headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/merge-patch+json"},data:{data:n}}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"$delete",value:function(){var e=Object(z.a)(H.a.mark((function e(t){return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",J()({method:"delete",url:t,headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json;charset=UTF-8"}}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"openSocketConnection",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t,n=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.phoenixSocket){e.next=2;break}return e.abrupt("return",Promise.resolve(this.phoenixSocket));case 2:return(t=new URL(this.apiConfig.phoenixSocket(this.config))).protocol="https:"===t.protocol?"wss:":"ws:",e.abrupt("return",new Promise((function(e){Jt({socketUrl:t,realm:n.config.realm,token:n.token},(function(){n.dispatch("socketError")}),(function(){n.dispatch("socketClose")})).then((function(t){n.phoenixSocket=t,e(t)}))})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"joinRoom",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.phoenixSocket){e.next=3;break}return e.abrupt("return",new Promise((function(e){r.openSocketConnection().then((function(){e(r.joinRoom(t))}))})));case 3:if(!(a=this.joinedChannels[t])){e.next=6;break}return e.abrupt("return",Promise.resolve(a));case 6:return e.abrupt("return",new Promise((function(e){Zt(n,"rooms:".concat(r.config.realm,":").concat(t)).then((function(n){r.joinedChannels[t]=n,e(n)}))})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listenForEvents",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.joinedChannels[t]){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Can't listen for room events before joining it first")));case 3:return a.on("new_event",(function(e){var t,a=(t=e,function(e,t){for(var n=null,a=0;a<e.length&&null===n;a+=1)try{n=e[a](t)}catch(r){}return n}([mt.fromJSON,ft.fromJSON,Bt.fromJSON,Kt.fromJSON,zt.fromJSON],t));if(!a)throw new Error("Unrecognised event received");n(a)})),e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"registerVolatileTrigger",value:function(){var e=Object(z.a)(H.a.mark((function e(t,n){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.joinedChannels[t]){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Room not joined, couldn't register trigger")));case 3:return e.abrupt("return",en(a,n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"leaveRoom",value:function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a=this;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.joinedChannels[t]){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Can't leave a room without joining it first")));case 3:return e.abrupt("return",Qt(n).then((function(){delete a.joinedChannels[t]})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"joinedRooms",get:function(){var e=[];return Object.keys(this.joinedChannels).forEach((function(t){e.push(t)})),e}},{key:"realm",get:function(){return this.config.realm||null}}]),e}(),rn=n(1437),cn=n(1432),sn={add:"fas fa-plus",arrowLeft:"fas fa-chevron-left",blocks:"fas fa-shapes",copyPaste:"fas fa-paste",delete:"fas fa-times",devices:"fas fa-cube",documentation:"fa fa-book",edit:"fas fa-pencil-alt",erase:"fas fa-eraser",filter:"fas fa-filter",flows:"fas fa-wind",groups:"fas fa-object-group",home:"fas fa-home",interfaces:"fas fa-stream",logout:"fas fa-sign-out-alt",pipelines:"fas fa-code-branch",settings:"fas fa-cog",statusOK:"fas fa-check-circle color-green",statusConnected:"fas fa-circle color-green",statusDisconnected:"fas fa-circle color-red",statusKO:"fas fa-times-circle color-red",statusNeverConnected:"fas fa-circle color-grey",triggers:"fas fa-bolt"},on=["delete","erase"],ln=function(e){var t=e.as,n=void 0===t?"default":t,a=e.className,r=e.icon,i=e.onClick,c=e.style,s=void 0===c?{}:c,o=e.tooltip,l=e.tooltipPlacement,d=Object(j.a)({},s),u=[];u.push(sn[r]),i&&(d.cursor="pointer"),"button"===n&&u.push("btn"),on.includes(r)&&(u.includes("btn")?u.push("btn-danger"):u.push("color-red")),a&&u.push(a);var h=Object(y.jsx)("i",{className:u.join(" "),style:d,onClick:i});return o?Object(y.jsx)(rn.a,{delay:{show:150,hide:400},overlay:Object(y.jsx)(cn.a,{id:"tooltip",children:o}),placement:l,children:h}):h},dn=["string","boolean","double","integer","longinteger","binaryblob","datetime","doublearray","integerarray","booleanarray","longintegerarray","stringarray","binaryblobarray","datetimearray"],un={endpoint:"",type:"double"},jn=function(e){var t=e.interfaceType,n=e.interfaceAggregation,a=void 0===n?"individual":n,r=e.mapping,i=void 0===r?un:r,c=e.onChange,s="properties"===t,l="datastream"===t&&"individual"===a,d="volatile"===i.retention||"stored"===i.retention,u="use_ttl"===i.databaseRetentionPolicy,h={};try{De.validation.validateSync(i,{abortEarly:!1})}catch(b){h=Y.a.mapValues(Y.a.keyBy(Y.a.uniqBy(b.inner,"path"),"path"),"message")}return Object(y.jsxs)(L.a,{children:[Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingEndpoint",children:[Object(y.jsx)(L.a.Label,{children:"Endpoint"}),Object(y.jsx)(L.a.Control,{type:"text",value:i.endpoint,onChange:function(e){var t=e.target.value;return c(Object(j.a)(Object(j.a)({},i),{},{endpoint:t}))},autoComplete:"off",required:!0,isInvalid:null!=h.endpoint}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.endpoint})]})})}),Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{sm:s?8:12,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingType",children:[Object(y.jsx)(L.a.Label,{children:"Type"}),Object(y.jsx)(L.a.Control,{as:"select",value:i.type,onChange:function(e){var t=e.target.value;return c(Object(j.a)(Object(j.a)({},i),{},{type:t}))},isInvalid:null!=h.type,children:dn.map((function(e){return Object(y.jsx)("option",{children:e},e)}))}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.type})]})}),s&&Object(y.jsx)(o.a,{sm:4,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingAllowUnset",children:[Object(y.jsx)(L.a.Label,{children:"Property options"}),Object(y.jsx)(L.a.Check,{type:"checkbox",label:"Allow unset",checked:!!i.allowUnset,onChange:function(e){var t=!!e.target.checked;c(Object(j.a)(Object(j.a)({},i),{},{allowUnset:t||void 0}))},isInvalid:null!=h.allowUnset}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.allowUnset})]})})]}),l&&Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingReliability",children:[Object(y.jsx)(L.a.Label,{children:"Reliability"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"reliability",value:i.reliability||"unreliable",onChange:function(e){var t=e.currentTarget.value;t="unreliable"===t?void 0:t,c(Object(j.a)(Object(j.a)({},i),{},{reliability:t}))},isInvalid:null!=h.reliability,children:[Object(y.jsx)("option",{value:"unreliable",children:"Unreliable"}),Object(y.jsx)("option",{value:"guaranteed",children:"Guaranteed"}),Object(y.jsx)("option",{value:"unique",children:"Unique"})]}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.reliability})]})}),Object(y.jsx)(o.a,{sm:6,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingExplicitTimestamp",children:[Object(y.jsx)(L.a.Label,{children:"Timestamp"}),Object(y.jsx)(L.a.Check,{type:"checkbox",label:"Explicit timestamp",checked:!!i.explicitTimestamp,onChange:function(e){var t=!!e.target.checked;c(Object(j.a)(Object(j.a)({},i),{},{explicitTimestamp:t||void 0}))},isInvalid:null!=h.explicitTimestamp}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.explicitTimestamp})]})})]}),l&&Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:d?6:12,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingRetention",children:[Object(y.jsx)(L.a.Label,{children:"Retention"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"retention",value:i.retention||"discard",onChange:function(e){var t=e.currentTarget.value;c(Object(j.a)(Object(j.a)({},i),{},{retention:"discard"===t?void 0:t,expiry:"discard"===t?void 0:i.expiry}))},isInvalid:null!=h.retention,children:[Object(y.jsx)("option",{value:"discard",children:"Discard"}),Object(y.jsx)("option",{value:"volatile",children:"Volatile"}),Object(y.jsx)("option",{value:"stored",children:"Stored"})]}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.retention})]})}),d&&Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingExpiry",children:[Object(y.jsx)(L.a.Label,{children:"Expiry"}),Object(y.jsxs)(U.a,{children:[Object(y.jsx)(L.a.Control,{type:"number",min:0,value:i.expiry||0,onChange:function(e){var t=e.currentTarget.value,n=parseInt(t,10)||void 0;c(Object(j.a)(Object(j.a)({},i),{},{expiry:n}))},isInvalid:null!=h.expiry}),Object(y.jsx)(U.a.Append,{children:Object(y.jsx)(U.a.Text,{children:"seconds"})}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.expiry})]})]})})]}),l&&Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:u?6:12,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingDatabaseRetention",children:[Object(y.jsx)(L.a.Label,{children:"Database retention"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"mappingDatabaseRetention",value:i.databaseRetentionPolicy||"no_ttl",onChange:function(e){var t=e.currentTarget.value;c(Object(j.a)(Object(j.a)({},i),{},{databaseRetentionPolicy:"no_ttl"===t?void 0:t,databaseRetentionTtl:"no_ttl"===t?void 0:i.databaseRetentionTtl||60}))},isInvalid:null!=h.databaseRetentionPolicy,children:[Object(y.jsx)("option",{value:"no_ttl",children:"No TTL"}),Object(y.jsx)("option",{value:"use_ttl",children:"Use TTL"})]}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.databaseRetentionPolicy})]})}),u&&Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingTTL",children:[Object(y.jsx)(L.a.Label,{children:"TTL"}),Object(y.jsxs)(U.a,{children:[Object(y.jsx)(L.a.Control,{type:"number",min:60,value:i.databaseRetentionTtl||60,onChange:function(e){var t=e.currentTarget.value,n=parseInt(t,10);c(Object(j.a)(Object(j.a)({},i),{},{databaseRetentionTtl:n}))},isInvalid:null!=h.databaseRetentionTtl}),Object(y.jsx)(U.a.Append,{children:Object(y.jsx)(U.a.Text,{children:"seconds"})}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.databaseRetentionTtl})]})]})})]}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingDescription",children:[Object(y.jsx)(L.a.Label,{children:"Description"}),Object(y.jsx)(L.a.Control,{as:"textarea",value:i.description||"",onChange:function(e){var t=e.target.value;return c(Object(j.a)(Object(j.a)({},i),{},{description:t||void 0}))},autoComplete:"off",isInvalid:null!=h.description}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.description})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"mappingDocumentation",children:[Object(y.jsx)(L.a.Label,{children:"Documentation"}),Object(y.jsx)(L.a.Control,{as:"textarea",value:i.documentation||"",onChange:function(e){var t=e.target.value;return c(Object(j.a)(Object(j.a)({},i),{},{documentation:t||void 0}))},autoComplete:"off",isInvalid:null!=h.documentation}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:h.documentation})]})})})]})},hn=function(e){var t=e.message;return t?Object(y.jsx)("div",{className:"warning-feedback",children:t}):null},bn={unreliable:"Unreliable",guaranteed:"Guaranteed",unique:"Unique"},pn={discard:"Discard",volatile:"Volatile",stored:"Stored"},mn={no_ttl:"No TTL",use_ttl:"Use TTL"},fn=function(e){var t=e.className,n=e.mapping,a=e.onEdit,r=e.onDelete;return Object(y.jsx)(D.a,{"data-testid":n.endpoint,children:Object(y.jsxs)(M.a,{className:t,children:[Object(y.jsxs)(D.a.Toggle,{eventKey:n.endpoint,as:M.a.Header,className:"d-flex align-items-center flex-wrap",children:[Object(y.jsxs)("span",{className:"flex-grow-1",children:[Object(y.jsx)(P.a,{variant:"secondary",children:n.type}),Object(y.jsx)(q.a,{className:"text-left text-truncate",variant:"link",children:n.endpoint})]}),a&&Object(y.jsx)(q.a,{className:"mr-2",variant:"outline-primary",onClick:a,children:"Edit..."}),r&&Object(y.jsx)(q.a,{variant:"outline-primary",onClick:r,children:"Remove"})]}),Object(y.jsx)(D.a.Collapse,{eventKey:n.endpoint,children:Object(y.jsxs)(M.a.Body,{children:[n.description&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Description"}),Object(y.jsx)("p",{children:n.description})]}),n.documentation&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Documentation"}),Object(y.jsx)("p",{children:n.documentation})]}),n.allowUnset&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Allow Unset"}),Object(y.jsx)("p",{children:"True"})]}),n.explicitTimestamp&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Explicit Timestamp"}),Object(y.jsx)("p",{children:"True"})]}),n.reliability&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Reliability"}),Object(y.jsx)("p",{children:bn[n.reliability]})]}),n.retention&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Retention"}),Object(y.jsx)("p",{children:pn[n.retention]})]}),n.expiry&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Expiry"}),Object(y.jsxs)("p",{children:[n.expiry," seconds"]})]}),n.databaseRetentionPolicy&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Database Retention"}),Object(y.jsx)("p",{children:mn[n.databaseRetentionPolicy]})]}),null!=n.databaseRetentionTtl&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Database Retention TTL"}),Object(y.jsxs)("p",{children:[n.databaseRetentionTtl," seconds"]})]})]})})]})})},On=function(e){var t,n=e.interfaceType,r=e.interfaceAggregation,i=void 0===r?"individual":r,c=e.mapping,s=e.onCancel,o=e.onConfirm,l=Object(a.useState)(c||("datastream"===(t={interfaceType:n,interfaceAggregation:i}).interfaceType&&"individual"===t.interfaceAggregation?{endpoint:"",type:"double",explicitTimestamp:!0}:{endpoint:"",type:"double"})),d=Object(h.a)(l,2),u=d[0],j=d[1],b=Object(a.useCallback)((function(e){j(e)}),[]),p=De.validation.isValidSync(u);return Object(y.jsxs)(E.a,{show:!0,size:"lg",centered:!0,onHide:s,children:[Object(y.jsx)(E.a.Header,{closeButton:!0,children:Object(y.jsx)(E.a.Title,{children:null!=c?"Edit mapping":"Add new mapping"})}),Object(y.jsx)(E.a.Body,{children:Object(y.jsx)(jn,{interfaceType:n,interfaceAggregation:i,mapping:u,onChange:b})}),Object(y.jsxs)(E.a.Footer,{children:[Object(y.jsx)(q.a,{variant:"secondary",onClick:s,children:"Cancel"}),Object(y.jsx)(q.a,{variant:"primary",onClick:function(){return o(u)},disabled:!p,children:"Confirm"})]})]})},gn=function(e){return JSON.stringify(e,null,4)},vn=function(e){try{return JSON.parse(e),!0}catch(t){return!1}},xn={name:"",major:0,minor:1,type:"properties",ownership:"device",mappings:[]},yn={explicitTimestamp:!0},kn=function(e){var t=e.initialData,n=e.isSourceVisible,r=void 0!==n&&n,i=e.onChange,c=e.denyMajorChanges,s=void 0!==c&&c,u=Object(a.useState)(t||xn),b=Object(h.a)(u,2),p=b[0],m=b[1],f=Object(a.useState)(gn(Ge.toJSON(p))),O=Object(h.a)(f,2),g=O[0],v=O[1],x=Object(a.useState)(function(e){if(0===e.mappings.length)return yn;var t=e.mappings[0],n={};return n.reliability=t.reliability,n.retention=t.retention,n.expiry="discard"!==n.retention?t.expiry:void 0,n.databaseRetentionPolicy=t.databaseRetentionPolicy,n.databaseRetentionTtl="use_ttl"===n.databaseRetentionPolicy?t.databaseRetentionTtl:void 0,n.explicitTimestamp=null==t.explicitTimestamp||t.explicitTimestamp,n}(p)),k=Object(h.a)(x,2),C=k[0],w=k[1],N=Object(a.useState)(!1),I=Object(h.a)(N,2),_=I[0],S=I[1],A=Object(a.useState)(0),R=Object(h.a)(A,2),T=R[0],D=R[1],M=Object(a.useCallback)((function(e){var n,a,r;try{n=Ge.fromJSON(e)}catch(i){throw new Error("Invalid interface")}if(null!=t&&s&&(a=t,r=n,["name","major","type","aggregation","ownership"].some((function(e){return r[e]!==a[e]}))||!a.mappings.every((function(e){var t=r.mappings.find((function(t){return t.endpoint===e.endpoint}));return Y.a.isEqual(t,e)}))))throw new Error("Interface cannot have major changes such as updating name, major, type, aggregation, ownership, or editing already existing mappings");return n}),[t,s]),P=Object(a.useCallback)((function(e){var t=e.target.value;m((function(e){return Object(j.a)(Object(j.a)({},e),{},{name:t.trim()})}))}),[]),q=Object(a.useCallback)((function(e){var t=e.target.value;m((function(e){return Object(j.a)(Object(j.a)({},e),{},{major:parseInt(t,10)})}))}),[]),E=Object(a.useCallback)((function(e){var t=e.target.value;m((function(e){return Object(j.a)(Object(j.a)({},e),{},{minor:parseInt(t,10)})}))}),[]),F=Object(a.useCallback)((function(e){m((function(e){var t=e.mappings.map((function(e){return Y.a.omit(e,["allowUnset","reliability","retention","expiry","databaseRetentionPolicy","databaseRetentionTtl","explicitTimestamp"])}));return Object(j.a)(Object(j.a)({},e),{},{mappings:t})})),"datastream"===e.type&&"object"===e.aggregation?w(yn):w({})}),[]),G=Object(a.useCallback)((function(e){var t=e.currentTarget.value,n="datastream"===t?"individual":void 0;F({type:t,aggregation:n}),m((function(e){return Object(j.a)(Object(j.a)({},e),{},{type:t,aggregation:n})}))}),[]),H=Object(a.useCallback)((function(e){var t=e.currentTarget.value;F({type:"datastream",aggregation:t}),m((function(e){return Object(j.a)(Object(j.a)({},e),{},{aggregation:t})}))}),[]),$=Object(a.useCallback)((function(e){var t=e.currentTarget.value;m((function(e){return Object(j.a)(Object(j.a)({},e),{},{ownership:t})}))}),[]),V=Object(a.useCallback)((function(e){var t=e.target.value;m((function(e){return Object(j.a)(Object(j.a)({},e),{},{description:t||void 0})}))}),[]),B=Object(a.useCallback)((function(e){var t=e.target.value;m((function(e){return Object(j.a)(Object(j.a)({},e),{},{documentation:t||void 0})}))}),[]),z=Object(a.useCallback)((function(e){var t=e.currentTarget.value;t="unreliable"===t?void 0:t,w((function(e){return Object(j.a)(Object(j.a)({},e),{},{reliability:t})}))}),[]),K=Object(a.useCallback)((function(e){var t=!!e.target.checked;t=t||void 0,w((function(e){return Object(j.a)(Object(j.a)({},e),{},{explicitTimestamp:t})}))}),[]),J=Object(a.useCallback)((function(e){var t=e.currentTarget.value;w((function(e){return Object(j.a)(Object(j.a)({},e),{},{retention:"discard"===t?void 0:t,expiry:"discard"===t?void 0:e.expiry})}))}),[]),W=Object(a.useCallback)((function(e){var t=parseInt(e.currentTarget.value,10)||void 0;w((function(e){return Object(j.a)(Object(j.a)({},e),{},{expiry:t})}))}),[]),Z=Object(a.useCallback)((function(e){var t=e.currentTarget.value;w((function(e){return Object(j.a)(Object(j.a)({},e),{},{databaseRetentionPolicy:"no_ttl"===t?void 0:t,databaseRetentionTtl:"no_ttl"===t?void 0:e.databaseRetentionTtl||60})}))}),[]),Q=Object(a.useCallback)((function(e){var t=parseInt(e.currentTarget.value,10);w((function(e){return Object(j.a)(Object(j.a)({},e),{},{databaseRetentionTtl:t})}))}),[]),X=Object(a.useCallback)((function(){D(p.mappings.length),S(!0)}),[p.mappings]),ee=Object(a.useCallback)((function(e){D(e),S(!0)}),[]),te=Object(a.useCallback)((function(e){m((function(t){var n=t.mappings.filter((function(t,n){return n!==e}));return Object(j.a)(Object(j.a)({},t),{},{mappings:n})}))}),[]),ne=Object(a.useCallback)((function(e){m((function(t){var n=Object(j.a)({},e);"datastream"===p.type&&"object"===p.aggregation&&(n=Object(j.a)(Object(j.a)({},e),C));var a=T>=t.mappings.length?t.mappings.concat(n):t.mappings.map((function(e,t){return t===T?n:e}));return Object(j.a)(Object(j.a)({},t),{},{mappings:a})})),S(!1)}),[T,C,p.type,p.aggregation]),ae=Object(a.useCallback)((function(e){var t=e.target.value;if(v(t),vn(t)){var n;try{n=M(JSON.parse(t))}catch(r){n=null}if(n){m(n);var a=Y.a.get(n,"mappings.0");"datastream"===n.type&&"object"===n.aggregation?w({reliability:null===a||void 0===a?void 0:a.reliability,retention:null===a||void 0===a?void 0:a.retention,expiry:null===a||void 0===a?void 0:a.expiry,databaseRetentionPolicy:null===a||void 0===a?void 0:a.databaseRetentionPolicy,databaseRetentionTtl:null===a||void 0===a?void 0:a.databaseRetentionTtl,explicitTimestamp:null===a||void 0===a?void 0:a.explicitTimestamp}):w({})}}}),[]);Object(a.useEffect)((function(){m((function(e){if("object"!==e.aggregation||0===e.mappings.length)return e;var t=e.mappings.map((function(e){return Object(j.a)(Object(j.a)({},e),{},{reliability:C.reliability,retention:C.retention,expiry:C.expiry,databaseRetentionPolicy:C.databaseRetentionPolicy,databaseRetentionTtl:C.databaseRetentionTtl,explicitTimestamp:C.explicitTimestamp})}));return Object(j.a)(Object(j.a)({},e),{},{mappings:t})}))}),[C]);var re={};try{Ge.validation.validateSync(p,{abortEarly:!1})}catch(je){re=Y.a.mapValues(Y.a.keyBy(Y.a.uniqBy(je.inner,"path"),"path"),"message")}var ie=Y.a.isEmpty(re);Object(a.useEffect)((function(){var e=gn(Ge.toJSON(p));v((function(t){return function(e){try{return gn(JSON.parse(e))}catch(t){return e}}(t)!==e?e:t})),i&&i(p,ie)}),[p,ie]);var ce=function(e){var t={};return"datastream"===e.type&&"object"===e.aggregation&&e.mappings.map((function(e){return e.endpoint})).map((function(e){return e.split("/").length-1})).some((function(e){return e<2}))&&(t.mappings="Interface mappings endpoints of depth 1 in Object aggregate interfaces are deprecated. The endpoint should have depth level of 2 or more (e.g. /my/endpoint)."),/^([a-z][a-z0-9]*\.([a-z0-9][a-z0-9-]*\.)*)+[A-Z][a-zA-Z0-9]*$/.test(e.name)||(t.name="Interface name should be prefixed with a reverse domain name, and should use PascalCase (e.g. com.example.MyInterface)"),t}(p),se=!0,oe="";if(vn(g))try{M(JSON.parse(g))}catch(je){se=!1,oe=je.message}else se=!1,oe="Invalid JSON";var le=Y.a.nth(p.mappings,T),de="volatile"===C.retention||"stored"===C.retention,ue="use_ttl"===C.databaseRetentionPolicy;return Object(y.jsxs)(d.a,{children:[Object(y.jsx)(o.a,{md:r?6:12,children:Object(y.jsx)(l.a,{fluid:!0,className:"bg-white rounded p-3",children:Object(y.jsxs)(L.a,{children:[Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"interfaceName",children:[Object(y.jsx)(L.a.Label,{children:"Name"}),Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Interface name",value:p.name,onChange:P,autoComplete:"off",required:!0,isInvalid:null!=re.name,readOnly:s}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:re.name}),null==re.name&&Object(y.jsx)(hn,{message:ce.name})]})}),Object(y.jsx)(o.a,{md:3,children:Object(y.jsxs)(L.a.Group,{controlId:"interfaceMajor",children:[Object(y.jsx)(L.a.Label,{children:"Major"}),Object(y.jsx)(L.a.Control,{type:"number",min:t?t.major:0,value:p.major,onChange:q,required:!0,isInvalid:null!=re.major,readOnly:s}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:re.major})]})}),Object(y.jsx)(o.a,{md:3,children:Object(y.jsxs)(L.a.Group,{controlId:"interfaceMinor",children:[Object(y.jsx)(L.a.Label,{children:"Minor"}),Object(y.jsx)(L.a.Control,{type:"number",min:t?t.minor:0,value:p.minor,onChange:E,required:!0,isInvalid:null!=re.minor}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:re.minor})]})})]}),Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:4,children:Object(y.jsxs)(L.a.Group,{children:[Object(y.jsx)(L.a.Label,{children:"Type"}),Object(y.jsx)(L.a.Check,{type:"radio",name:"interfaceType",id:"interfaceTypeDatastream",label:"Datastream",value:"datastream",checked:"datastream"===p.type,onChange:G,disabled:s}),Object(y.jsx)(L.a.Check,{type:"radio",name:"interfaceType",id:"interfaceTypeProperties",label:"Properties",value:"properties",checked:"properties"===p.type,onChange:G,disabled:s})]})}),Object(y.jsx)(o.a,{md:4,children:Object(y.jsxs)(L.a.Group,{children:[Object(y.jsx)(L.a.Label,{children:"Aggregation"}),Object(y.jsx)(L.a.Check,{type:"radio",name:"interfaceAggregation",id:"interfaceAggregationIndividual",label:"Individual",value:"individual",checked:"individual"===p.aggregation||!p.aggregation,onChange:H,disabled:"properties"===p.type||s}),Object(y.jsx)(L.a.Check,{type:"radio",name:"interfaceAggregation",id:"interfaceAggregationObject",label:"Object",value:"object",checked:"object"===p.aggregation,onChange:H,disabled:"properties"===p.type||s})]})}),Object(y.jsx)(o.a,{md:4,children:Object(y.jsxs)(L.a.Group,{children:[Object(y.jsx)(L.a.Label,{children:"Ownership"}),Object(y.jsx)(L.a.Check,{type:"radio",name:"interfaceOwnership",id:"interfaceOwnershipDevice",label:"Device",value:"device",checked:"device"===p.ownership,onChange:$,disabled:s}),Object(y.jsx)(L.a.Check,{type:"radio",name:"interfaceOwnership",id:"interfaceOwnershipServer",label:"Server",value:"server",checked:"server"===p.ownership,onChange:$,disabled:s})]})})]}),"datastream"===p.type&&"object"===p.aggregation&&Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"objectMappingReliability",children:[Object(y.jsx)(L.a.Label,{children:"Reliability"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"mappingReliability",value:C.reliability||"unreliable",onChange:z,disabled:s,children:[Object(y.jsx)("option",{value:"unreliable",children:bn.unreliable}),Object(y.jsx)("option",{value:"guaranteed",children:bn.guaranteed}),Object(y.jsx)("option",{value:"unique",children:bn.unique})]})]})}),Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"objectMappingExplicitTimestamp",children:[Object(y.jsx)(L.a.Label,{children:"Timestamp"}),Object(y.jsx)(L.a.Check,{type:"checkbox",name:"mappingExplicitTimestamp",label:"Explicit timestamp",checked:!!C.explicitTimestamp,onChange:K,disabled:s})]})})]}),"datastream"===p.type&&"object"===p.aggregation&&Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:de?6:12,children:Object(y.jsxs)(L.a.Group,{controlId:"objectMappingRetention",children:[Object(y.jsx)(L.a.Label,{children:"Retention"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"mappingRetention",value:C.retention||"discard",onChange:J,disabled:s,children:[Object(y.jsx)("option",{value:"discard",children:pn.discard}),Object(y.jsx)("option",{value:"volatile",children:pn.volatile}),Object(y.jsx)("option",{value:"stored",children:pn.stored})]})]})}),de&&Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"objectMappingExpiry",children:[Object(y.jsx)(L.a.Label,{children:"Expiry"}),Object(y.jsxs)(U.a,{children:[Object(y.jsx)(L.a.Control,{type:"number",min:0,value:C.expiry||0,onChange:W,isInvalid:(C.expiry||0)<0,disabled:s}),Object(y.jsx)(U.a.Append,{children:Object(y.jsx)(U.a.Text,{children:"seconds"})})]})]})})]}),"datastream"===p.type&&"object"===p.aggregation&&Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{md:ue?6:12,children:Object(y.jsxs)(L.a.Group,{controlId:"objectMappingDatabaseRetention",children:[Object(y.jsx)(L.a.Label,{children:"Database Retention"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"mappingDatabaseRetention",value:C.databaseRetentionPolicy||"no_ttl",onChange:Z,disabled:s,children:[Object(y.jsx)("option",{value:"no_ttl",children:mn.no_ttl}),Object(y.jsx)("option",{value:"use_ttl",children:mn.use_ttl})]})]})}),ue&&Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"objectMappingTTL",children:[Object(y.jsx)(L.a.Label,{children:"TTL"}),Object(y.jsxs)(U.a,{children:[Object(y.jsx)(L.a.Control,{type:"number",min:60,value:C.databaseRetentionTtl||60,onChange:Q,isInvalid:(C.databaseRetentionTtl||60)<60,disabled:s}),Object(y.jsx)(U.a.Append,{children:Object(y.jsx)(U.a.Text,{children:"seconds"})})]})]})})]}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"interfaceDescription",children:[Object(y.jsx)(L.a.Label,{children:"Description"}),Object(y.jsx)(L.a.Control,{as:"textarea",value:p.description||"",onChange:V,autoComplete:"off",rows:3,isInvalid:null!=re.description}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:re.description})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"interfaceDocumentation",children:[Object(y.jsx)(L.a.Label,{children:"Documentation"}),Object(y.jsx)(L.a.Control,{as:"textarea",value:p.documentation||"",onChange:B,autoComplete:"off",rows:3,isInvalid:null!=re.documentation}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:re.documentation})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"interfaceMappings",children:[Object(y.jsxs)("button",{type:"button",className:"btn accordion-button w-100 mb-2",onClick:X,children:[Object(y.jsx)(ln,{icon:"add",className:"mr-2"})," Add new mapping..."]}),p.mappings.map((function(e,n){var a=((null===t||void 0===t?void 0:t.mappings)||[]).some((function(t){return t.endpoint===e.endpoint})),r=!(s&&a),i=!(s&&a);return Object(y.jsx)(fn,{className:"mb-2",mapping:e,onEdit:r?function(){return ee(n)}:void 0,onDelete:i?function(){return te(n)}:void 0},e.endpoint)})),Object(y.jsx)(L.a.Control,{className:"d-none",isInvalid:null!=re.mappings}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:re.mappings}),Object(y.jsx)(hn,{message:ce.mappings})]})})})]})})}),r&&Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"interfaceSource",className:"h-100 d-flex flex-column",children:[Object(y.jsx)(L.a.Control,{as:"textarea",className:"flex-grow-1 text-monospace",value:g,onChange:ae,autoComplete:"off",required:!0,isValid:se,isInvalid:!se}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:oe})]})}),_&&Object(y.jsx)(On,{interfaceType:p.type,interfaceAggregation:p.aggregation,mapping:le,onCancel:function(){return S(!1)},onConfirm:ne})]})},Cn=function(){return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsx)("h2",{children:"Interface Editor"}),Object(y.jsx)("div",{className:"mt-4",children:Object(y.jsx)(kn,{isSourceVisible:!0})})]})},wn=n(27),Nn=n(625),In=n(626),_n=n(1443),Sn=function(e){var t=e.children;return Object(y.jsx)(_n.a,{className:"navbar-dark flex-nowrap vh-100 overflow-auto flex-column",children:t})};Sn.ApiStatus=function(e){var t=e.healthy,n=e.realm;return Object(y.jsxs)(Nn.a,{className:"nav-status pl-4",children:[Object(y.jsx)("div",{children:Object(y.jsx)("b",{children:"Realm"})}),Object(y.jsx)("p",{children:n}),Object(y.jsx)("div",{children:Object(y.jsx)("b",{children:"API Status"})}),Object(y.jsxs)("p",{className:"my-1",children:[Object(y.jsx)(ln,{icon:t?"statusConnected":"statusDisconnected",className:"mr-2"}),t?"Up and running":"Degraded"]})]})},Sn.Brand=function(){return Object(y.jsx)(s.b,{to:"/",className:"nav-brand mb-3",children:Object(y.jsx)("img",{alt:"Astarte logo",src:"/static/img/logo.svg",className:"brand-logo"})})},Sn.Item=function(e){var t=e.icon,n=e.label,r=e.link,i=Object(wn.g)(),c=Object(a.useMemo)((function(){return"/"===r?"/"===i.pathname||"/home"===i.pathname:i.pathname.startsWith(r)}),[i.pathname]);return Object(y.jsxs)(In.a,{as:s.b,to:r,active:c,children:[Object(y.jsx)(ln,{icon:t,className:"mr-2"}),n]})},Sn.Separator=function(){return Object(y.jsx)(Nn.a,{children:Object(y.jsx)("hr",{})})};var An=Sn;function Rn(e){var t=null;switch(e){case"valid":return Object(y.jsx)(y.Fragment,{});case"expired":t="Provided JWT token has expired.";break;case"noAstarteClaims":t="Provided JWT token has no usable Astarte claims.";break;case"invalid":default:t="Invalid JWT token."}return Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:t})}var Tn=function(e){var t=e.canSwitchLoginType,n=e.defaultRealm,r=e.onSwitchLoginType,i=e.onLogin,c=Object(a.useState)(n),s=Object(h.a)(c,2),o=s[0],l=s[1],d=Object(a.useState)(""),u=Object(h.a)(d,2),j=u[0],b=u[1],p=te(o),m=Object(a.useMemo)((function(){return de.validate(j)}),[j]),f=p&&"valid"===m,O=function(){return Object(y.jsx)("a",{href:"https://github.com/astarte-platform/astartectl#installation",target:"_blank",rel:"noreferrer",children:"astartectl"})};return Object(y.jsxs)(L.a,{className:"login-form p-3 w-100",onSubmit:function(e){e.preventDefault(),e.stopPropagation();var t=new URLSearchParams({realm:o}),n=new URLSearchParams({access_token:j});i("/auth?".concat(t,"#").concat(n))},children:[Object(y.jsxs)(L.a.Group,{controlId:"astarteRealm",children:[Object(y.jsx)(L.a.Label,{children:"Realm"}),Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Astarte Realm",value:o,onChange:function(e){l(e.target.value)},isValid:""!==o&&p,isInvalid:""!==o&&!p,required:!0})]}),Object(y.jsxs)(L.a.Group,{controlId:"astarteToken",children:[Object(y.jsx)(L.a.Label,{children:"Token"}),Object(y.jsx)(L.a.Control,{as:"textarea",rows:6,placeholder:"Auth token",value:j,onChange:function(e){b(e.target.value.trim())},isValid:""!==j&&"valid"===m,isInvalid:""!==j&&"valid"!==m,required:!0}),Rn(m)]}),Object(y.jsx)(q.a,{type:"submit",variant:"primary",disabled:!f,className:"w-100",children:"Login"}),t&&Object(y.jsx)("div",{className:"d-flex flex-row-reverse mt-2",children:Object(y.jsx)(q.a,{variant:"link",onClick:function(){return r("oauth")},children:"Switch to OAuth login"})}),Object(y.jsxs)("div",{className:"container-fluid border rounded p-2 bg-light mt-3",children:["A valid JWT token should be used, you can use ",Object(y.jsx)(O,{})," to generate one:",Object(y.jsx)("br",{}),Object(y.jsx)("code",{children:"$ astartectl utils gen-jwt all-realm-apis -k your_key.pem"})]})]})},Dn=function(e){var t=e.canSwitchLoginType,n=e.onSwitchLoginType,r=e.defaultRealm,i=e.onLogin,c=Object(a.useState)(r),s=Object(h.a)(c,2),o=s[0],l=s[1],d=Object(a.useState)(""),u=Object(h.a)(d,2),j=u[0],b=u[1],p=te(o),m=function(e){try{return new URL(e),!0}catch(t){return!1}}(j);return Object(y.jsxs)(L.a,{className:"login-form p-3 w-100",onSubmit:function(e){e.preventDefault(),e.stopPropagation();var t=new URL("auth",window.location.toString());t.search=new URLSearchParams({realm:o,authUrl:j}).toString();var n=new URL(j);n.search=new URLSearchParams({client_id:"astarte-dashboard",response_type:"token",redirect_uri:t.toString()}).toString(),i(n.toString())},children:[Object(y.jsxs)(L.a.Group,{controlId:"astarteRealm",children:[Object(y.jsx)(L.a.Label,{children:"Realm"}),Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Astarte Realm",value:o,onChange:function(e){l(e.target.value)},isValid:""!==o&&p,isInvalid:""!==o&&!p,required:!0})]}),Object(y.jsxs)(L.a.Group,{controlId:"oauthProviderUrl",children:[Object(y.jsx)(L.a.Label,{children:"OAuth provider URL"}),Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Astarte Realm",value:j,onChange:function(e){b(e.target.value)},isValid:""!==j&&m,isInvalid:""!==j&&!m,required:!0})]}),Object(y.jsx)(q.a,{type:"submit",variant:"primary",disabled:!p||!m,className:"w-100",children:"Login"}),t&&Object(y.jsx)("div",{className:"d-flex flex-row-reverse mt-2",children:Object(y.jsx)(q.a,{variant:"link",onClick:function(){return n("token")},children:"Switch to token login"})})]})},Mn=function(){return Object(y.jsx)(o.a,{lg:6,className:"p-0 no-gutters d-none d-lg-block",children:Object(y.jsxs)("div",{className:"d-flex flex-column align-items-center justify-content-center position-relative login-image-container",children:[Object(y.jsx)("img",{src:"/static/img/background-login-top.svg",alt:"Background visual spacer",className:"w-100 position-absolute top-background-image"}),Object(y.jsx)("img",{src:"/static/img/background-login-bottom.svg",alt:"Background visual spacer",className:"w-100 position-absolute bottom-background-image"}),Object(y.jsx)("img",{src:"/static/img/logo-login.svg",alt:"Astarte logo",className:"logo m-4"}),Object(y.jsx)("img",{src:"/static/img/mascotte-computer.svg",alt:"Astarte mascotte",className:"mascotte m-4"})]})})},Pn=function(e){var t=e.canSwitchLoginType,n=e.defaultRealm,r=e.type,i=e.onLogin,c=Object(a.useState)(r),s=Object(h.a)(c,2),l=s[0],d=s[1],u=function(e){d(e)};return Object(y.jsxs)(o.a,{lg:6,sm:12,className:"bg-white d-flex flex-column align-items-center justify-content-center min-vh-100",children:[Object(y.jsx)("h1",{children:"Sign In"}),"oauth"===l?Object(y.jsx)(Dn,{defaultRealm:n,canSwitchLoginType:t,onSwitchLoginType:u,onLogin:i}):Object(y.jsx)(Tn,{defaultRealm:n,canSwitchLoginType:t,onSwitchLoginType:u,onLogin:i})]})},qn=function(e){var t=e.type,n=e.canSwitchLoginType,a=e.defaultRealm,r=Object(wn.h)();return Object(y.jsx)(l.a,{fluid:!0,children:Object(y.jsxs)(d.a,{children:[Object(y.jsx)(Mn,{}),Object(y.jsx)(Pn,{type:t,canSwitchLoginType:n,defaultRealm:a,onLogin:function(e){r(e)}})]})})},En=n(50),Ln=n(1434),Un=n(1435),Fn=function(){function e(t){Object(V.a)(this,e),this.name=void 0,this.dataWrapper=void 0,this.dataKind=void 0,this.$getData=void 0,this.name=t.name,this.dataWrapper=t.dataWrapper,this.dataKind=t.dataKind,this.$getData=t.getData}return Object(B.a)(e,[{key:"getData",value:function(){var e=Object(z.a)(H.a.mark((function e(){var t,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$getData();case 2:if(null!=(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:n=this.dataKind,e.t0=this.dataWrapper,e.next="Array"===e.t0?9:(e.t0,10);break;case 9:return e.abrupt("return",t.map((function(e){return new n(e)})));case 10:return e.abrupt("return",new n(t));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Gn=function e(t){Object(V.a)(this,e),this.data=void 0,this.data=t.data},Hn=function e(t){Object(V.a)(this,e),this.data=void 0,this.data=t.data},$n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Fn({name:t.name||"Connected devices",dataWrapper:"Object",dataKind:Gn,getData:function(){return Object(z.a)(H.a.mark((function t(){var n;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getDevicesStats();case 2:return n=t.sent,t.abrupt("return",{data:{connected:{value:Number(n.connected_devices),type:"integer"},disconnected:{value:Number(n.total_devices-n.connected_devices),type:"integer"}}});case 4:case"end":return t.stop()}}),t)})))()}})},Vn=function(e){if(e instanceof an)return e;var t=new an({appEngineApiUrl:e.appEngineApiUrl,realmManagementApiUrl:e.realmManagementApiUrl,pairingApiUrl:"",flowApiUrl:""});return t.setCredentials({token:e.token,realm:e.realm}),t},Bn=function(e,t){return function(e,t){return new Fn({name:t.name||"Device stats",dataWrapper:"Object",dataKind:Hn,getData:function(){return Object(z.a)(H.a.mark((function n(){var a,r,i,c,s,o,l,d,u;return H.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getDeviceInfo(t.deviceId);case 2:return a=n.sent,r=Array.from(a.introspection.values()),i=[].concat(Object(En.a)(r),Object(En.a)(a.previousInterfaces)),c=a.totalReceivedBytes,s=a.totalReceivedMessages,o=Y.a.sumBy(i,"exchangedBytes"),l=Y.a.sumBy(i,"exchangedMessages"),d=c-o,u=s-l,n.abrupt("return",{data:i.reduce((function(e,n){return Object(j.a)(Object(j.a)({},e),{},Object(F.a)({},"".concat(n.name," v").concat(n.major,".").concat(n.minor),{type:"integer",value:Number(("exchangedMessages"===t.stats?n.exchangedMessages:n.exchangedBytes)||0)}))}),{Other:{type:"integer",value:Number("exchangedMessages"===t.stats?u:d)}})});case 12:case"end":return n.stop()}}),n)})))()}})}(Vn(e),t)},zn=n(149),Kn=function(e){var t=Object(a.useState)("initial"),n=Object(h.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)(null),s=Object(h.a)(c,2),o=s[0],l=s[1],d=Object(a.useCallback)(Object(z.a)(H.a.mark((function t(){var n;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i("loading"),t.prev=1,t.next=4,Promise.all(e.providers.map((function(e){return e.getData()})));case 4:n=t.sent,l(n),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),e.onError&&e.onError(t.t0);case 11:return t.prev=11,i("loaded"),t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])}))),[e.providers]);return Object(a.useEffect)((function(){if(d(),e.refreshInterval){var t=setInterval(d,e.refreshInterval);return function(){return clearInterval(t)}}return function(){}}),[d,e.refreshInterval]),{status:r,data:o,refresh:d}},Jn=function(e){var t=e.provider,n=e.height,r=e.width,i=e.showLegend,c=void 0===i||i,s=e.legendPosition,o=void 0===s?"right":s,l=e.legendAlign,d=void 0===l?"start":l,u=e.refreshInterval,j=Object(a.useMemo)((function(){return[t]}),[t]),h=Kn({providers:j,refreshInterval:u}),b=Object(a.useMemo)((function(){var e={labels:[],datasets:[]};if(null==h.data)return e;var t=h.data[0];if(null==t)return e;var n=t.data,a=n.connected;return{labels:["Disconnected","Connected"],datasets:[{data:[n.disconnected.value,a.value],backgroundColor:["#cc5b6d","#5bcc6c"]}]}}),[h.data]),p=Object(a.useMemo)((function(){return{responsive:!0,legend:{display:c,position:o,align:d}}}),[c,o,d]);return Object(y.jsx)(zn.Pie,{data:b,width:r,height:n,options:p})},Wn=n(253),Zn=n.n(Wn),Yn=function(e){var t=e.providers,n=e.height,r=e.width,i=e.showLegend,c=void 0===i||i,s=e.legendPosition,o=void 0===s?"top":s,l=e.legendAlign,d=void 0===l?"start":l,u=e.refreshInterval,j=Kn({providers:t,refreshInterval:u}),h=Object(a.useMemo)((function(){var e={labels:[],datasets:[]};if(null==j.data)return e;var t=j.data[0];if(null==t)return e;var n=t.data,a=Object.keys(n),r=a.map((function(e){return Number(n[e].value)})),i=a.map((function(e,t){return Zn.a.hsl(360*t/a.length,70,70).rgb().string()}));return{labels:a,datasets:[{data:r,backgroundColor:i}]}}),[j.data]),b=Object(a.useMemo)((function(){return{responsive:!0,maintainAspectRatio:!1,legend:{display:c,position:o,align:d}}}),[c,o,d]);return Object(y.jsx)(zn.Pie,{data:h,width:r,height:n,options:b})};var Qn=Object(a.createContext)(null),Xn=function(){return Object(a.useContext)(Qn)},ea=function(e){var t=e.children,n=e.config,r=Object(u.a)(e,["children","config"]),i=Object(a.useState)(function(){var e=null;try{e=JSON.parse(localStorage.getItem("session")||"")}catch(t){e=null}return 1===Y.a.get(e,"_version")?Y.a.omit(e,"_version"):null}()),c=Object(h.a)(i,2),s=c[0],o=c[1],l=Object(a.useMemo)((function(){var e=function(e){var t,n,a,r,i=e.astarteApiUrl;return"localhost"===i?(t=new URL("http://localhost:4002"),n=new URL("http://localhost:4000"),a=new URL("http://localhost:4003"),r=new URL("http://localhost:4009")):(t=new URL("appengine/",i),n=new URL("realmmanagement/",i),a=new URL("pairing/",i),r=new URL("flow/",i)),e.appEngineApiUrl&&(t=new URL(e.appEngineApiUrl)),e.realmManagementApiUrl&&(n=new URL(e.realmManagementApiUrl)),e.pairingApiUrl&&(a=new URL(e.pairingApiUrl)),e.flowApiUrl&&(r=new URL(e.flowApiUrl)),{appEngineApiUrl:t.toString(),realmManagementApiUrl:n.toString(),pairingApiUrl:a.toString(),flowApiUrl:r.toString()}}(n),t=Y.a.pick(s,["realm","token"]),a=Y.a.merge({},e,t);return new an(a)}),[n]),d=Object(a.useCallback)((function(e){l.setCredentials(e&&{realm:e.realm,token:e.token}),o(e),function(e){e?localStorage.setItem("session",JSON.stringify(Object(j.a)(Object(j.a)({},e),{},{_version:1}))):localStorage.removeItem("session")}(e)}),[l]),b=Object(a.useCallback)((function(e){var t=e.realm,n=e.token,a=e.authUrl;return!(!t||!n)&&(d({realm:t,token:n,authUrl:a}),!0)}),[d]),p=Object(a.useCallback)((function(){return d(null)}),[d]),m=Object(a.useMemo)((function(){return{client:l,realm:s&&s.realm,isAuthenticated:null!=s,login:b,logout:p}}),[l,b,p,s]);return Object(y.jsx)(Qn.Provider,Object(j.a)(Object(j.a)({value:m},r),{},{children:t}))},ta=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!e)throw new Error("Invalid fetch method");var i=Object(a.useState)("loading"),c=Object(h.a)(i,2),s=c[0],o=c[1],l=Object(a.useState)(null),d=Object(h.a)(l,2),u=d[0],j=d[1],b=Object(a.useState)(null),p=Object(h.a)(b,2),m=p[0],f=p[1],O=Object(a.useRef)(!1),g=Object(a.useCallback)(Object(z.a)(H.a.mark((function t(){var n,a=arguments;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o("loading"),t.prev=1,t.next=4,e.apply(void 0,a);case 4:n=t.sent,O.current&&(j(n),o("ok")),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),f(t.t0),o("err");case 12:case"end":return t.stop()}}),t,null,[[1,8]])}))),[O]);return Object(a.useEffect)((function(){return O.current=!0,g.apply(void 0,n),function(){O.current=!1}}),[]),{status:s,value:u,error:m,refresh:g}},na=function(e){var t=e.data,n=e.status,a=e.showRefreshing,r=void 0!==a&&a,i=e.fallback,c=e.errorFallback,s=e.children;switch(n){case"ok":return s(t);case"loading":return!r&&t?s(t):i||null;case"err":return c||null;default:return null}},aa=function(e){var t,n=e.service,a=e.status;return t="loading"===a?Object(y.jsx)("td",{children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}):"ok"===a?Object(y.jsxs)("td",{className:"color-green",children:[Object(y.jsx)(ln,{icon:"statusOK",className:"mr-1"}),"This service is operating normally"]}):Object(y.jsxs)("td",{className:"color-red",children:[Object(y.jsx)(ln,{icon:"statusKO",className:"mr-1"}),"This service appears offline"]}),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:n}),t]})},ra=function(e){var t=e.appengine,n=e.realmManagement,a=e.pairing,r=e.showFlowStatus,i=e.flow;return Object(y.jsxs)(M.a,{id:"status-card",className:"h-100",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"API Status"}),Object(y.jsx)(M.a.Body,{children:Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Service"}),Object(y.jsx)("th",{children:"Status"})]})}),Object(y.jsxs)("tbody",{children:[Object(y.jsx)(aa,{service:"Realm Management",status:n}),Object(y.jsx)(aa,{service:"AppEngine",status:t}),Object(y.jsx)(aa,{service:"Pairing",status:a}),r&&i&&Object(y.jsx)(aa,{service:"Flow",status:i})]})]})})]})},ia=function(e){var t=e.connectedDevices,n=e.totalDevices,a=e.connectedDevicesProvider;return Object(y.jsxs)(M.a,{id:"devices-card",className:"h-100",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Devices"}),Object(y.jsx)(M.a.Body,{children:Object(y.jsx)(l.a,{className:"h-100 p-0",fluid:!0,children:Object(y.jsxs)(d.a,{noGutters:!0,children:[Object(y.jsxs)(o.a,{xs:12,lg:6,children:[Object(y.jsx)(M.a.Title,{children:"Connected devices"}),Object(y.jsx)(M.a.Text,{children:t}),Object(y.jsx)(M.a.Title,{children:"Registered devices"}),Object(y.jsx)(M.a.Text,{children:n})]}),Object(y.jsx)(o.a,{xs:12,lg:6,children:n>0&&Object(y.jsx)(Jn,{provider:a})})]})})})]})},ca=function(e){var t=e.interfaces,n=e.onInterfaceClick,a=e.maxShownInterfaces,r=t.slice(0,a),i=t.length-a;return Object(y.jsxs)("ul",{className:"list-unstyled",children:[r.map((function(e){return Object(y.jsx)("li",{className:"my-1",children:Object(y.jsxs)("a",{href:"/interfaces",onClick:function(t){n(t,e)},children:[Object(y.jsx)(ln,{icon:"interfaces",className:"mr-1"}),e]})},e)})),i>0&&Object(y.jsx)("li",{children:Object(y.jsx)(s.b,{to:"/interfaces",children:"".concat(i," more installed ").concat(i>1?"interfaces":"interface","\u2026")})})]})},sa=function(e){var t=e.interfaceList,n=e.onInterfaceClick,a=e.onInstallInterfaceClick;return Object(y.jsxs)(M.a,{id:"interfaces-card",className:"h-100",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Interfaces"}),Object(y.jsxs)(M.a.Body,{className:"d-flex flex-column",children:[t.length>0?Object(y.jsx)(ca,{interfaces:t,onInterfaceClick:n,maxShownInterfaces:4}):Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(M.a.Text,{children:"Interfaces defines how data is exchanged between Astarte and its peers."}),Object(y.jsx)(M.a.Text,{children:Object(y.jsx)("a",{href:"https://docs.astarte-platform.org/snapshot/030-interface.html",target:"_blank",rel:"noreferrer",children:"Learn more..."})})]}),Object(y.jsx)(q.a,{variant:"primary",className:"align-self-start mt-auto",onClick:a,children:"Install a new interface"})]})]})},oa=function(e){var t=e.triggers,n=e.maxShownTriggers,a=t.slice(0,n),r=t.length-n;return Object(y.jsxs)("ul",{className:"list-unstyled",children:[a.map((function(e){return Object(y.jsx)("li",{className:"my-1",children:Object(y.jsxs)(s.b,{to:"/triggers/".concat(e,"/edit"),children:[Object(y.jsx)(ln,{icon:"triggers",className:"mr-1"}),e]})},e)})),r>0&&Object(y.jsx)("li",{children:Object(y.jsx)(s.b,{to:"/triggers",children:"".concat(r," more installed ").concat(r>1?"triggers":"trigger","\u2026")})})]})},la=function(e){var t=e.triggerList,n=e.onInstallTriggerClick;return Object(y.jsxs)(M.a,{id:"triggers-card",className:"h-100",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Triggers"}),Object(y.jsxs)(M.a.Body,{className:"d-flex flex-column",children:[t.length>0?Object(y.jsx)(oa,{triggers:t,maxShownTriggers:4}):Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(M.a.Text,{children:"Triggers in Astarte are the go-to mechanism for generating push events."}),Object(y.jsx)(M.a.Text,{children:"Triggers allow users to specify conditions upon which a custom payload is delivered to a recipient, using a specific action, which usually maps to a specific transport/protocol, such as HTTP."}),Object(y.jsx)(M.a.Text,{children:Object(y.jsx)("a",{href:"https://docs.astarte-platform.org/snapshot/060-using_triggers.html",target:"_blank",rel:"noreferrer",children:"Learn more..."})})]}),Object(y.jsx)(q.a,{variant:"primary",className:"align-self-start mt-auto",onClick:n,children:"Install a new trigger"})]})]})},da=function(){var e=Xn(),t=R(),n=ta(e.client.getDevicesStats),r=ta(e.client.getInterfaceNames),i=ta(e.client.getTriggerNames),c=ta(e.client.getAppengineHealth),s=ta(e.client.getRealmManagementHealth),u=ta(e.client.getPairingHealth),j=t.features.flow?ta(e.client.getFlowHealth):null,h=Object(wn.h)(),b=Object(a.useMemo)((function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $n(Vn(e),t)}(e.client)}),[e.client]);Object(a.useEffect)((function(){var e=setInterval((function(){n.refresh(),r.refresh(),i.refresh(),c.refresh(),s.refresh(),u.refresh(),t.features.flow&&j&&j.refresh()}),3e4);return function(){clearTimeout(e)}}),[e.client]);var p=Object(a.useCallback)((function(t,n){t.preventDefault(),e.client.getInterfaceMajors(n).then((function(e){var t=Math.max.apply(Math,Object(En.a)(e));h("/interfaces/".concat(n,"/").concat(t,"/edit"))}))}),[]),m="mb-3";return Object(y.jsx)(l.a,{fluid:!0,className:"p-3",children:Object(y.jsxs)(d.a,{children:[Object(y.jsx)(o.a,{xs:12,children:Object(y.jsx)("h2",{className:"mb-4",children:"Astarte Dashboard"})}),Object(y.jsx)(o.a,{xs:6,className:m,children:Object(y.jsx)(ra,{appengine:c.status,realmManagement:s.status,pairing:u.status,showFlowStatus:t.features.flow,flow:j?j.status:null})}),Object(y.jsx)(na,{data:n.value,status:n.status,children:function(e){var t=e.connected_devices,n=e.total_devices;return Object(y.jsx)(o.a,{xs:6,className:m,children:Object(y.jsx)(ia,{connectedDevices:t,totalDevices:n,connectedDevicesProvider:b})})}}),Object(y.jsx)(na,{data:r.value,status:r.status,children:function(e){return Object(y.jsx)(o.a,{xs:6,className:m,children:Object(y.jsx)(sa,{interfaceList:e,onInterfaceClick:p,onInstallInterfaceClick:function(){return h("/interfaces/new")}})})}}),Object(y.jsx)(na,{data:i.value,status:i.status,children:function(e){return Object(y.jsx)(o.a,{xs:6,className:m,children:Object(y.jsx)(la,{triggerList:e,onInstallTriggerClick:function(){return h("/triggers/new")}})})}})]})})};function ua(e){var t=e.href;return Object(y.jsx)(s.b,{to:t,className:"mr-2","aria-label":"Back",children:Object(y.jsx)(ln,{icon:"arrowLeft"})})}function ja(e){var t=e.backLink,n=e.children,a=e.docsLink,r=e.title;return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsxs)("header",{className:"d-flex justify-content-between align-items-baseline",children:[Object(y.jsxs)("h2",{children:[t&&Object(y.jsx)(ua,{href:t}),r]}),a&&Object(y.jsx)("div",{className:"float-right",children:Object(y.jsxs)("a",{target:"_blank",rel:"noreferrer",href:a,children:[Object(y.jsx)(ln,{icon:"documentation",className:"mr-2"}),"Documentation"]})})]}),Object(y.jsx)(l.a,{fluid:!0,className:"bg-white rounded p-3",children:n})]})}var ha=function(e){var t=e.title,n=e.onRetry,a=n?Object(y.jsx)(q.a,{variant:"link",className:"p-0",onClick:n,children:"try again"}):"try again";return Object(y.jsxs)(l.a,{fluid:!0,className:"text-center",children:[Object(y.jsx)("img",{src:"/static/img/mascotte-repair.svg",alt:"Lion mascotte with repair tools",style:{maxWidth:200}}),Object(y.jsx)("h5",{className:"mt-2",children:t}),Object(y.jsxs)("p",{children:["Please check your connectivity and ",a,"."]})]})},ba=function(e){var t=e.groupMap;return 0===t.size?Object(y.jsx)("p",{children:"No registered group"}):Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Group name"}),Object(y.jsx)("th",{children:"Connected devices"}),Object(y.jsx)("th",{children:"Total devices"})]})}),Object(y.jsx)("tbody",{children:Array.from(t.values()).map((function(e){var t=encodeURIComponent(encodeURIComponent(e.name));return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)(s.b,{to:"/groups/".concat(t,"/edit"),children:e.name})}),Object(y.jsx)("td",{children:e.connectedDevices}),Object(y.jsx)("td",{children:e.totalDevices})]},e.name)}))})]})},pa=function(){var e=Xn(),t=_(),n=Object(wn.h)(),r=Object(a.useCallback)(Object(z.a)(H.a.mark((function n(){var a,r,i,c;return H.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.closeAll(),n.next=3,e.client.getGroupList();case 3:return a=n.sent,r=new Map,i=a.map((function(n){return e.client.getDevicesInGroup({groupName:n,details:!0}).catch((function(){return t.showError("Couldn't get the device list for group ".concat(n)),null}))})),n.next=8,Promise.all(i);case 8:return c=n.sent,a.forEach((function(e,t){var n=c[t];n&&r.set(e,{name:e,totalDevices:n.length,connectedDevices:n.filter((function(e){return e.isConnected})).length})})),n.abrupt("return",r);case 11:case"end":return n.stop()}}),n)}))),[e.client,t.closeAll,t.showError]),i=ta(r);return Object(y.jsxs)(ja,{title:"Groups",children:[Object(y.jsx)(t.Alerts,{}),Object(y.jsx)(na,{data:i.value,status:i.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load groups",onRetry:i.refresh}),children:function(e){return Object(y.jsx)(ba,{groupMap:e})}}),Object(y.jsx)(q.a,{variant:"primary",onClick:function(){n("/groups/new")},children:"Create new group"})]})},ma=function(e){var t=e.cancelLabel,n=void 0===t?"Cancel":t,r=e.children,i=e.confirmLabel,c=void 0===i?"Confirm":i,s=e.confirmOnEnter,o=void 0===s||s,l=e.confirmVariant,d=void 0===l?"primary":l,u=e.disabled,j=void 0!==u&&u,h=e.isConfirming,b=void 0!==h&&h,p=e.onCancel,m=e.onConfirm,f=e.size,O=void 0===f?"lg":f,g=e.title,v=Object(a.useCallback)((function(e){"Enter"===e.key&&o&&!b&&m()}),[]);return Object(y.jsx)("div",{onKeyDown:v,children:Object(y.jsxs)(E.a,{show:!0,centered:!0,size:O,onHide:p||m,children:[Object(y.jsx)(E.a.Header,{closeButton:!0,children:Object(y.jsx)(E.a.Title,{children:g})}),Object(y.jsx)(E.a.Body,{children:r}),Object(y.jsxs)(E.a.Footer,{children:[p&&Object(y.jsx)(q.a,{variant:"secondary",onClick:p,style:{minWidth:"5em"},children:n}),Object(y.jsxs)(q.a,{variant:d,disabled:j||b,onClick:m,style:{minWidth:"5em"},children:[b&&Object(y.jsx)(Ln.a,{className:"mr-2",size:"sm",animation:"border",role:"status"}),c]})]})]})})},fa=function(e,t){return Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Status"}),Object(y.jsx)("th",{children:"Device handle"}),Object(y.jsx)("th",{children:"Last connection event"}),Object(y.jsx)("th",{children:"Actions"})]})}),Object(y.jsx)("tbody",{children:e.map((function(e,n){return function(e,t,n){var a,r,i;return e.isConnected?(a="statusConnected",r="Connected",i="Connected on ".concat(e.lastConnection.toLocaleString())):e.lastConnection?(a="statusDisconnected",r="Disconnected",i="Disconnected on ".concat(e.lastDisconnection.toLocaleString())):(a="statusNeverConnected",r="Never connected",i="Never connected"),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)(ln,{icon:a,tooltip:r,tooltipPlacement:"right"})}),Object(y.jsx)("td",{className:e.hasNameAlias?"":"text-monospace",children:Object(y.jsx)(s.b,{to:"/devices/".concat(e.id,"/edit"),children:e.name})}),Object(y.jsx)("td",{children:i}),Object(y.jsx)("td",{children:Object(y.jsx)(ln,{icon:"delete",as:"button",tooltip:"Remove from group",tooltipPlacement:"left",onClick:function(){return n(e)}})})]},t)}(e,n,t)}))})]})},Oa=function(){var e=decodeURIComponent(Object(wn.i)().groupName),t=Object(a.useState)(null),n=Object(h.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)(!1),s=Object(h.a)(c,2),o=s[0],d=s[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),b=j[0],p=j[1],m=Object(wn.h)(),f=Xn(),O=ta((function(){return f.client.getDevicesInGroup({groupName:e,details:!0})})),g=Object(a.useCallback)((function(e){i(e),d(!0)}),[i,d]),v=Object(a.useCallback)((function(){d(!1)}),[d]),x=Object(a.useCallback)((function(){r&&(p(!0),f.client.removeDeviceFromGroup({groupName:e,deviceId:r.id}).finally((function(){null!=O.value&&1===O.value.length?m({pathname:"/groups"}):(p(!1),d(!1),O.refresh())})))}),[f.client,p,d,O.refresh,O.value,e,r,m]),k=null===r||void 0===r?void 0:r.name;return Object(y.jsxs)(ja,{title:"Group Devices",backLink:"/groups",children:[Object(y.jsx)("h5",{className:"mt-1 mb-3",children:"Devices in group ".concat(e)}),Object(y.jsx)(na,{data:O.value,status:O.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load devices in group",onRetry:O.refresh}),children:function(e){return fa(e,g)}}),o&&Object(y.jsxs)(ma,{title:"Warning",confirmLabel:"Remove",confirmVariant:"danger",onCancel:v,onConfirm:x,isConfirming:b,children:[null!=O.value&&1===O.value.length&&Object(y.jsx)("p",{children:"This is the last device in the group. Removing this device will delete the group"}),Object(y.jsxs)("p",{children:["Remove device ",Object(y.jsx)("b",{children:k})," from group ",Object(y.jsx)("b",{children:e}),"?"]})]})]})},ga=function(e){var t=e.text,n=e.word;return n?Object(y.jsx)(y.Fragment,{children:t.split(n).reduce((function(e,t,a){return[].concat(Object(En.a)(e),[Object(y.jsx)("span",{className:"bg-warning text-dark",children:n},a),Object(y.jsx)("span",{children:t})])}),[])}):Object(y.jsx)("span",{children:t})},va=function(e){var t=e.deviceId,n=e.deviceAliases,r=e.filter,i=e.selected,c=e.onToggleDevice,s=Object(a.useCallback)((function(e){var n=e.target.checked;c(t,n)}),[t,c]);return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)(L.a.Check,{id:"device-".concat(t),type:"checkbox",checked:i,onChange:s})}),Object(y.jsx)("td",{className:"text-monospace",children:Object(y.jsx)(ga,{text:t,word:r})}),Object(y.jsx)("td",{children:Object(y.jsx)("ul",{className:"list-unstyled",children:n.map((function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return Object(y.jsx)("li",{children:Object(y.jsx)(ga,{text:a,word:r})},n)}))})})]})},xa=function(e){var t=e.devices,n=e.filter,r=e.selectedDevices,i=e.onToggleDevice,c=Object(a.useMemo)((function(){return n?t.filter((function(e){var t=Array.from(e.aliases.values());return e.id.includes(n)||t.filter((function(e){return e.includes(n)})).length>0})):t}),[t,n]);return c.length?Object(y.jsxs)(Un.a,{responsive:!0,hover:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Selected"}),Object(y.jsx)("th",{children:"Device ID"}),Object(y.jsx)("th",{children:"Aliases"})]})}),Object(y.jsx)("tbody",{children:c.map((function(e){return Object(y.jsx)(va,{deviceId:e.id,deviceAliases:Array.from(e.aliases.entries()),selected:r.has(e.id),filter:n,onToggleDevice:i},e.id)}))})]}):Object(y.jsx)("p",{children:"No device matched the current filter"})},ya=function(e){var t=e.groupName,n=e.onGroupNameChange,a=!t.startsWith("@")&&!t.startsWith("~");return Object(y.jsxs)(L.a.Group,{controlId:"groupNameInput",children:[Object(y.jsx)(L.a.Label,{children:"Group name"}),Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Your group name",value:t,onChange:function(e){return n(e.target.value.trim())},autoComplete:"off",required:!0,isValid:""!==t&&a,isInvalid:""!==t&&!a}),!a&&Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:"The group name cannot start with ~ or @."})]})},ka=function(e){var t=e.filter,n=e.onFilterChange;return Object(y.jsxs)(L.a.Group,{children:[Object(y.jsx)(L.a.Label,{srOnly:!0,children:"Table filter"}),Object(y.jsxs)(U.a,{children:[Object(y.jsx)(U.a.Prepend,{children:Object(y.jsx)(U.a.Text,{children:Object(y.jsx)(ln,{icon:"filter"})})}),Object(y.jsx)(L.a.Control,{type:"text",value:t,onChange:function(e){return n(e.target.value)},placeholder:"Device ID/alias"})]})]})},Ca=function(){var e=Object(a.useState)(""),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(""),c=Object(h.a)(i,2),s=c[0],o=c[1],d=Object(a.useState)(new Set),u=Object(h.a)(d,2),j=u[0],b=u[1],p=Object(a.useState)(!1),m=Object(h.a)(p,2),f=m[0],O=m[1],g=Xn(),v=ta((function(){return g.client.getDevices({details:!0}).then((function(e){return e.devices}))})),x=_(),k=Object(wn.h)(),C=function(e){e.preventDefault(),O(!0),g.client.createGroup({groupName:n,deviceIds:Array.from(j)}).then((function(){k({pathname:"/groups"})})).catch((function(e){x.showError("Could not create group: ".concat(e.message)),O(!1)}))},w=function(e,t){b((function(n){var a=new Set(n);return t?a.add(e):a.delete(e),a}))},N=j.size,I=""!==n&&!n.startsWith("@")&&!n.startsWith("~")&&N>0;return Object(y.jsxs)(ja,{title:"Create a New Group",backLink:"/groups",children:[Object(y.jsx)(x.Alerts,{}),Object(y.jsx)(na,{data:v.value,status:v.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load the device list",onRetry:v.refresh}),children:function(e){return Object(y.jsxs)(L.a,{onSubmit:C,children:[Object(y.jsx)(ya,{groupName:n,onGroupNameChange:r}),Object(y.jsxs)("div",{className:"table-toolbar p-1",children:[Object(y.jsx)("span",{children:N>0?"".concat(N," ").concat(1===N?"device":"devices"," selected."):"Please select at least one device."}),Object(y.jsx)("div",{className:"float-right",children:Object(y.jsx)(ka,{filter:s,onFilterChange:o})})]}),Object(y.jsx)(xa,{filter:s,devices:e,selectedDevices:j,onToggleDevice:w}),Object(y.jsx)(L.a.Row,{className:"flex-row-reverse pr-2",children:Object(y.jsxs)(q.a,{variant:"primary",type:"submit",disabled:!I||f,children:[f&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Create group"]})})]})}})]})},wa=n(191),Na=function(e){var t=e.name,n=e.onClick;return Object(y.jsx)(wa.a.Item,{children:Object(y.jsxs)(q.a,{variant:"link",className:"p-0",onClick:n,children:[Object(y.jsx)(ln,{icon:"triggers",className:"mr-2"}),t]})})},Ia=function(){return Object(y.jsx)(wa.a.Item,{children:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})})})},_a=function(e){var t=e.onRetry;return Object(y.jsx)(wa.a.Item,{children:Object(y.jsx)(ha,{title:"Couldn't load available triggers",onRetry:t})})},Sa=function(){var e=Xn(),t=Object(wn.h)(),n=ta(e.client.getTriggerNames);return v(n.refresh,3e4),Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsx)(d.a,{children:Object(y.jsx)(o.a,{children:Object(y.jsx)("h2",{children:"Triggers"})})}),Object(y.jsx)(d.a,{className:"mt-3",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(wa.a,{children:[Object(y.jsx)(wa.a.Item,{children:Object(y.jsxs)(q.a,{variant:"link",className:"p-0",onClick:function(){t("/triggers/new")},children:[Object(y.jsx)(ln,{icon:"add",className:"mr-2"}),"Install a new trigger..."]})}),Object(y.jsx)(na,{data:n.value,status:n.status,fallback:Object(y.jsx)(Ia,{}),errorFallback:Object(y.jsx)(_a,{onRetry:n.refresh}),children:function(e){return Object(y.jsx)(y.Fragment,{children:e.map((function(e){return Object(y.jsx)(Na,{name:e,onClick:function(){t("/triggers/".concat(e,"/edit"))}},e)}))})}})]})})})]})},Aa={device_disconnected:"Device Disconnected",device_connected:"Device Connected",device_error:"Device Error",device_empty_cache_received:"Empty Cache Received",incoming_data:"Incoming Data",value_change:"Value Change",value_change_applied:"Value Change Applied",path_created:"Path Created",path_removed:"Path Removed",value_stored:"Value Stored"},Ra={"*":"*","==":"==","!=":"!=",">":">",">=":">=","<":"<","<=":"<=",contains:"Contains",not_contains:"Not Contains"},Ta={type:"device_trigger",on:"device_connected"},Da={type:"data_trigger",on:"incoming_data",interfaceName:"*",matchPath:"/*",valueMatchOperator:"*"},Ma=function(e){var t,n=e.fetchInterface,r=e.fetchInterfaceMajors,i=e.interfacesName,c=void 0===i?[]:i,s=e.interfaceMajors,l=void 0===s?[]:s,d=e.isLoadingInterface,u=void 0!==d&&d,h=e.isLoadingInterfacesName,b=void 0!==h&&h,p=e.isLoadingInterfaceMajors,m=void 0!==p&&p,f=e.isReadOnly,O=e.onChange,g=e.simpleTrigger,v=e.simpleTriggerInterface,x=e.validationErrors,k=void 0===x?{}:x,C="device_trigger"===Y.a.get(g,"type"),w="data_trigger"===Y.a.get(g,"type"),N=null!=Y.a.get(g,"deviceId"),I=null!=Y.a.get(g,"groupName"),_=N?"device":I?"group":"all_devices",S=Y.a.get(g,"interfaceName"),A=null!=S&&"*"!==S,R=Y.a.get(g,"valueMatchOperator"),T=null!=R&&"*"!==R,D=Y.a.get(g,"matchPath"),M=Object(a.useMemo)((function(){return v?v.type:null}),[v]),P=Object(a.useMemo)((function(){return v?v.aggregation:null}),[v]),q=Object(a.useMemo)((function(){if(!v||!D)return null;var e=v.mappings.find((function(e){return De.matchEndpoint(e.endpoint,D)}));return e?e.type:null}),[v,D]),E=Object(a.useCallback)((function(e){var t=e.currentTarget.value;O("data_trigger"===t?Da:Ta)}),[O]),U=Object(a.useCallback)((function(e){var t=e.currentTarget.value;O(Object(j.a)(Object(j.a)({},g),{},{on:t}))}),[g,O]),F=Object(a.useCallback)((function(e){var t=e.currentTarget.value;O("device"===t?Object(j.a)(Object(j.a)({},g),{},{deviceId:"",groupName:void 0}):"group"===t?Object(j.a)(Object(j.a)({},g),{},{deviceId:void 0,groupName:""}):Object(j.a)(Object(j.a)({},g),{},{deviceId:void 0,groupName:void 0}))}),[g,O]),G=Object(a.useCallback)((function(e){var t=e.target.value;O(Object(j.a)(Object(j.a)({},g),{},{deviceId:t}))}),[g,O]),H=Object(a.useCallback)((function(e){var t=e.target.value;O(Object(j.a)(Object(j.a)({},g),{},{groupName:t}))}),[g,O]),$=Object(a.useCallback)((function(e){var t=e.target.value,a=Object(j.a)(Object(j.a)({},g),{},{interfaceName:t,interfaceMajor:void 0,matchPath:"/*",valueMatchOperator:"*",knownValue:void 0});O(a),"*"!==t&&r(t).then((function(e){if(e.length>0){var r=Math.max.apply(Math,Object(En.a)(e));O(Object(j.a)(Object(j.a)({},a),{},{interfaceMajor:r})),n({interfaceName:t,interfaceMajor:r})}}))}),[g,O,r,n]),V=Object(a.useCallback)((function(e){var t=e.target.value,a=parseInt(t,10);O(Object(j.a)(Object(j.a)({},g),{},{interfaceMajor:a,matchPath:"/*",valueMatchOperator:"*",knownValue:void 0})),n({interfaceName:S,interfaceMajor:a})}),[g,O,n,S]),B=Object(a.useCallback)((function(e){var t=e.target.value;O(Object(j.a)(Object(j.a)({},g),{},{matchPath:t,valueMatchOperator:"*",knownValue:void 0}))}),[g,O]),z=Object(a.useCallback)((function(e){var t=e.target.value;O("*"===t?Object(j.a)(Object(j.a)({},g),{},{valueMatchOperator:t,knownValue:void 0}):Object(j.a)(Object(j.a)({},g),{},{valueMatchOperator:t}))}),[g,O]),K=Object(a.useCallback)((function(e){var t=e.target.value,n=t;if(q){if(["boolean","booleanarray"].includes(q))"false"===t.toLowerCase()&&(n=!1),"true"===t.toLowerCase()&&(n=!0);else if(["integer","double","integerarray","doublearray"].includes(q)){var a=parseFloat(t);Number.isNaN(a)||(n=a)}}else n=String(t);O(Object(j.a)(Object(j.a)({},g),{},{knownValue:n}))}),[g,O,q]),J=Object(a.useCallback)((function(){return(C?["device_connected","device_disconnected","device_error","device_empty_cache_received"]:"properties"===M?["incoming_data","value_change","value_change_applied","path_created","path_removed","value_stored"]:"object"===P?["incoming_data"]:["incoming_data","value_stored"]).map((function(e){return Object(y.jsx)("option",{value:e,children:Aa[e]},e)}))}),[C,M]),W=Object(a.useCallback)((function(){var e=c.map((function(e){return Object(y.jsx)("option",{value:e,children:e},e)}));return[Object(y.jsx)("option",{value:"*",children:"Any interface"},"*")].concat(Object(En.a)(e))}),[c]),Z=Object(a.useCallback)((function(){return l.map((function(e){return Object(y.jsx)("option",{value:e,children:e},e)}))}),[l]),Q=Object(a.useCallback)((function(){var e=[];q?e=q.includes("array")||q.includes("string")||q.includes("binaryblob")?["*","==","!=",">",">=","<","<=","contains","not_contains"]:["*","==","!=",">",">=","<","<="]:e=["*"];return e.map((function(e){return Object(y.jsx)("option",{value:e,children:Ra[e]},e)}))}),[q]);return Object(y.jsxs)(L.a,{children:[Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerSimpleTriggerType",children:[Object(y.jsx)(L.a.Label,{children:"Trigger type"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"triggerSimpleTriggerType",disabled:f,value:Y.a.get(g,"type"),onChange:E,isInvalid:null!=Y.a.get(k,"type"),children:[Object(y.jsx)("option",{value:"device_trigger",children:"Device Trigger"}),Object(y.jsx)("option",{value:"data_trigger",children:"Data Trigger"})]}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"type")})]})})}),Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{sm:N||I?4:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerTargetSelect",children:[Object(y.jsx)(L.a.Label,{children:"Target"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"triggerTargetSelect",disabled:f,value:_,onChange:F,children:[Object(y.jsx)("option",{value:"all_devices",children:"All devices"}),Object(y.jsx)("option",{value:"device",children:"Device"}),Object(y.jsx)("option",{value:"group",children:"Group"})]})]})}),N&&Object(y.jsx)(o.a,{sm:8,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerDeviceId",children:[Object(y.jsx)(L.a.Label,{children:"Device id"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",required:!0,readOnly:f,value:Y.a.get(g,"deviceId")||"",onChange:G,isInvalid:null!=Y.a.get(k,"deviceId")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"deviceId")})]})}),I&&Object(y.jsx)(o.a,{sm:8,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerGroupName",children:[Object(y.jsx)(L.a.Label,{children:"Group Name"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",required:!0,readOnly:f,value:Y.a.get(g,"groupName")||"",onChange:H,isInvalid:null!=Y.a.get(k,"groupName")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"groupName")})]})})]}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerCondition",children:[Object(y.jsx)(L.a.Label,{children:"Trigger condition"}),Object(y.jsx)(L.a.Control,{as:"select",name:"triggerCondition",disabled:f||u,value:Y.a.get(g,"on"),onChange:U,isInvalid:null!=Y.a.get(k,"on"),children:J()}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"on")})]})})}),w&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{sm:A?8:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerInterfaceName",children:[Object(y.jsx)(L.a.Label,{children:"Interface name"}),Object(y.jsx)(L.a.Control,{as:"select",name:"triggerInterfaceName",disabled:f||b,value:S||"*",onChange:$,isInvalid:null!=Y.a.get(k,"interfaceName"),children:W()}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"interfaceName")})]})}),A&&Object(y.jsx)(o.a,{sm:4,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerInterfaceMajor",children:[Object(y.jsx)(L.a.Label,{children:"Interface major"}),Object(y.jsx)(L.a.Control,{as:"select",name:"triggerInterfaceMajor",disabled:f||m||u,value:Y.a.get(g,"interfaceMajor")||0,onChange:V,isInvalid:null!=Y.a.get(k,"interfaceMajor"),children:Z()}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"interfaceMajor")})]})})]}),A&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerPath",children:[Object(y.jsx)(L.a.Label,{children:"Path"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",required:!0,readOnly:f||m||u,value:Y.a.get(g,"matchPath")||"",isInvalid:null!=Y.a.get(k,"matchPath"),onChange:B}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"matchPath")})]})})}),Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{sm:4,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerOperator",children:[Object(y.jsx)(L.a.Label,{children:"Operator"}),Object(y.jsx)(L.a.Control,{as:"select",name:"triggerOperator",disabled:f||m||u,value:R||"*",onChange:z,isInvalid:null!=Y.a.get(k,"valueMatchOperator"),children:Q()}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"valueMatchOperator")})]})}),T&&Object(y.jsx)(o.a,{sm:8,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerKnownValue",children:[Object(y.jsx)(L.a.Label,{children:"Value"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",required:!0,readOnly:f||m||u,value:String(null!==(t=Y.a.get(g,"knownValue"))&&void 0!==t?t:""),onChange:K,isInvalid:null!=Y.a.get(k,"knownValue")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(k,"knownValue")})]})})]})]})]})]})},Pa={httpUrl:"",httpMethod:"post"},qa={amqpExchange:"",amqpMessageExpirationMilliseconds:0,amqpMessagePersistent:!1},Ea=function(e){var t=e.action,n=e.isReadOnly,r=e.onAddAmqpHeader,i=e.onAddHttpHeader,c=e.onEditAmqpHeader,s=e.onEditHttpHeader,l=e.onRemoveAmqpHeader,d=e.onRemoveHttpHeader,u=e.onChange,b=e.realm,p=e.validationErrors,m=void 0===p?{}:p,f=null!=Y.a.get(t,"httpUrl"),O=null!=Y.a.get(t,"amqpExchange"),g=Y.a.get(t,"templateType")||"default",v=Y.a.get(t,"httpStaticHeaders")||{},x=Y.a.get(t,"amqpStaticHeaders")||{},k=Object(a.useCallback)((function(e){var t=e.target.value;u("http"===t?Pa:qa)}),[u]),C=Object(a.useCallback)((function(e){var n=e.target.value;u(Object(j.a)(Object(j.a)({},t),{},{httpMethod:n}))}),[t,u]),w=Object(a.useCallback)((function(e){var n=e.target.value;u(Object(j.a)(Object(j.a)({},t),{},{httpUrl:n}))}),[t,u]),N=Object(a.useCallback)((function(e){var n=!!e.target.checked;u(Object(j.a)(Object(j.a)({},t),{},{ignoreSslErrors:n}))}),[t,u]),I=Object(a.useCallback)((function(e){var n=e.target.value;u("mustache"===n?Object(j.a)(Object(j.a)({},t),{},{templateType:"mustache",template:""}):Object(j.a)(Object(j.a)({},t),{},{templateType:void 0,template:void 0}))}),[t,u]),_=Object(a.useCallback)((function(e){var n=e.target.value;u(Object(j.a)(Object(j.a)({},t),{},{template:n}))}),[t,u]),S=Object(a.useCallback)((function(e){var n=e.target.value;u(Object(j.a)(Object(j.a)({},t),{},{amqpExchange:n}))}),[t,u]),A=Object(a.useCallback)((function(e){var n=e.target.value;u(Object(j.a)(Object(j.a)({},t),{},{amqpRoutingKey:n}))}),[t,u]),R=Object(a.useCallback)((function(e){var n=!!e.target.checked;u(Object(j.a)(Object(j.a)({},t),{},{amqpMessagePersistent:n}))}),[t,u]),T=Object(a.useCallback)((function(e){var n=e.target.value,a=Number(n);u(0===a?Object(j.a)(Object(j.a)({},t),{},{amqpMessagePriority:void 0}):Object(j.a)(Object(j.a)({},t),{},{amqpMessagePriority:a}))}),[t,u]),D=Object(a.useCallback)((function(e){var n=e.target.value,a=Number(n);u(Object(j.a)(Object(j.a)({},t),{},{amqpMessageExpirationMilliseconds:a}))}),[t,u]);return Object(y.jsxs)(L.a,{children:[Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerActionType",children:[Object(y.jsx)(L.a.Label,{children:"Action type"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"triggerActionType",disabled:n,value:O?"amqp":"http",onChange:k,children:[Object(y.jsx)("option",{value:"http",children:"HTTP request"}),Object(y.jsx)("option",{value:"amqp",children:"AMQP Message"})]})]})})}),f&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsx)(o.a,{sm:4,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerMethod",children:[Object(y.jsx)(L.a.Label,{children:"Method"}),Object(y.jsx)(L.a.Control,{as:"select",name:"triggerMethod",disabled:n,value:Y.a.get(t,"httpMethod")||"post",onChange:C,isInvalid:null!=Y.a.get(m,"httpMethod"),children:["delete","get","head","options","patch","post","put"].map((function(e){return Object(y.jsx)("option",{value:e,children:e.toUpperCase()},e)}))}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"httpMethod")})]})}),Object(y.jsx)(o.a,{sm:8,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerUrl",children:[Object(y.jsx)(L.a.Label,{children:"URL"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",required:!0,readOnly:n,value:Y.a.get(t,"httpUrl")||"",onChange:w,isInvalid:null!=Y.a.get(m,"httpUrl")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"httpUrl")})]})})]}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"actionIgnoreSSLErrors",children:[Object(y.jsx)(L.a.Check,{type:"checkbox",name:"actionIgnoreSSLErrors",label:"Ignore SSL errors",disabled:n,checked:Y.a.get(t,"ignoreSslErrors")||!1,onChange:N,isInvalid:null!=Y.a.get(m,"ignoreSslErrors")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"ignoreSslErrors")})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerTemplateType",children:[Object(y.jsx)(L.a.Label,{children:"Payload type"}),Object(y.jsxs)(L.a.Control,{as:"select",name:"triggerTemplateType",disabled:n,value:g,onChange:I,children:[Object(y.jsx)("option",{value:"default",children:"Use default event format (JSON)"}),Object(y.jsx)("option",{value:"mustache",children:"Mustache"})]})]})})}),"mustache"===g&&Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"actionPayload",children:[Object(y.jsx)(L.a.Label,{children:"Payload"}),Object(y.jsx)(L.a.Control,{as:"textarea",autoComplete:"off",rows:3,required:!0,readOnly:n,value:Y.a.get(t,"template")||"",onChange:_,isInvalid:null!=Y.a.get(m,"template")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"template")})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"actionHttpHeaders",children:[!n&&Object(y.jsxs)(q.a,{variant:"link",className:"p-0",onClick:function(){return i()},children:[Object(y.jsx)(ln,{icon:"add",className:"mr-2"}),"Add custom HTTP headers"]}),!Y.a.isEmpty(v)&&Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Header"}),Object(y.jsx)("th",{children:"Value"}),!n&&Object(y.jsx)("th",{className:"action-column",children:"Actions"})]})}),Object(y.jsx)("tbody",{children:Object.entries(v).map((function(e){var t=Object(h.a)(e,2),a=t[0],r=t[1];return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:a}),Object(y.jsx)("td",{children:r}),!n&&Object(y.jsxs)("td",{className:"text-center",children:[Object(y.jsx)(ln,{icon:"edit",onClick:function(){return s(a)},className:"color-grey mr-2"}),Object(y.jsx)(ln,{icon:"erase",onClick:function(){return d(a)}})]})]},a)}))})]}),Object(y.jsx)(L.a.Control,{className:"d-none",isInvalid:null!=Y.a.get(m,"httpStaticHeaders")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"httpStaticHeaders")})]})})})]}),O&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"amqpExchange",children:[Object(y.jsx)(L.a.Label,{children:"Exchange"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",placeholder:"astarte_events_".concat(b||"<realm-name>","_<exchange-name>"),required:!0,readOnly:n,value:Y.a.get(t,"amqpExchange")||"",onChange:S,isInvalid:null!=Y.a.get(m,"amqpExchange")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"amqpExchange")})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"amqpRoutingKey",children:[Object(y.jsx)(L.a.Label,{children:"Routing key"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",required:!0,readOnly:n,value:Y.a.get(t,"amqpRoutingKey")||"",onChange:A,isInvalid:null!=Y.a.get(m,"amqpRoutingKey")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"amqpRoutingKey")})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"amqpPersistency",children:[Object(y.jsx)(L.a.Label,{children:"Persistency"}),Object(y.jsx)(L.a.Check,{type:"checkbox",name:"amqpPersistency",label:"Publish persistent messages",disabled:n,checked:Y.a.get(t,"amqpMessagePersistent")||!1,onChange:R,isInvalid:null!=Y.a.get(m,"amqpMessagePersistent")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"amqpMessagePersistent")})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"amqpPriority",children:[Object(y.jsx)(L.a.Label,{children:"Priority"}),Object(y.jsx)(L.a.Control,{type:"number",min:0,max:9,required:!0,readOnly:n,value:Y.a.get(t,"amqpMessagePriority")||0,onChange:T,isInvalid:null!=Y.a.get(m,"amqpMessagePriority")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"amqpMessagePriority")})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"amqpExpiration",children:[Object(y.jsx)(L.a.Label,{children:"Expiration"}),Object(y.jsxs)(U.a,{children:[Object(y.jsx)(L.a.Control,{type:"number",min:1,required:!0,readOnly:n,value:Y.a.get(t,"amqpMessageExpirationMilliseconds")||0,onChange:D,isInvalid:null!=Y.a.get(m,"amqpMessageExpirationMilliseconds")}),Object(y.jsx)(U.a.Append,{children:Object(y.jsx)(U.a.Text,{children:"milliseconds"})}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"amqpMessageExpirationMilliseconds")})]})]})})}),Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"actionAmqpHeaders",children:[!n&&Object(y.jsxs)(q.a,{variant:"link",className:"p-0",onClick:function(){return r()},children:[Object(y.jsx)(ln,{icon:"add",className:"mr-2"}),"Add static AMQP headers"]}),!Y.a.isEmpty(x)&&Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Header"}),Object(y.jsx)("th",{children:"Value"}),!n&&Object(y.jsx)("th",{className:"action-column",children:"Actions"})]})}),Object(y.jsx)("tbody",{children:Object.entries(x).map((function(e){var t=Object(h.a)(e,2),a=t[0],r=t[1];return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:a}),Object(y.jsx)("td",{children:r}),!n&&Object(y.jsxs)("td",{className:"text-center",children:[Object(y.jsx)(ln,{icon:"edit",onClick:function(){return c(a)},className:"color-grey mr-2"}),Object(y.jsx)(ln,{icon:"erase",onClick:function(){return l(a)}})]})]},a)}))})]}),Object(y.jsx)(L.a.Control,{className:"d-none",isInvalid:null!=Y.a.get(m,"amqpStaticHeaders")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(m,"amqpStaticHeaders")})]})})})]})]})},La=n(254),Ua=n(644),Fa=[La],Ga={TextWidget:function(e){var t=e.id,n=e.required,a=e.readonly,r=e.disabled,i=e.placeholder,c=e.type,s=e.label,o=e.value,l=e.onChange,d=e.onBlur,u=e.onFocus,j=e.autofocus,h=e.options,b=e.schema,p=e.rawErrors,m=void 0===p?[]:p;return Object(y.jsxs)(L.a.Group,{className:"mb-0",children:[Object(y.jsx)(L.a.Label,{className:m.length>0?"text-danger":"",children:s||b.title}),Object(y.jsx)(L.a.Control,{id:t,autoFocus:j,required:n,disabled:r,readOnly:a,placeholder:i,className:m.length>0?"is-invalid":"",list:b.examples?"examples_".concat(t):void 0,type:c||b.type,value:o||0===o?o:"",onChange:function(e){var t=e.target.value;return l(""===t?h.emptyValue:t)},onBlur:function(e){var n=e.target.value;return d(t,n)},onFocus:function(e){var n=e.target.value;return u(t,n)}}),b.examples?Object(y.jsx)("datalist",{id:"examples_".concat(t),children:b.examples.concat(b.default?[b.default]:[]).map((function(e){return Object(y.jsx)("option",{value:e},e)}))}):null]})}},Ha=function(e){var t=e.cancelLabel,n=void 0===t?"Cancel":t,i=e.confirmLabel,c=void 0===i?"Confirm":i,s=e.confirmVariant,o=void 0===s?"primary":s,l=e.initialData,d=e.isConfirming,u=void 0!==d&&d,j=e.liveValidate,b=void 0!==j&&j,p=e.onCancel,m=e.onConfirm,f=e.schema,O=e.size,g=void 0===O?"lg":O,v=e.title,x=e.transformErrors,k=e.uiSchema,C=r.a.useState(l||null),w=Object(h.a)(C,2),N=w[0],I=w[1],_=Object(a.useState)(!1),S=Object(h.a)(_,2),A=S[0],R=S[1];return Object(y.jsxs)(E.a,{show:!0,centered:!0,size:g,onHide:p,children:[Object(y.jsx)(E.a.Header,{closeButton:!0,children:Object(y.jsx)(E.a.Title,{children:v})}),Object(y.jsx)(E.a.Body,{children:Object(y.jsx)("div",{children:Object(y.jsxs)(Ua.a,{schema:f,additionalMetaSchemas:Fa,uiSchema:k,widgets:Ga,formData:N,liveValidate:b||A,onChange:function(e){I(e.formData)},onSubmit:function(e){return m(e.formData)},showErrorList:!1,transformErrors:x,children:[Object(y.jsx)("hr",{style:{display:"block",marginLeft:"-1em",marginRight:"-1em"}}),Object(y.jsxs)("div",{className:"d-flex justify-content-end",children:[Object(y.jsx)(q.a,{variant:"secondary mr-2",onClick:p,style:{minWidth:"5em"},children:n}),Object(y.jsxs)(q.a,{type:"submit",variant:o,disabled:u,onClick:function(){return R(!0)},style:{minWidth:"5em"},children:[u&&Object(y.jsx)(Ln.a,{className:"mr-2",size:"sm",animation:"border",role:"status"}),c]})]})]})})})]})},$a={type:"object",required:["key"],properties:{key:{title:"Header",type:"string"},value:{title:"Value",type:"string"}}},Va=function(e){var t=e.onCancel,n=e.onConfirm;return Object(y.jsx)(Ha,{title:"Add Custom AMQP Header",schema:$a,onCancel:t,onConfirm:n})},Ba={type:"object",required:["key"],properties:{key:{title:"Header",type:"string"},value:{title:"Value",type:"string"}}},za=function(e){var t=e.onCancel,n=e.onConfirm;return Object(y.jsx)(Ha,{title:"Add Custom HTTP Header",schema:Ba,onCancel:t,onConfirm:n})},Ka={type:"object",properties:{value:{title:"Value",type:"string"}}},Ja=function(e){var t=e.targetHeader,n=e.onCancel,a=e.onConfirm;return Object(y.jsx)(Ha,{title:'Edit Value for Header "'.concat(t,'"'),schema:Ka,onCancel:n,onConfirm:a})},Wa={type:"object",properties:{value:{title:"Value",type:"string"}}},Za=function(e){var t=e.targetHeader,n=e.onCancel,a=e.onConfirm;return Object(y.jsx)(Ha,{title:'Edit Value for Header "'.concat(t,'"'),schema:Wa,onCancel:n,onConfirm:a})},Ya=function(e){var t=e.targetHeader,n=e.onCancel,a=e.onConfirm;return Object(y.jsx)(ma,{title:"Remove Header",confirmLabel:"Remove header",confirmVariant:"danger",onCancel:n,onConfirm:a,children:Object(y.jsxs)("p",{children:['Remove static header "',t,'"?']})})},Qa=function(e){var t=e.targetHeader,n=e.onCancel,a=e.onConfirm;return Object(y.jsx)(ma,{title:"Remove Header",confirmLabel:"Remove header",confirmVariant:"danger",onCancel:n,onConfirm:a,children:Object(y.jsxs)("p",{children:['Remove custom header "',t,'"?']})})},Xa={name:"",action:{httpUrl:"",httpMethod:"post"},simpleTriggers:[{type:"data_trigger",on:"incoming_data",interfaceName:"*",matchPath:"/*",valueMatchOperator:"*"}]},er=function(e){return JSON.stringify(e,null,4)},tr=function(e,t){return Y.a.mapKeys(Y.a.pickBy(e,(function(e,n){return n.startsWith(t)})),(function(e,n){return n.slice(t.length+1)}))},nr=function(e){var t=e.fetchInterfacesName,n=e.fetchInterfaceMajors,r=e.fetchInterface,i=e.initialData,c=e.isReadOnly,s=void 0!==c&&c,u=e.isSourceVisible,b=void 0!==u&&u,p=e.onChange,m=e.onError,f=e.realm,O=Object(a.useState)(i||Xa),g=Object(h.a)(O,2),v=g[0],x=g[1],k=Object(a.useState)(er(Xe.toJSON(v))),C=Object(h.a)(k,2),w=C[0],N=C[1],I=Object(a.useState)({}),_=Object(h.a)(I,2),S=_[0],A=_[1],R=Object(a.useState)(""),T=Object(h.a)(R,2),D=T[0],M=T[1],P=Object(a.useState)([]),q=Object(h.a)(P,2),E=q[0],U=q[1],G=Object(a.useState)([]),$=Object(h.a)(G,2),V=$[0],B=$[1],K=Object(a.useState)(null),J=Object(h.a)(K,2),W=J[0],Z=J[1],Q=Object(a.useState)(!1),X=Object(h.a)(Q,2),ee=X[0],te=X[1],ne=Object(a.useState)(!1),ae=Object(h.a)(ne,2),re=ae[0],ie=ae[1],ce=Object(a.useState)(!1),se=Object(h.a)(ce,2),oe=se[0],le=se[1],de=Object(a.useState)(null),ue=Object(h.a)(de,2),je=ue[0],he=ue[1],be=Object(a.useMemo)((function(){return tr(S,"action")}),[S]),pe=Object(a.useMemo)((function(){return tr(S,"simpleTriggers[0]")}),[S]),me=Object(a.useCallback)(Object(z.a)(H.a.mark((function e(){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return te(!0),n=[],e.prev=2,e.next=5,t();case 5:n=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),m&&m("Could not retrieve major versions for interface: ".concat(e.t0.message),e.t0);case 11:return U(n),te(!1),e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,null,[[2,8]])}))),[t,m]),fe=Object(a.useCallback)(function(){var e=Object(z.a)(H.a.mark((function e(t){var a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ie(!0),a=[],e.prev=2,e.next=5,n(t);case 5:a=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),m&&m("Could not retrieve major versions for ".concat(t," interface: ").concat(e.t0.message),e.t0);case 11:return B(a),ie(!1),e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[n,m]),Oe=Object(a.useCallback)(function(){var e=Object(z.a)(H.a.mark((function e(t){var n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return le(!0),n=null,e.prev=2,e.next=5,r(t);case 5:n=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),m&&m("Could not retrieve selected interface ".concat(t.interfaceName," v").concat(t.interfaceMajor,": ").concat(e.t0.message),e.t0);case 11:return Z(n),le(!1),e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[r,m]),ge=Object(a.useCallback)(function(){var e=Object(z.a)(H.a.mark((function e(t){var n,a,r,i;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me();case 2:if("*"!==(n=Y.a.get(t,"simpleTriggers[0].interfaceName"))){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,fe(n);case 7:if(a=e.sent,null!=(r=Y.a.get(t,"simpleTriggers[0].interfaceMajor"))){e.next=14;break}if(0!==a.length){e.next=12;break}return e.abrupt("return",t);case 12:r=Math.max.apply(Math,Object(En.a)(a)),Y.a.set(t,"simpleTriggers[0].interfaceMajor",r);case 14:return i=r,e.next=17,Oe({interfaceName:n,interfaceMajor:i});case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[me,fe,Oe]),ve=Object(a.useCallback)((function(e){x((function(t){return Object(j.a)(Object(j.a)({},t),{},{simpleTriggers:[e]})})),"data_trigger"===e.type&&"*"!==e.interfaceName||Z(null)}),[]),xe=Object(a.useCallback)((function(e){return x((function(t){return Object(j.a)(Object(j.a)({},t),{},{action:e})}))}),[]),ye=Object(a.useCallback)((function(e){x((function(t){var n=Y.a.get(t.action,"amqpStaticHeaders")||{},a=Y.a.omitBy(Object(j.a)(Object(j.a)({},n),e),Y.a.isUndefined);return Object(j.a)(Object(j.a)({},t),{},{action:Object(j.a)(Object(j.a)({},t.action),{},{amqpStaticHeaders:a})})}))}),[]),ke=Object(a.useCallback)((function(e){x((function(t){var n=Y.a.get(t.action,"httpStaticHeaders")||{},a=Y.a.omitBy(Object(j.a)(Object(j.a)({},n),e),Y.a.isUndefined);return Object(j.a)(Object(j.a)({},t),{},{action:Object(j.a)(Object(j.a)({},t.action),{},{httpStaticHeaders:a})})}))}),[]),Ce=Object(a.useCallback)((function(e){var t=e.target.value;x((function(e){return Object(j.a)(Object(j.a)({},e),{},{name:t})}))}),[]),we=Object(a.useCallback)((function(){return he(null)}),[]),Ne=Object(a.useCallback)((function(){he({modal:"new-amqp-header"})}),[]),Ie=Object(a.useCallback)((function(e){ye(Object(F.a)({},e.key,e.value||"")),we()}),[]),_e=Object(a.useCallback)((function(e){he({modal:"edit-amqp-header",header:e})}),[]),Se=Object(a.useCallback)((function(e){null!=je&&"edit-amqp-header"===je.modal&&ye(Object(F.a)({},je.header,e.value||"")),we()}),[je]),Ae=Object(a.useCallback)((function(e){he({modal:"remove-amqp-header",header:e})}),[]),Re=Object(a.useCallback)((function(){null!=je&&"remove-amqp-header"===je.modal&&ye(Object(F.a)({},je.header,void 0)),we()}),[je]),Te=Object(a.useCallback)((function(){he({modal:"new-http-header"})}),[]),De=Object(a.useCallback)((function(e){ke(Object(F.a)({},e.key,e.value||"")),we()}),[]),Me=Object(a.useCallback)((function(e){he({modal:"edit-http-header",header:e})}),[]),Pe=Object(a.useCallback)((function(e){null!=je&&"edit-http-header"===je.modal&&ke(Object(F.a)({},je.header,e.value||"")),we()}),[je]),qe=Object(a.useCallback)((function(e){he({modal:"remove-http-header",header:e})}),[]),Ee=Object(a.useCallback)((function(){null!=je&&"remove-http-header"===je.modal&&ke(Object(F.a)({},je.header,void 0)),we()}),[je]),Le=Object(a.useCallback)((function(e){var t=e.target.value;N(t);var n=null;try{n=JSON.parse(t)}catch(r){n=null}if(n){var a=null;try{a=Xe.fromJSON(n)}catch(i){a=null}a?"data_trigger"===Y.a.get(a,"simpleTriggers[0].type")?ge(a).then(x):x(a):M("Invalid Trigger")}else M("Invalid JSON")}),[]);return Object(a.useEffect)((function(){var e=er(Xe.toJSON(v));N((function(t){return function(e){try{return er(JSON.parse(e))}catch(t){return e}}(t)!==e?e:t}));var t={};try{Xe.validation.validateSync(v,{abortEarly:!1,context:{realm:f,interface:W}})}catch(a){t=Y.a.mapValues(Y.a.keyBy(Y.a.uniqBy(a.inner,"path"),"path"),"message")}if(A(t),M(Object.values(t).join(". ")),p){var n=Y.a.isEmpty(t);p(v,n)}}),[v,f,W]),Object(a.useEffect)((function(){i?ge(i):me()}),[]),Object(y.jsxs)(d.a,{children:[Object(y.jsx)(o.a,{md:b?6:12,children:Object(y.jsxs)(l.a,{fluid:!0,className:"bg-white rounded p-3",children:[Object(y.jsx)(L.a,{children:Object(y.jsx)(L.a.Row,{className:"mb-2",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerName",children:[Object(y.jsx)(L.a.Label,{children:"Name"}),Object(y.jsx)(L.a.Control,{type:"text",autoComplete:"off",required:!0,readOnly:s,value:Y.a.get(v,"name"),onChange:Ce,isInvalid:null!=Y.a.get(S,"name")}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:Y.a.get(S,"name")})]})})})}),Object(y.jsx)(Ma,{fetchInterface:Oe,fetchInterfaceMajors:fe,interfacesName:E,interfaceMajors:V,isLoadingInterface:oe,isLoadingInterfacesName:ee,isLoadingInterfaceMajors:re,isReadOnly:s,onChange:ve,simpleTrigger:v.simpleTriggers[0],simpleTriggerInterface:W,validationErrors:pe}),Object(y.jsx)(Ea,{action:v.action,isReadOnly:s,onAddAmqpHeader:Ne,onAddHttpHeader:Te,onEditAmqpHeader:_e,onEditHttpHeader:Me,onRemoveAmqpHeader:Ae,onRemoveHttpHeader:qe,onChange:xe,realm:f,validationErrors:be})]})}),b&&Object(y.jsx)(o.a,{md:6,children:Object(y.jsxs)(L.a.Group,{controlId:"triggerSource",className:"h-100 d-flex flex-column",children:[Object(y.jsx)(L.a.Control,{as:"textarea",className:"flex-grow-1 text-monospace",autoComplete:"off",spellCheck:!1,required:!0,readOnly:s,value:w,onChange:Le,isInvalid:!!D}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:D})]})}),null!=je&&"new-amqp-header"===je.modal&&Object(y.jsx)(Va,{onCancel:we,onConfirm:Ie}),null!=je&&"edit-amqp-header"===je.modal&&Object(y.jsx)(Ja,{targetHeader:je.header,onCancel:we,onConfirm:Se}),null!=je&&"remove-amqp-header"===je.modal&&Object(y.jsx)(Ya,{targetHeader:je.header,onCancel:we,onConfirm:Re}),null!=je&&"new-http-header"===je.modal&&Object(y.jsx)(za,{onCancel:we,onConfirm:De}),null!=je&&"edit-http-header"===je.modal&&Object(y.jsx)(Za,{targetHeader:je.header,onCancel:we,onConfirm:Pe}),null!=je&&"remove-http-header"===je.modal&&Object(y.jsx)(Qa,{targetHeader:je.header,onCancel:we,onConfirm:Ee})]})},ar=function(){var e=Object(a.useState)(null),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(h.a)(i,2),s=c[0],o=c[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),b=j[0],p=j[1],m=Object(a.useState)(!0),f=Object(h.a)(m,2),O=f[0],g=f[1],v=_(),x=Xn(),k=Object(wn.h)(),C=Object(a.useCallback)((function(){g((function(e){return!e}))}),[]),w=Object(a.useCallback)((function(e,t){r(e),o(t)}),[]),N=Object(a.useCallback)((function(){null==n||b||(p(!0),x.client.installTrigger(new Xe(n)).then((function(){k({pathname:"/triggers"})})).catch((function(e){v.showError("Could not install trigger: ".concat(e.message)),p(!1)})))}),[x.client,n,b,k,v.showError]),I=Object(a.useCallback)((function(e){v.showError(e)}),[v.showError]);return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsxs)("h2",{children:[Object(y.jsx)(ua,{href:"/triggers"}),"Trigger Editor"]}),Object(y.jsxs)("div",{className:"mt-4",children:[Object(y.jsx)(v.Alerts,{}),Object(y.jsx)(nr,{realm:x.realm,onChange:w,onError:I,isSourceVisible:O,fetchInterfacesName:x.client.getInterfaceNames,fetchInterfaceMajors:x.client.getInterfaceMajors,fetchInterface:x.client.getInterface}),Object(y.jsxs)(d.a,{className:"justify-content-end m-0 mt-3",children:[Object(y.jsxs)(q.a,{variant:"secondary",className:"mr-2",onClick:C,children:[O?"Hide":"Show"," source"]}),Object(y.jsxs)(q.a,{variant:"primary",onClick:N,disabled:b||!s,children:[b&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Install Trigger"]})]})]})]})},rr=function(e){var t=e.triggerName,n=e.onCancel,r=e.onConfirm,i=e.isDeletingTrigger,c=Object(a.useState)(""),s=Object(h.a)(c,2),o=s[0],l=s[1],d=o===t;return Object(y.jsxs)(ma,{title:"Confirmation Required",confirmVariant:"danger",onCancel:n,onConfirm:r,isConfirming:i,disabled:!d,children:[Object(y.jsxs)("p",{children:["You are going to remove\xa0",Object(y.jsx)("b",{children:t}),". This might cause data loss, removed triggers cannot be restored. Are you sure?"]}),Object(y.jsxs)("p",{children:["Please type ",Object(y.jsx)("b",{children:t})," to proceed."]}),Object(y.jsx)(L.a.Group,{controlId:"confirmTriggerName",children:Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Trigger Name",value:o,onChange:function(e){return l(e.target.value)}})})]})},ir=function(){var e=Object(a.useState)(!1),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!0),c=Object(h.a)(i,2),s=c[0],o=c[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),b=j[0],p=j[1],m=_(),f=Xn(),O=Object(wn.h)(),g=Object(wn.i)().triggerName,v=ta((function(){return f.client.getTrigger(g)})),x=Object(a.useCallback)((function(){o((function(e){return!e}))}),[]),k=Object(a.useCallback)((function(){p(!0)}),[]),C=Object(a.useCallback)((function(){p(!1)}),[]),w=Object(a.useCallback)((function(){r(!0),f.client.deleteTrigger(g).then((function(){O("/triggers")})).catch((function(e){m.showError("Could not delete trigger: ".concat(e.message)),r(!1),C()}))}),[f.client,g,O,m.showError]),N=Object(a.useCallback)((function(e){m.showError(e)}),[m.showError]);return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsxs)("h2",{children:[Object(y.jsx)(ua,{href:"/triggers"}),"Trigger Editor"]}),Object(y.jsxs)("div",{className:"mt-4",children:[Object(y.jsx)(m.Alerts,{}),Object(y.jsx)(na,{data:v.value,status:v.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load trigger source",onRetry:v.refresh}),children:function(e){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(nr,{initialData:e,isReadOnly:!0,onError:N,isSourceVisible:s,fetchInterfacesName:f.client.getInterfaceNames,fetchInterfaceMajors:f.client.getInterfaceMajors,fetchInterface:f.client.getInterface}),Object(y.jsxs)(d.a,{className:"justify-content-end m-0 mt-3",children:[Object(y.jsxs)(q.a,{variant:"secondary",className:"mr-2",onClick:x,children:[s?"Hide":"Show"," source"]}),Object(y.jsxs)(q.a,{variant:"danger",onClick:k,disabled:n,children:[n&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Delete trigger"]})]})]})}})]}),b&&Object(y.jsx)(rr,{triggerName:g,onCancel:C,onConfirm:w,isDeletingTrigger:n})]})},cr=function(e){var t=e.name,n=e.majors;return Object(y.jsx)(wa.a.Item,{children:Object(y.jsx)(l.a,{className:"p-0",fluid:!0,children:Object(y.jsxs)(d.a,{children:[Object(y.jsx)(o.a,{children:Object(y.jsxs)(s.b,{to:"/interfaces/".concat(t,"/").concat(Math.max.apply(Math,Object(En.a)(n)),"/edit"),children:[Object(y.jsx)(ln,{icon:"interfaces",className:"mr-2"}),t]})}),Object(y.jsx)(o.a,{md:"auto",children:n.map((function(e){return Object(y.jsx)(s.b,{to:"/interfaces/".concat(t,"/").concat(e,"/edit"),children:Object(y.jsxs)(P.a,{variant:e>0?"primary":"secondary",className:"mr-1 px-2 py-1",children:["v",e]})},e)}))})]})})})},sr=function(){return Object(y.jsx)(wa.a.Item,{children:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})})})},or=function(e){var t=e.onRetry;return Object(y.jsx)(wa.a.Item,{children:Object(y.jsx)(ha,{title:"Couldn't load available interfaces",onRetry:t})})},lr=function(){var e=Xn(),t=Object(wn.h)(),n=Object(a.useCallback)(Object(z.a)(H.a.mark((function t(){var n,a,r;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.client.getInterfaceNames();case 2:return n=t.sent,t.next=5,Promise.all(n.map((function(t){return e.client.getInterfaceMajors(t).then((function(e){return{name:t,majors:e.sort().reverse()}}))})));case 5:return a=t.sent,r=Y.a.sortBy(a,["name"]),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t)}))),[e.client]),r=ta(n);return v(r.refresh,3e4),Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsx)(d.a,{children:Object(y.jsx)(o.a,{children:Object(y.jsx)("h2",{children:"Interfaces"})})}),Object(y.jsx)(d.a,{className:"mt-3",children:Object(y.jsx)(o.a,{sm:12,children:Object(y.jsxs)(wa.a,{children:[Object(y.jsx)(wa.a.Item,{children:Object(y.jsxs)(q.a,{variant:"link",className:"p-0",onClick:function(){return t("/interfaces/new")},children:[Object(y.jsx)(ln,{icon:"add",className:"mr-2"}),"Install a new interface..."]})}),Object(y.jsx)(na,{data:r.value,status:r.status,fallback:Object(y.jsx)(sr,{}),errorFallback:Object(y.jsx)(or,{onRetry:r.refresh}),children:function(e){return Object(y.jsx)(y.Fragment,{children:e.map((function(e){var t=e.name,n=e.majors;return Object(y.jsx)(cr,{name:t,majors:n},t)}))})}})]})})})]})},dr=function(e){var t=e.interfaceName,n=e.interfaceMajor,r=e.onCancel,i=e.onConfirm,c=e.isDeletingInterface,s=Object(a.useState)(""),o=Object(h.a)(s,2),l=o[0],d=o[1],u=l===t;return Object(y.jsxs)(ma,{title:"Confirmation Required",confirmVariant:"danger",onCancel:r,onConfirm:i,isConfirming:c,disabled:!u,children:[Object(y.jsxs)("p",{children:["You are going to remove\xa0",Object(y.jsxs)("b",{children:[t," v",n]}),". This might cause data loss, removed interfaces cannot be restored. Are you sure?"]}),Object(y.jsxs)("p",{children:["Please type ",Object(y.jsx)("b",{children:t})," to proceed."]}),Object(y.jsx)(L.a.Group,{controlId:"confirmInterfaceName",children:Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Interface Name",value:l,onChange:function(e){return d(e.target.value)}})})]})},ur=function(){var e=Object(a.useState)(null),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(h.a)(i,2),s=c[0],o=c[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),b=j[0],p=j[1],m=Object(a.useState)(!1),f=Object(h.a)(m,2),O=f[0],g=f[1],v=Object(a.useState)(!0),x=Object(h.a)(v,2),k=x[0],C=x[1],w=Object(a.useState)(!1),N=Object(h.a)(w,2),I=N[0],S=N[1],A=Object(a.useState)(!1),R=Object(h.a)(A,2),T=R[0],D=R[1],M=_(),P=Xn(),E=Object(wn.h)(),L=Object(wn.i)(),U=L.interfaceName,F=parseInt(L.interfaceMajor,10),G=ta((function(){return P.client.getInterface({interfaceName:U,interfaceMajor:F})})),H=Object(a.useCallback)((function(){C((function(e){return!e}))}),[]),$=Object(a.useCallback)((function(){D(!0)}),[]),V=Object(a.useCallback)((function(){D(!1)}),[]),B=Object(a.useCallback)((function(){S(!0)}),[]),z=Object(a.useCallback)((function(){S(!1)}),[]),K=Object(a.useCallback)((function(e,t){r(e),o(t)}),[]),J=Object(a.useCallback)((function(){null!=n&&(p(!0),P.client.updateInterface(new Ge(n)).then((function(){M.showSuccess("Changes succesfully applied.")})).catch((function(e){M.showError("Could not update interface: ".concat(e.message))})).finally((function(){p(!1),V()})))}),[P.client,n,M.showSuccess,M.showError]),W=Object(a.useCallback)((function(){g(!0),P.client.deleteInterface(U,F).then((function(){E("/interfaces")})).catch((function(e){M.showError("Could not delete interface: ".concat(e.message)),g(!1),z()}))}),[P.client,U,F,E,M.showError]);Object(a.useEffect)((function(){null!=G.value&&r(G.value)}),[G.value]);var Z=null!=G.value&&null!=n&&s;return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsxs)("h2",{children:[Object(y.jsx)(ua,{href:"/interfaces"}),"Interface Editor"]}),Object(y.jsxs)("div",{className:"mt-4",children:[Object(y.jsx)(M.Alerts,{}),Object(y.jsx)(na,{data:G.value,status:G.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load interface properties",onRetry:G.refresh}),children:function(e){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(kn,{initialData:e,onChange:K,isSourceVisible:k,denyMajorChanges:!0}),Object(y.jsxs)(d.a,{className:"justify-content-end m-3",children:[Object(y.jsxs)(q.a,{variant:"secondary",className:"mr-2",onClick:H,children:[k?"Hide":"Show"," source"]}),0===e.major&&Object(y.jsxs)(q.a,{className:"mr-2",variant:"danger",onClick:O?void 0:B,disabled:O,children:[O&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Delete interface"]}),Object(y.jsxs)(q.a,{variant:"primary",onClick:b?void 0:$,disabled:b||!Z,children:[b&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Apply changes"]})]}),T&&Object(y.jsx)(ma,{title:"Confirmation Required",onCancel:V,onConfirm:J,isConfirming:b,children:Object(y.jsxs)("p",{children:["Update the interface ",Object(y.jsx)("b",{children:e.name}),"?"]})}),I&&Object(y.jsx)(dr,{onCancel:z,onConfirm:W,isDeletingInterface:O,interfaceName:U,interfaceMajor:F})]})}})]})]})},jr=function(e){var t=e.interfaceName,n=e.isDraft,a=e.onCancel,r=e.onConfirm,i=e.isInstallingInterface;return Object(y.jsxs)(ma,{title:"Confirmation Required",onCancel:a,onConfirm:r,isConfirming:i,children:[Object(y.jsxs)("p",{children:["You are about to install the interface ",Object(y.jsx)("b",{children:t}),"."]}),n?Object(y.jsxs)("p",{children:["As its major version is 0, this is a draft interface, which can be deleted.",Object(y.jsx)("br",{}),"In such a case, any data sent through this interface will be lost.",Object(y.jsx)("br",{}),"Draft Interfaces should be used for development and testing purposes only."]}):Object(y.jsx)("p",{children:"Interface major is greater than zero, that means you will not be able to change already installed mappings."}),Object(y.jsx)("p",{children:"Are you sure you want to continue?"})]})},hr=function(){var e=Object(a.useState)(null),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(h.a)(i,2),s=c[0],o=c[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),b=j[0],p=j[1],m=Object(a.useState)(!1),f=Object(h.a)(m,2),O=f[0],g=f[1],v=Object(a.useState)(!0),x=Object(h.a)(v,2),k=x[0],C=x[1],w=_(),N=Xn(),I=Object(wn.h)(),S=Object(a.useCallback)((function(){C((function(e){return!e}))}),[]),A=Object(a.useCallback)((function(e,t){r(e),o(t)}),[]),R=Object(a.useCallback)((function(){g(!0)}),[]),T=Object(a.useCallback)((function(){g(!1)}),[]),D=Object(a.useCallback)((function(){null==n||b||(p(!0),N.client.installInterface(new Ge(n)).then((function(){I({pathname:"/interfaces"})})).catch((function(e){w.showError("Could not install interface: ".concat(e.message)),p(!1),T()})))}),[N.client,n,b,I,T,w.showError]);return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsxs)("h2",{children:[Object(y.jsx)(ua,{href:"/interfaces"}),"Interface Editor"]}),Object(y.jsxs)("div",{className:"mt-4",children:[Object(y.jsx)(w.Alerts,{}),Object(y.jsx)(kn,{onChange:A,isSourceVisible:k}),Object(y.jsxs)(d.a,{className:"justify-content-end m-0 mt-3",children:[Object(y.jsxs)(q.a,{variant:"secondary",className:"mr-2",onClick:S,children:[k?"Hide":"Show"," source"]}),Object(y.jsxs)(q.a,{variant:"primary",onClick:R,disabled:b||!s,children:[b&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Install interface"]})]}),O&&Object(y.jsx)(jr,{onCancel:T,onConfirm:D,isInstallingInterface:b,interfaceName:Y.a.get(n,"name",""),isDraft:0===Y.a.get(n,"major",0)})]})]})},br=n(1444),pr=n(639),mr=n.n(pr),fr=(n(1019),function(e){var t=e.children,n=e.word;return n?Object(y.jsx)(y.Fragment,{children:t.split(n).map((function(e,t){return Object(y.jsxs)(r.a.Fragment,{children:[0!==t&&Object(y.jsx)("span",{className:"bg-warning text-dark",children:n},"word-".concat(t)),e]},t)}))}):Object(y.jsx)(y.Fragment,{children:t})}),Or=10,gr=function(e,t,n,a){return!(""!==n&&!e.includes(n))&&!(""!==a&&!t.includes(a))},vr=function(e){var t=e.filters,n=e.metadata,a=t.metadataKey,r=void 0===a?"":a,i=t.metadataValue,c=void 0===i?"":i;return""===r&&""===c?null:Object(y.jsx)(y.Fragment,{children:Array.from(n).filter((function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return gr(n,a,r,c)})).map((function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return Object(y.jsxs)("div",{style:{overflowWrap:"anywhere"},children:[Object(y.jsx)(fr,{word:r,children:n}),": ",Object(y.jsx)(fr,{word:c,children:a})]},n)}))})},xr=function(e){var t,n,a,r=e.device,i=e.filters;return r.isConnected?(n="statusConnected",a="Connected",t="Connected on ".concat(r.lastConnection.toLocaleString())):r.lastConnection?(n="statusDisconnected",a="Disconnected",t="Disconnected on ".concat(r.lastDisconnection.toLocaleString())):(n="statusNeverConnected",a="Never connected",t="Never connected"),Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)(ln,{icon:n,tooltip:a,tooltipPlacement:"right"})}),Object(y.jsxs)("td",{className:r.hasNameAlias?"":"text-monospace",children:[Object(y.jsx)(s.b,{to:"/devices/".concat(r.id,"/edit"),children:r.name}),Object(y.jsx)(vr,{filters:i,metadata:r.metadata})]}),Object(y.jsx)("td",{children:t})]})},yr=function(e){var t=e.deviceList,n=e.filters;return Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Status"}),Object(y.jsx)("th",{children:"Device handle"}),Object(y.jsx)("th",{children:"Last connection event"})]})}),Object(y.jsx)("tbody",{children:t.map((function(e){return Object(y.jsx)(xr,{device:e,filters:n},e.id)}))})]})},kr=function(e){var t=e.activePage,n=e.canLoadMorePages,a=e.lastPage,r=e.onPageChange;if(a<2)return null;var i=t+Math.floor(5.5);i<Or&&(i=Or),i>a&&(i=a);var c=i-Or;c<0&&(c=0);for(var s=[],o=function(e){s.push(Object(y.jsx)(br.a.Item,{active:e===t,onClick:function(){r(e)},children:e+1},e))},l=c;l<i;l+=1)o(l);return Object(y.jsxs)(br.a,{children:[c>0&&Object(y.jsx)(br.a.Prev,{onClick:function(){r(t-1)}}),s,(i<a||n)&&Object(y.jsx)(br.a.Next,{onClick:function(){r(t+1)}})]})},Cr=function(e){var t=e.filters,n=e.onUpdateFilters,a=t.deviceId,r=void 0===a?"":a,i=t.showConnected,c=void 0===i||i,s=t.showDisconnected,o=void 0===s||s,l=t.showNeverConnected,d=void 0===l||l,u=t.metadataKey,h=void 0===u?"":u,b=t.metadataValue,p=void 0===b?"":b,m=t.activeSinceDate;return Object(y.jsxs)(L.a,{className:"p-2",children:[Object(y.jsxs)(L.a.Group,{controlId:"filterId",className:"mb-4",children:[Object(y.jsx)(L.a.Label,{children:Object(y.jsx)("b",{children:"Device ID/name"})}),Object(y.jsx)(L.a.Control,{type:"text",value:r,onChange:function(e){return n(Object(j.a)(Object(j.a)({},t),{},{deviceId:e.target.value}))}})]}),Object(y.jsxs)(L.a.Group,{controlId:"filterStatus",className:"mb-4",children:[Object(y.jsx)(L.a.Label,{children:Object(y.jsx)("b",{children:"Device status"})}),Object(y.jsx)(L.a.Check,{type:"checkbox",id:"checkbox-connected",label:"Connected",checked:c,onChange:function(e){return n(Object(j.a)(Object(j.a)({},t),{},{showConnected:e.target.checked}))}}),Object(y.jsx)(L.a.Check,{type:"checkbox",id:"checkbox-disconnected",label:"Disconnected",checked:o,onChange:function(e){return n(Object(j.a)(Object(j.a)({},t),{},{showDisconnected:e.target.checked}))}}),Object(y.jsx)(L.a.Check,{type:"checkbox",id:"checkbox-never-connected",label:"Never connected",checked:d,onChange:function(e){return n(Object(j.a)(Object(j.a)({},t),{},{showNeverConnected:e.target.checked}))}})]}),Object(y.jsxs)(L.a.Group,{controlId:"filterActiveSince",className:"mb-4",children:[Object(y.jsx)(L.a.Label,{children:Object(y.jsx)("b",{children:"Active since"})}),Object(y.jsx)("div",{className:"d-block",children:Object(y.jsx)(mr.a,{maxDate:new Date,selected:m,onChange:function(e){return n(Object(j.a)(Object(j.a)({},t),{},{activeSinceDate:e,showConnected:!0,showDisconnected:!0,showNeverConnected:!0}))},customInput:Object(y.jsx)(L.a.Control,{type:"search"})})})]}),Object(y.jsx)("div",{className:"mb-2",children:Object(y.jsx)("b",{children:"Metadata"})}),Object(y.jsxs)(L.a.Group,{controlId:"filterMetadataKey",className:"mb-2",children:[Object(y.jsx)(L.a.Label,{children:"Key"}),Object(y.jsx)(L.a.Control,{type:"text",value:h,onChange:function(e){return n(Object(j.a)(Object(j.a)({},t),{},{metadataKey:e.target.value}))}})]}),Object(y.jsxs)(L.a.Group,{controlId:"filterMetadataValue",className:"mb-4",children:[Object(y.jsx)(L.a.Label,{children:"Value"}),Object(y.jsx)(L.a.Control,{type:"text",value:p,onChange:function(e){return n(Object(j.a)(Object(j.a)({},t),{},{metadataValue:e.target.value}))}})]})]})},wr=function(){var e=Object(a.useState)(0),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!0),c=Object(h.a)(i,2),s=c[0],u=c[1],j=Object(a.useState)({}),b=Object(h.a)(j,2),p=b[0],m=b[1],f=Object(wn.h)(),O=Xn(),g=_(),v=Object(a.useCallback)(Object(z.a)(H.a.mark((function e(){var t,a,r,i,c,s,o=arguments;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.next=3,O.client.getDevices({details:!0,from:t.fromToken,limit:100});case 3:if(a=e.sent,r=a.devices,i=a.nextToken,c=(t.previousDevices||[]).concat(r),s=Math.ceil(c.length/20),!(s<n+Or||!!t.fetchAll)||!i){e.next=11;break}return e.abrupt("return",v({fromToken:i,fetchAll:t.fetchAll,previousDevices:c}));case 11:return e.abrupt("return",{devices:c,nextToken:i});case 12:case"end":return e.stop()}}),e)}))),[O.client]),x=ta(v,{}),k=Object(a.useMemo)((function(){if(null==x.value)return Y.a.chunk([],20);var e=x.value.devices.filter((function(e){return function(e,t){var n=t.deviceId,a=void 0===n?"":n,r=t.metadataKey,i=void 0===r?"":r,c=t.metadataValue,s=void 0===c?"":c,o=t.showConnected,l=void 0===o||o,d=t.showDisconnected,u=void 0===d||d,j=t.showNeverConnected,b=void 0===j||j,p=t.activeSinceDate;if(null!=p&&!e.isConnected&&(null==e.lastDisconnection||e.lastDisconnection<p))return!1;if(!l&&e.isConnected)return!1;if(!u&&!e.isConnected&&e.lastConnection)return!1;if(!b&&!e.isConnected&&!e.lastConnection)return!1;if((""!==i||""!==s)&&!Array.from(e.metadata).some((function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return gr(n,a,i,s)})))return!1;if(""===a)return!0;var m=Array.from(e.aliases.values());return e.id.includes(a)||m.some((function(e){return e.includes(a)}))}(e,p)}));return Y.a.chunk(e,20)}),[x.value,p]),C=n<k.length&&k[n]||[],w=function(e){var t,n,a=null===(t=x.value)||void 0===t?void 0:t.nextToken,i=(null===(n=x.value)||void 0===n?void 0:n.devices)||[];e>k.length-Or&&a&&x.refresh({previousDevices:i,fromToken:a}),r(e)},N=function(e){var t,a;0!==n&&r(0);var i=null===(t=x.value)||void 0===t?void 0:t.nextToken,c=(null===(a=x.value)||void 0===a?void 0:a.devices)||[];i&&x.refresh({previousDevices:c,fromToken:i,fetchAll:!0}),m(e)};return Object(y.jsxs)(ja,{title:"Devices",children:[Object(y.jsx)(g.Alerts,{}),Object(y.jsx)(na,{data:x.value,status:x.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load the device list",onRetry:function(){return x.refresh()}}),children:function(e){var t=e.devices,a=e.nextToken;return 0===t.length?Object(y.jsx)("p",{children:"No registered devices"}):Object(y.jsx)(y.Fragment,{children:Object(y.jsxs)(l.a,{fluid:!0,children:[Object(y.jsxs)(d.a,{children:[Object(y.jsx)(o.a,{children:0===C.length?Object(y.jsx)("p",{children:"No device matches current filters"}):Object(y.jsx)(yr,{deviceList:C,filters:p})}),Object(y.jsxs)(o.a,{xs:"auto",className:"p-1",children:[Object(y.jsxs)("div",{className:"p-2 mb-2",onClick:function(){return u(!s)},children:[Object(y.jsx)(ln,{icon:"filter",className:"mr-1"}),s&&Object(y.jsx)("b",{children:"Filters"})]}),s&&Object(y.jsx)(Cr,{filters:p,onUpdateFilters:N})]})]}),Object(y.jsxs)(d.a,{children:[Object(y.jsx)(o.a,{}),Object(y.jsx)(o.a,{children:Object(y.jsx)(kr,{activePage:n,canLoadMorePages:!!a,lastPage:k.length,onPageChange:w})}),Object(y.jsx)(o.a,{})]})]})})}}),Object(y.jsx)(q.a,{variant:"primary",onClick:function(){f("/devices/register")},children:"Register a new device"})]})},Nr=n(1442),Ir=function(){var e,t,n=[];for(e="A".charCodeAt(0),t=0;t<26;t+=1)n.push(String.fromCharCode(e+t));for(e="a".charCodeAt(0),t=0;t<26;t+=1)n.push(String.fromCharCode(e+t));for(e="0".charCodeAt(0),t=0;t<10;t+=1)n.push(String.fromCharCode(e+t));return n.push("-"),n.push("_"),n}();function _r(e){var t=e.map((function(e){return e.toString(2)})),n="0".padEnd(6-8*e.length%6,"0");return((t.map((function(e){return e.padStart(8,"0")})).join("")+n).match(/.{6}/g)||[]).map((function(e){return Ir[parseInt(e,2)]})).join("")}function Sr(){var e=document.querySelector("#secret-code");if(null!=e){var t=window.getSelection();if(null!=t){t.rangeCount>0&&t.removeAllRanges();var n=document.createRange();n.selectNode(e),t.addRange(n),document.execCommand("copy")}}}var Ar=function(e){e.sm;var t=e.className,n=void 0===t?"":t,a=Object(u.a)(e,["sm","className"]);return Object(y.jsx)(o.a,Object(j.a)({sm:"auto",className:"col-no-label ".concat(n)},a))},Rr=function(e){var t=e.interfaceDescriptor,n=e.onRemove;return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:t.name}),Object(y.jsx)("td",{children:t.major}),Object(y.jsx)("td",{children:t.minor}),Object(y.jsx)("td",{children:Object(y.jsx)(ln,{icon:"erase",onClick:n})})]})},Tr=function(e){var t=e.onAddInterface,n={name:"",major:0,minor:1},r=Object(a.useState)(n),i=Object(h.a)(r,2),c=i[0],s=i[1];return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Interface name",value:c.name,onChange:function(e){var t=e.target.value;s((function(e){return Object(j.a)(Object(j.a)({},e),{},{name:t})}))}})}),Object(y.jsx)("td",{children:Object(y.jsx)(L.a.Control,{type:"number",min:"0",value:c.major,onChange:function(e){var t=e.target.value;s((function(e){return Object(j.a)(Object(j.a)({},e),{},{major:parseInt(t,10)||0})}))}})}),Object(y.jsx)("td",{children:Object(y.jsx)(L.a.Control,{type:"number",min:"0",value:c.minor,onChange:function(e){var t=e.target.value;s((function(e){return Object(j.a)(Object(j.a)({},e),{},{minor:parseInt(t,10)||0})}))}})}),Object(y.jsx)("td",{children:Object(y.jsx)(q.a,{variant:"secondary",disabled:""===c.name,onClick:function(){t(c),s(n)},children:"Add"})})]})},Dr=function(e){var t=e.interfaces,n=e.onAddInterface,a=e.onRemoveInterface;return Object(y.jsxs)(Un.a,{className:"mb-4",responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Interface name"}),Object(y.jsx)("th",{children:"Major"}),Object(y.jsx)("th",{children:"Minor"}),Object(y.jsx)("th",{className:"action-column",children:" "})]})}),Object(y.jsxs)("tbody",{children:[Array.from(t).map((function(e){var t=Object(h.a)(e,2),n=t[0],r=t[1];return Object(y.jsx)(Rr,{interfaceDescriptor:r,onRemove:function(){return a(r)}},n)})),Object(y.jsx)(Tr,{onAddInterface:n})]})]})},Mr=function(e){var t=e.onCancel,n=e.onConfirm,r=Object(a.useCallback)((function(e){var t=_r(Object(Nr.a)(e.userString||"",e.userNamespace).replace(/-/g,"").match(/.{2}/g).map((function(e){return parseInt(e,16)})));n(t)}),[n]);return Object(y.jsx)(Ha,{title:"Generate from name",confirmLabel:"Generate ID",onCancel:t,onConfirm:r,schema:{type:"object",required:["userNamespace"],properties:{userNamespace:{title:"Namespace UUID in canonical text format",type:"string",pattern:"^[0-9a-fA-F]{8}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{12}$"},userString:{title:"Name",type:"string"}}},uiSchema:{userNamespace:{"ui:autofocus":!0,"ui:placeholder":"e.g.: 753ffc99-dd9d-4a08-a07e-9b0d6ce0bc82"},userString:{"ui:placeholder":"e.g.: my device"}},transformErrors:function(e){return e.map((function(e){return".userNamespace"===e.property&&"pattern"===e.name?Object(j.a)(Object(j.a)({},e),{},{message:"The namespace must be a valid UUID"}):e}))}})},Pr=function(){var e=new URLSearchParams(Object(wn.g)().search).get("deviceId")||"",t=Object(a.useState)(e),n=Object(h.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)(""),s=Object(h.a)(c,2),l=s[0],d=s[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),p=j[0],m=j[1],f=Object(a.useState)(new Map),O=Object(h.a)(f,2),g=O[0],v=O[1],x=Object(a.useState)(!1),k=Object(h.a)(x,2),C=k[0],w=k[1],N=Object(a.useState)(!1),I=Object(h.a)(N,2),S=I[0],A=I[1],R=Object(a.useState)(!1),T=Object(h.a)(R,2),D=T[0],M=T[1],P=_(),E=Xn(),U=Object(wn.h)(),F=function(e){for(var t="",n=0;n<e.length;n+=1)t+=Ir.indexOf(e[n]).toString(2).padStart(6,"0");var a=t.match(/.{1,8}/g);return a?a.map((function(e){return parseInt(e,2)})):[]}(r),G=17===F.length&&0===F[16],H=Object(a.useCallback)((function(){var e=_r(Object(b.a)().replace(/-/g,"").match(/.{2}/g).map((function(e){return parseInt(e,16)})));i(e)}),[]);return Object(y.jsxs)(ja,{title:"Register Device",backLink:"/devices",children:[Object(y.jsx)(P.Alerts,{}),Object(y.jsxs)(L.a,{onSubmit:function(e){e.preventDefault();var t=Object.fromEntries(g),n={deviceId:r,introspection:p?t:void 0};w(!0),E.client.registerDevice(n).then((function(e){var t=e.credentialsSecret;w(!1),d(t),M(!0)})).catch((function(e){w(!1),P.showError("Couldn't register device: ".concat(e.message))}))},children:[Object(y.jsxs)(L.a.Row,{className:"mb-2",children:[Object(y.jsxs)(L.a.Group,{as:o.a,controlId:"deviceIdInput",children:[Object(y.jsx)(L.a.Label,{children:"Device ID"}),Object(y.jsx)(L.a.Control,{type:"text",className:"text-monospace",placeholder:"Your device ID",value:r,onChange:function(e){return i(e.target.value)},autoComplete:"off",required:!0,isValid:""!==r&&G,isInvalid:""!==r&&!G}),Object(y.jsx)(L.a.Control.Feedback,{type:"invalid",children:"Device ID must be a unique 128 bit URL-encoded base64 (without padding) string."})]}),Object(y.jsxs)(L.a.Group,{as:Ar,children:[Object(y.jsx)(q.a,{variant:"secondary",className:"mx-1",onClick:H,children:"Generate random ID"}),Object(y.jsx)(q.a,{variant:"secondary",className:"mx-1",onClick:function(){return A(!0)},children:"Generate from name..."})]})]}),Object(y.jsx)(L.a.Group,{controlId:"sendIntrospectionInput",className:p?"mb-0":"",children:Object(y.jsx)(L.a.Check,{type:"checkbox",label:"Declare initial introspection",checked:p,onChange:function(e){return m(e.target.checked)}})}),p&&Object(y.jsx)(Dr,{interfaces:g,onAddInterface:function(e){var t=new Map(g);t.set(e.name,e),v(t)},onRemoveInterface:function(e){var t=new Map(g);t.delete(e.name),v(t)}}),Object(y.jsx)(L.a.Row,{className:"flex-row-reverse pr-2",children:Object(y.jsxs)(q.a,{variant:"primary",type:"submit",disabled:!G||C,children:[C&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Register device"]})})]}),S&&Object(y.jsx)(Mr,{onCancel:function(){return A(!1)},onConfirm:function(e){A(!1),i(e)}}),D&&Object(y.jsxs)(ma,{title:"Device Registered!",confirmLabel:"OK",onConfirm:function(){return U("/devices")},children:[Object(y.jsx)("span",{children:"The device credential secret is"}),Object(y.jsxs)("pre",{className:"my-2",children:[Object(y.jsx)("code",{id:"secret-code",className:"m-1 p-2 bg-light",style:{fontSize:"1.2em"},children:l}),Object(y.jsx)(ln,{icon:"copyPaste",onClick:Sr,style:{cursor:"copy"}})]}),Object(y.jsxs)("span",{children:["Please don't share the Credentials Secret, and ensure it is transferred securely to your Device.",Object(y.jsx)("br",{}),"Once the Device pairs for the first time, the Credentials Secret will be associated permanently to the Device and it won't be changeable anymore."]})]})]})},qr=function(e){var t=e.instance,n=e.onDelete;return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)(ln,{icon:"statusConnected",tooltip:"Running",tooltipPlacement:"right"})}),Object(y.jsx)("td",{children:Object(y.jsx)(s.b,{to:"/flows/".concat(t.name,"/edit"),children:t.name})}),Object(y.jsx)("td",{children:t.pipeline}),Object(y.jsx)("td",{children:Object(y.jsx)(ln,{icon:"delete",as:"button",tooltip:"Delete instance",tooltipPlacement:"left",onClick:function(){return n(t)}})})]})},Er=function(e){var t=e.instances,n=e.onDelete;return 0===t.length?Object(y.jsx)("p",{children:"No running flows"}):Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{className:"status-column",children:"Status"}),Object(y.jsx)("th",{children:"Flow Name"}),Object(y.jsx)("th",{children:"Pipeline"}),Object(y.jsx)("th",{className:"action-column",children:"Actions"})]})}),Object(y.jsx)("tbody",{children:t.map((function(e){return Object(y.jsx)(qr,{instance:e,onDelete:n},e.name)}))})]})},Lr=function(){var e=Object(a.useState)(null),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(h.a)(i,2),s=c[0],o=c[1],d=_(),u=Object(wn.h)(),j=Xn(),b=Object(a.useCallback)(Object(z.a)(H.a.mark((function e(){var t,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.client.getFlowInstances();case 2:return t=e.sent,e.next=5,Promise.all(t.map((function(e){return j.client.getFlowDetails(e)})));case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)}))),[j.client]),p=ta(b),m=Object(a.useCallback)((function(e){r(e.name)}),[r]),f=Object(a.useCallback)((function(){var e=n;o(!0),j.client.deleteFlowInstance(e).then((function(){r(null),o(!1),p.refresh()})).catch((function(e){o(!1),d.showError("Could not delete flow instance: ".concat(e.message))}))}),[j.client,n,r,o,p.refresh,d.showError]),O=Object(a.useCallback)((function(){r(null)}),[r]);return Object(y.jsxs)(ja,{title:"Running Flows",children:[Object(y.jsx)(d.Alerts,{}),Object(y.jsx)(na,{data:p.value,status:p.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load flow instances",onRetry:p.refresh}),children:function(e){return Object(y.jsx)(Er,{instances:e,onDelete:m})}}),Object(y.jsx)(q.a,{variant:"primary",onClick:function(){return u("/pipelines")},children:"New flow"}),null!=n&&Object(y.jsx)(ma,{title:"Warning",confirmLabel:"Remove",confirmVariant:"danger",onCancel:O,onConfirm:f,isConfirming:s,children:Object(y.jsxs)("p",{children:["Delete flow ",Object(y.jsx)("b",{children:n}),"?"]})})]})},Ur=n(1439),Fr=function(){var e=Object(wn.i)().flowName,t=Xn(),n=ta((function(){return t.client.getFlowDetails(e)}));return Object(y.jsx)(ja,{title:"Flow Details",backLink:"/flows",children:Object(y.jsx)(na,{data:n.value,status:n.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load flow description",onRetry:n.refresh}),children:function(e){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{children:"Flow configuration"}),Object(y.jsx)(Ur.a,{language:"json",showLineNumbers:!0,children:JSON.stringify(e,null,4)})]})}})})},Gr=function(){var e=Object(s.c)(),t=Object(h.a)(e,1)[0].get("pipelineId")||"",n=Object(a.useState)({name:"",config:"{}"}),r=Object(h.a)(n,2),i=r[0],c=r[1],o=Object(a.useState)(!1),l=Object(h.a)(o,2),d=l[0],u=l[1],b=Object(wn.h)(),p=Xn(),m=Object(a.useMemo)((function(){try{return JSON.parse(i.config)}catch(e){return null}}),[i.config]),f=_(),O=Object(a.useCallback)((function(){u(!0),p.client.createNewFlowInstance({name:i.name,config:m,pipeline:t}).then((function(){b("/flows")})).catch((function(e){u(!1),f.showError("Couldn't instantiate the Flow: ".concat(e.message))}))}),[u,i,m,t,p.client,b,f.showError]),g=""!==i.name&&null!=m,v=Object(y.jsxs)(L.a,{children:[Object(y.jsxs)(L.a.Group,{controlId:"flowNameInput",children:[Object(y.jsx)(L.a.Label,{children:"Name"}),Object(y.jsx)(L.a.Control,{type:"text",placeholder:"Your flow name",value:i.name,onChange:function(e){return c(Object(j.a)(Object(j.a)({},i),{},{name:e.target.value}))}})]}),Object(y.jsx)("label",{children:"Pipeline ID"}),Object(y.jsx)("p",{children:Object(y.jsx)("i",{children:t})}),Object(y.jsxs)(L.a.Group,{controlId:"flowConfigInput",children:[Object(y.jsx)(L.a.Label,{children:"Flow config"}),Object(y.jsx)(L.a.Control,{as:"textarea",rows:12,value:i.config,onChange:function(e){return c(Object(j.a)(Object(j.a)({},i),{},{config:e.target.value}))}})]}),Object(y.jsxs)(q.a,{variant:"primary",disabled:!g||d,onClick:O,children:[d&&Object(y.jsx)(Ln.a,{className:"mr-2",size:"sm",animation:"border",role:"status"}),"Instantiate Flow"]})]});return Object(y.jsxs)(ja,{title:"Flow Configuration",backLink:"/pipelines",children:[Object(y.jsx)(f.Alerts,{}),v]})},Hr=n(1436),$r=function(e){var t=e.onCreate;return Object(y.jsxs)(M.a,{className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"New Pipeline"}),Object(y.jsxs)(M.a.Body,{children:[Object(y.jsx)(M.a.Text,{children:"Create your custom pipeline"}),Object(y.jsx)(q.a,{variant:"secondary",onClick:t,children:"Create"})]})]})},Vr=function(e){var t=e.pipeline,n=e.onInstantiate,a=e.showLink;return Object(y.jsxs)(M.a,{className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:Object(y.jsx)(s.b,{to:a,children:t.name})}),Object(y.jsxs)(M.a.Body,{children:[Object(y.jsx)(M.a.Text,{children:t.description}),Object(y.jsx)(q.a,{variant:"primary",onClick:n,children:"Instantiate"})]})]})},Br=function(){var e=Xn(),t=ta(e.client.getPipelines),n=Object(wn.h)();return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsx)("h2",{children:"Pipelines"}),Object(y.jsxs)(Hr.a,{className:"mt-4",children:[Object(y.jsx)($r,{onCreate:function(){return n("/pipelines/new")}}),Object(y.jsx)(na,{data:t.value,status:t.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load available pipelines",onRetry:t.refresh}),children:function(e){return Object(y.jsx)(y.Fragment,{children:e.map((function(t,a){return Object(y.jsxs)(r.a.Fragment,{children:[a%2?Object(y.jsx)("div",{className:"w-100 d-none d-md-block"}):null,Object(y.jsx)(Vr,{pipeline:t,onInstantiate:function(){n("/flows/new?pipelineId=".concat(t.name))},showLink:"/pipelines/".concat(t.name,"/edit")}),a===e.length-1&&e.length%2===0?Object(y.jsx)("div",{className:"w-50 d-none d-md-block"}):null]},"fragment-".concat(a))}))})}})]})]})},zr=function(){var e=Object(wn.i)().pipelineId,t=Xn(),n=ta((function(){return t.client.getPipeline(e)})),r=Object(a.useState)(!1),i=Object(h.a)(r,2),c=i[0],s=i[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),b=j[0],p=j[1],m=_(),f=Object(wn.h)(),O=Object(a.useCallback)((function(){p(!0),t.client.deletePipeline(e).then((function(){return f("/pipelines")})).catch((function(e){m.showError("Couldn't delete pipeline: ".concat(e.message)),p(!1),s(!1)}))}),[t.client,e,f,m.showError]);return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(ja,{title:"Pipeline Details",backLink:"/pipelines",children:[Object(y.jsx)(m.Alerts,{}),Object(y.jsx)(na,{data:n.value,status:n.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load pipeline source",onRetry:n.refresh}),children:function(e){return Object(y.jsx)(d.a,{children:Object(y.jsxs)(o.a,{children:[Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Name"}),Object(y.jsx)("p",{children:e.name}),e.description&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Description"}),Object(y.jsx)("p",{children:e.description})]}),Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Source"}),Object(y.jsx)(Ur.a,{language:"text",showLineNumbers:!0,children:e.source}),!Y.a.isEmpty(e.schema)&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Schema"}),Object(y.jsx)(Ur.a,{language:"json",showLineNumbers:!0,children:JSON.stringify(e.schema,null,2)})]})]})})}})]}),"ok"===n.status&&Object(y.jsx)(d.a,{className:"justify-content-end m-3",children:Object(y.jsxs)(q.a,{variant:"danger",onClick:function(){return s(!0)},disabled:b,children:[b&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Delete pipeline"]})}),c&&Object(y.jsx)(ma,{title:"Warning",confirmLabel:"Remove",confirmVariant:"danger",onCancel:function(){return s(!1)},onConfirm:O,isConfirming:b,children:Object(y.jsxs)("p",{children:["Delete pipeline ",Object(y.jsx)("b",{children:e}),"?"]})})]})},Kr=n(259),Jr=n.n(Kr),Wr=n(34),Zr=n(69),Yr=n.n(Zr),Qr=n(186),Xr=n(386),ei=n(77);function ti(e){if(Array.isArray(e)){var t=e.map((function(e){return ti(e)}));return"[".concat(t.join(","),"]")}if("object"===typeof e&&null!=e){var n=Object.entries(e).map((function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return"".concat(n,": ").concat(ti(a))}));return"{".concat(n.join(","),"}")}return"string"===typeof e?'"'.concat(e,'"'):e}var ni=function(e){Object(bt.a)(n,e);var t=Object(pt.a)(n);function n(e){var a,r,i,c=e.name,s=e.blockType,o=e.onSettingsClick,l=void 0===o?function(){}:o;if(Object(V.a)(this,n),(i=t.call(this,{type:"astarte-native"})).name=void 0,i.blockType=void 0,i.onSettingsClick=void 0,i.properties=void 0,i.inPorts=void 0,i.outPorts=void 0,i.outPorts=[],s.includes("producer")){var d=new Zr.DefaultPortModel({in:!1,name:"Out",label:"Out",alignment:Zr.PortModelAlignment.RIGHT});Object(Xr.a)((a=Object(Qr.a)(i),Object(ei.a)(n.prototype)),"addPort",a).call(a,d),i.outPorts.push(d)}if(i.inPorts=[],s.includes("consumer")){var u=new Zr.DefaultPortModel({in:!0,name:"In",label:"In",alignment:Zr.PortModelAlignment.LEFT});Object(Xr.a)((r=Object(Qr.a)(i),Object(ei.a)(n.prototype)),"addPort",r).call(r,u),i.inPorts.push(u)}return i.name=c,i.blockType=s,i.properties={},i.onSettingsClick=l,i}return Object(B.a)(n,[{key:"getInPorts",value:function(){return this.inPorts}},{key:"getOutPorts",value:function(){return this.outPorts}},{key:"getProperties",value:function(){return this.properties}},{key:"setProperties",value:function(e){this.properties=e}},{key:"toScript",value:function(){var e=Object.entries(this.properties).filter((function(e){return!function(e){return Array.isArray(e)?0===e.length:"object"===typeof e?Y.a.isEmpty(e):"string"===typeof e?""===e:!e}(Object(h.a)(e,2)[1])})).map((function(e){var t=Object(h.a)(e,2),n=t[0],a=t[1];return"\n    .".concat(n,"(").concat(ti(a),")")}));return"container"===this.name?this.name+e.concat('\n    .type("'.concat(this.blockType,'")')).join(""):"dynamic_virtual_device_pool"===this.name?"virtual_device_pool".concat(e.join("")):this.name+e.join("")}}]),n}(Zr.NodeModel),ai=function(e){var t=e.engine,n=e.node,a=e.hasSettings,r=n.name,i=n.getInPorts(),c=n.getOutPorts(),s=["native-node",n.blockType];return n.isSelected()&&s.push("selected"),Object(y.jsxs)("div",{className:s.join(" "),"data-default-node-name":r,children:[Object(y.jsxs)("div",{className:"node-header",children:[Object(y.jsx)("div",{className:"node-title",children:r}),a&&Object(y.jsx)("div",{className:"settings-icon",onClick:function(e){return n.onSettingsClick(e,n)},children:Object(y.jsx)(ln,{icon:"settings"})})]}),Object(y.jsxs)("div",{className:"ports",children:[Object(y.jsx)("div",{className:"port-container",children:i.map((function(e){return Object(y.jsx)(Zr.DefaultPortLabel,{engine:t,port:e},e.getOptions().id)}))}),Object(y.jsx)("div",{className:"port-container",children:c.map((function(e){return Object(y.jsx)(Zr.DefaultPortLabel,{engine:t,port:e},e.getOptions().id)}))})]})]})},ri=function(e){Object(bt.a)(n,e);var t=Object(pt.a)(n);function n(e){var a;return Object(V.a)(this,n),(a=t.call(this,"astarte-native")).blockDefinitions=void 0,a.blockDefinitions=new Map,a.updateDefinitions(e),a}return Object(B.a)(n,[{key:"generateReactWidget",value:function(e){var t=e.model,n=this.blockDefinitions.get("".concat(t.blockType,"-").concat(t.name));if(!n)return Object(y.jsx)(y.Fragment,{});var a=!Y.a.isEmpty(n.schema)&&!Y.a.isEmpty(n.schema.properties);return Object(y.jsx)(ai,{engine:this.engine,node:t,hasSettings:a})}},{key:"generateModel",value:function(e){var t=e.name,n=e.type,a=e.onSettingsClick,r=this.blockDefinitions.get("".concat(n,"-").concat(t));return new ni({name:r?r.name:t,blockType:r?r.type:n,onSettingsClick:a})}},{key:"updateDefinitions",value:function(e){e&&e.length>0?this.blockDefinitions=new Map(e.map((function(e){return["".concat(e.type,"-").concat(e.name),e]}))):this.blockDefinitions=new Map}}]),n}(Wr.AbstractReactFactory),ii=function(e,t){return e&&0!==e.length?e.filter((function(e){return e.type===t})).sort((function(e,t){return e.name>t.name?1:-1})):[]},ci=function(e){var t=e.block;return Object(y.jsx)("div",{className:"block-item ".concat(t.type),onDragStart:function(e){e.dataTransfer.setData("block-name",t.name),e.dataTransfer.setData("block-type",t.type)},draggable:!0,children:t.name})},si=function(e){var t=e.blocks;return Object(y.jsxs)("div",{className:"flow-editor-sidebar",children:[Object(y.jsx)("div",{className:"block-label",children:"Producer"}),ii(t,"producer").map((function(e){return Object(y.jsx)(ci,{block:e},e.name)})),Object(y.jsx)("div",{className:"block-label",children:"Producer & Consumer"}),ii(t,"producer_consumer").map((function(e){return Object(y.jsx)(ci,{block:e},e.name)})),Object(y.jsx)("div",{className:"block-label",children:"Consumer"}),ii(t,"consumer").map((function(e){return Object(y.jsx)(ci,{block:e},e.name)}))]})};var oi=function(e){var t=e.className,n=void 0===t?"":t,r=e.blocks,i=e.model,c=e.onNodeSettingsClick,s=Object(a.useState)(new ri(r)),o=Object(h.a)(s,1)[0],l=Object(a.useState)(function(e,t){var n=Yr()();return n.getNodeFactories().registerFactory(t),n.setModel(e),n}(i,o)),d=Object(h.a)(l,1)[0];Object(a.useEffect)((function(){o.updateDefinitions(r)}),[r]);var u=Object(a.useCallback)((function(e,t,n){var a=o.generateModel({name:e,type:t,onSettingsClick:c});a.setPosition(n.x-30,n.y-20),i.addNode(a),d.repaintCanvas()}),[c]);return Object(y.jsxs)("div",{className:["flow-editor",n].join(" "),children:[Object(y.jsx)(si,{blocks:r}),Object(y.jsx)("div",{className:"canvas-container",onDragOver:function(e){return e.preventDefault()},onDrop:function(e){var t=e.dataTransfer.getData("block-name"),n=e.dataTransfer.getData("block-type");u(t,n,d.getRelativeMousePoint(e))},children:Object(y.jsx)(Wr.CanvasWidget,{engine:d})})]})},li=new Jr.a({schemaId:"id"});li.addMetaSchema(La);var di=function(e){var t=e.className,n=void 0===t?"":t,a=e.children;return Object(y.jsx)("div",{className:["d-flex flex-row-reverse",n].join(" "),children:a})},ui=function(){var e=Object(a.useState)(new Zr.DiagramModel),t=Object(h.a)(e,1)[0],n=Object(a.useState)(!1),r=Object(h.a)(n,2),i=r[0],c=r[1],s=Object(a.useState)([]),o=Object(h.a)(s,2),l=o[0],d=o[1],u=Object(a.useState)(null),b=Object(h.a)(u,2),p=b[0],m=b[1],f=Object(a.useState)({name:"",description:"",source:"",schema:""}),O=Object(h.a)(f,2),g=O[0],v=O[1],x=_(),k=Xn(),C=Object(wn.h)();Object(a.useEffect)((function(){k.client.getBlocks().then((function(e){var t=e.find((function(e){return"container"===e.name&&"producer_consumer"===e.type}));if(t){var n=Y.a.merge({},t);Y.a.unset(n,"schema.properties.type");var a=Y.a.merge({},n,{type:"producer"}),r=Y.a.merge({},n,{type:"consumer"}),i=e.filter((function(e){return"container"!==e.name})).concat([n,r,a]);d(i)}else d(e)})).catch((function(e){x.showError("Couldn't retrieve block descriptions: ".concat(e.message))}))}),[k.client]);var w=Object(a.useMemo)((function(){if(""!==g.schema)try{return JSON.parse(g.schema)}catch(e){return}}),[g.schema]),N=Object(a.useCallback)((function(){c(!0),k.client.registerPipeline(new we({name:g.name,source:g.source,description:g.description,schema:w||{}})).then((function(){return C("/pipelines")})).catch((function(e){c(!1),x.showError("Couldn't create pipeline: ".concat(e.message))}))}),[k.client,C,c,x.showError,g,w]),I=Object(a.useMemo)((function(){if(!w)return!1;try{return li.compile(w),!0}catch(e){return!1}}),[w,li]),S=Object(a.useCallback)((function(e,n){var a=l.find((function(e){return n.name===e.name&&n.blockType===e.type}));a&&(t.setLocked(!0),m(Object(y.jsx)(Ha,{title:"Settings for ".concat(n.name),schema:a.schema,initialData:n.getProperties(),confirmLabel:"Apply settings",onCancel:function(){m(null),t.setLocked(!1)},onConfirm:function(e){n.setProperties(e),m(null),t.setLocked(!1)}})))}),[l]),A=""!==g.name,R=""!==g.source,T=A&&R;return Object(y.jsxs)(ja,{title:"New Pipeline",backLink:"/pipelines",docsLink:"https://docs.astarte-platform.org/flow/snapshot/",children:[Object(y.jsx)(x.Alerts,{}),Object(y.jsxs)(L.a,{children:[Object(y.jsxs)(L.a.Group,{controlId:"pipeline-name",children:[Object(y.jsx)(L.a.Label,{children:"Name"}),Object(y.jsx)(L.a.Control,{type:"text",value:g.name,onChange:function(e){return v(Object(j.a)(Object(j.a)({},g),{},{name:e.target.value}))}})]}),""===g.source?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(L.a.Group,{controlId:"pipeline-source",children:Object(y.jsx)(oi,{className:"mb-2",blocks:l,model:t,onNodeSettingsClick:S})}),Object(y.jsx)(di,{children:Object(y.jsx)(q.a,{variant:"primary",onClick:function(){try{var e=function(e){var t=new Set,n=[],a=e.getNodes().filter((function(e){return"producer"===e.blockType}));if(0===a.length)throw new Error("Pipelines must start with a producer block");if(a.length>1)throw new Error("Multiple producer blocks are not supported");var r=a[0];n.push(r),t.add(r.getOptions().id);var i,c=r,s=0;do{var o=Object.values(c.outPorts[0].links);if(0===o.length)throw new Error("Pipelines must end with a consumer block");if(o.length>1)throw new Error("Multiple out connections are not supported");if(i=o[0].getTargetPort().getParent(),t.has(i.getOptions().id))throw new Error("Pipelines cannot form a loop");if(n.push(i),t.add(i.getOptions().id),c=i,(s+=1)>50)throw new Error("Pipeline too long")}while("consumer"!==i.blockType);return n.map((function(e){return e.toScript()})).join("\n| ")}(t);v(Object(j.a)(Object(j.a)({},g),{},{source:e}))}catch(n){x.showError(n.message)}},children:"Generate pipeline source"})})]}):Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(L.a.Group,{controlId:"pipeline-source",children:[Object(y.jsx)(L.a.Label,{children:"Source"}),Object(y.jsx)(L.a.Control,{as:"textarea",rows:8,spellCheck:!1,value:g.source,onChange:function(e){return v(Object(j.a)(Object(j.a)({},g),{},{source:e.target.value}))}})]}),Object(y.jsxs)(L.a.Group,{controlId:"pipeline-schema",children:[Object(y.jsx)(L.a.Label,{children:"Schema"}),Object(y.jsx)(L.a.Control,{as:"textarea",rows:8,spellCheck:!1,value:g.schema,isValid:""!==g.schema&&I,isInvalid:""!==g.schema&&!I,onChange:function(e){return v(Object(j.a)(Object(j.a)({},g),{},{schema:e.target.value}))}})]}),Object(y.jsxs)(L.a.Group,{controlId:"pipeline-description",children:[Object(y.jsx)(L.a.Label,{children:"Description"}),Object(y.jsx)(L.a.Control,{as:"textarea",value:g.description,onChange:function(e){return v(Object(j.a)(Object(j.a)({},g),{},{description:e.target.value}))}})]}),Object(y.jsx)(di,{children:Object(y.jsxs)(q.a,{variant:"primary",onClick:N,disabled:!T||i,children:[i&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Create new pipeline"]})})]})]}),p]})};function ji(e){var t=e.onCreate;return Object(y.jsxs)(M.a,{className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"New Block"}),Object(y.jsxs)(M.a.Body,{children:[Object(y.jsx)(M.a.Text,{children:"Create your custom block"}),Object(y.jsx)(q.a,{variant:"secondary",onClick:t,children:"Create"})]})]})}var hi={consumer:"Consumer",producer:"Producer",producer_consumer:"Producer & Consumer"};function bi(e){var t=e.block,n=e.onShow;return Object(y.jsxs)(M.a,{className:"mb-4",children:[Object(y.jsxs)(M.a.Header,{as:"h5",className:"d-flex justify-content-between align-items-center",children:[Object(y.jsx)(q.a,{variant:"link",className:"p-0",onClick:n,children:t.name}),t instanceof X&&Object(y.jsx)(P.a,{variant:"secondary",className:"h6 text-light",children:"native"})]}),Object(y.jsxs)(M.a.Body,{children:[Object(y.jsx)(M.a.Text,{children:hi[t.type]}),Object(y.jsx)(q.a,{variant:"primary",onClick:n,children:"Show"})]})]})}var pi=function(){var e=Xn(),t=ta(e.client.getBlocks),n=Object(wn.h)();return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsx)("h2",{children:"Blocks"}),Object(y.jsxs)(Hr.a,{className:"mt-4",children:[Object(y.jsx)(ji,{onCreate:function(){return n("/blocks/new")}}),Object(y.jsx)(na,{data:t.value,status:t.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load available blocks",onRetry:t.refresh}),children:function(e){return Object(y.jsx)(y.Fragment,{children:e.map((function(t,a){return Object(y.jsxs)(r.a.Fragment,{children:[a%2?Object(y.jsx)("div",{className:"w-100 d-none d-md-block"}):null,Object(y.jsx)(bi,{block:t,onShow:function(){return n("/blocks/".concat(t.name,"/edit"))}}),a===e.length-1&&e.length%2===0?Object(y.jsx)("div",{className:"w-50 d-none d-md-block"}):null]},"fragment-".concat(a))}))})}})]})]})},mi={consumer:"Consumer",producer:"Producer",producer_consumer:"Producer & Consumer"},fi=function(){var e=Object(wn.i)().blockId,t=Xn(),n=ta((function(){return t.client.getBlock(e)})),r=Object(a.useState)(!1),i=Object(h.a)(r,2),c=i[0],s=i[1],u=Object(a.useState)(!1),j=Object(h.a)(u,2),b=j[0],p=j[1],m=_(),f=Object(wn.h)(),O=Object(a.useCallback)((function(){p(!0),t.client.deleteBlock(e).then((function(){return f("/blocks")})).catch((function(e){p(!1),m.showError("Couldn't delete block: ".concat(e.message)),s(!1)}))}),[t.client,f,p,e,m.showError]);return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(ja,{title:"Block Details",backLink:"/blocks",children:[Object(y.jsx)(m.Alerts,{}),Object(y.jsx)(na,{data:n.value,status:n.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load block source",onRetry:n.refresh}),children:function(e){return Object(y.jsx)(d.a,{children:Object(y.jsxs)(o.a,{children:[Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Name"}),Object(y.jsx)("p",{children:e.name}),Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Type"}),Object(y.jsx)("p",{children:mi[e.type]}),e instanceof Q&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Source"}),Object(y.jsx)(Ur.a,{language:"json",showLineNumbers:!0,children:e.source})]}),Object(y.jsx)("h5",{className:"mt-2 mb-2",children:"Schema"}),Object(y.jsx)(Ur.a,{language:"json",showLineNumbers:!0,children:JSON.stringify(e.schema,null,2)})]})})}})]}),"ok"===n.status&&n.value instanceof Q&&Object(y.jsx)(d.a,{className:"justify-content-end m-3",children:Object(y.jsxs)(q.a,{variant:"danger",onClick:function(){return s(!0)},disabled:b,children:[b&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Delete block"]})}),c&&Object(y.jsx)(ma,{title:"Warning",confirmLabel:"Remove",confirmVariant:"danger",onCancel:function(){return s(!1)},onConfirm:O,isConfirming:b,children:Object(y.jsxs)("p",{children:["Delete block ",Object(y.jsx)("b",{children:e}),"?"]})})]})},Oi=function(){var e=Object(a.useState)({name:"",source:"",type:"producer",schema:""}),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(h.a)(i,2),s=c[0],o=c[1],l=Object(a.useState)(!1),u=Object(h.a)(l,2),b=u[0],p=u[1],m=_(),f=Xn(),O=Object(wn.h)(),g=Object(a.useCallback)((function(){p(!0);var e=Object(j.a)(Object(j.a)({},n),{},{schema:JSON.parse(n.schema.trim())});f.client.registerBlock(e).then((function(){return O("/blocks")})).catch((function(e){p(!1),m.showError("Couldn't create block: ".concat(e.message))}))}),[f.client,n,m.showError,O]),v=/^[a-zA-Z][a-zA-Z0-9-_]*$/.test(n.name),x=""!==n.source,k=["producer","consumer","producer_consumer"].includes(n.type),C=function(e){try{return JSON.parse(e),!0}catch(t){return!1}}(n.schema.trim()),w=v&&x&&k&&C,N=Object(a.useCallback)((function(){o(!0),w&&g()}),[o,g,w]);return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(ja,{title:"New Block",backLink:"/blocks",children:[Object(y.jsx)(m.Alerts,{}),Object(y.jsxs)(L.a,{noValidate:!0,children:[Object(y.jsxs)(L.a.Group,{controlId:"block-name",children:[Object(y.jsx)(L.a.Label,{children:"Name"}),Object(y.jsx)(L.a.Control,{type:"text",value:n.name,onChange:function(e){return r(Object(j.a)(Object(j.a)({},n),{},{name:e.target.value}))},isValid:s&&v,isInvalid:s&&!v})]}),Object(y.jsxs)(L.a.Group,{controlId:"block-type",children:[Object(y.jsx)(L.a.Label,{children:"Type"}),Object(y.jsxs)(L.a.Control,{as:"select",custom:!0,value:n.type,onChange:function(e){return r(Object(j.a)(Object(j.a)({},n),{},{type:e.target.value}))},isValid:s&&k,isInvalid:s&&!k,children:[Object(y.jsx)("option",{value:"producer",children:"Producer"}),Object(y.jsx)("option",{value:"consumer",children:"Consumer"}),Object(y.jsx)("option",{value:"producer_consumer",children:"Producer & Consumer"})]})]}),Object(y.jsxs)(L.a.Group,{controlId:"block-source",children:[Object(y.jsx)(L.a.Label,{children:"Source"}),Object(y.jsx)(L.a.Control,{as:"textarea",rows:12,value:n.source,onChange:function(e){return r(Object(j.a)(Object(j.a)({},n),{},{source:e.target.value}))},isValid:s&&x,isInvalid:s&&!x})]}),Object(y.jsxs)(L.a.Group,{controlId:"block-schema",children:[Object(y.jsx)(L.a.Label,{children:"Schema"}),Object(y.jsx)(L.a.Control,{as:"textarea",rows:12,value:n.schema,onChange:function(e){return r(Object(j.a)(Object(j.a)({},n),{},{schema:e.target.value}))},isValid:s&&C,isInvalid:s&&!C})]})]})]}),Object(y.jsx)(d.a,{className:"justify-content-end m-3",children:Object(y.jsxs)(q.a,{variant:"primary",onClick:b?void 0:N,disabled:b||!w,children:[b&&Object(y.jsx)(Ln.a,{as:"span",size:"sm",animation:"border",role:"status",className:"mr-2"}),"Create new block"]})})]})},gi=function(e){var t=e.initialValues,n=e.onSubmit,r=e.isUpdatingSettings,i=Object(a.useState)(t),c=Object(h.a)(i,2),s=c[0],o=c[1],l=""!==s.publicKey.trim()&&s.publicKey!==t.publicKey;return Object(y.jsxs)(L.a,{children:[Object(y.jsxs)(L.a.Group,{controlId:"public-key",children:[Object(y.jsx)(L.a.Label,{children:"Public key"}),Object(y.jsx)(L.a.Control,{as:"textarea",className:"text-monospace",rows:16,value:s.publicKey,onChange:function(e){return o(Object(j.a)(Object(j.a)({},s),{},{publicKey:e.target.value}))}})]}),Object(y.jsxs)(q.a,{variant:"danger",disabled:!l||r,onClick:function(){return n(s)},children:[r&&Object(y.jsx)(Ln.a,{className:"mr-2",size:"sm",animation:"border",role:"status"}),"Change"]})]})},vi=function(){var e=Object(a.useState)(null),t=Object(h.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(h.a)(i,2),s=c[0],o=c[1],d=Object(a.useState)(!1),u=Object(h.a)(d,2),j=u[0],b=u[1],p=_(),m=Xn(),f=Object(wn.h)(),O=ta(m.client.getConfigAuth),g=Object(a.useCallback)((function(){return o(!0)}),[o]),v=Object(a.useCallback)((function(){return o(!1)}),[o]),x=Object(a.useCallback)((function(e){r(e),g()}),[r,g]),k=Object(a.useCallback)((function(){null!=n&&(b(!0),m.client.updateConfigAuth({publicKey:n.publicKey}).then((function(){f("/logout")})).catch((function(e){b(!1),v(),p.showError(e.message)})))}),[b,m.client,n,f,v,p.showError]);return Object(y.jsxs)(ja,{title:"Realm Settings",children:[Object(y.jsx)(p.Alerts,{}),Object(y.jsx)(na,{data:O.value,status:O.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load realm settings",onRetry:O.refresh}),children:function(e){var t=e.publicKey;return Object(y.jsx)(gi,{initialValues:{publicKey:t},onSubmit:x,isUpdatingSettings:j})}}),s&&Object(y.jsx)(ma,{title:"Confirm Public Key Update",confirmLabel:"Update settings",confirmVariant:"danger",onCancel:v,onConfirm:k,isConfirming:j,children:Object(y.jsx)("p",{children:"Realm public key will be changed, users will not be able to make further API calls using their current auth token. Confirm?"})})]})},xi=function(e){var t=e.children,n=e.className,a=Object(u.a)(e,["children","className"]);return Object(y.jsx)(o.a,Object(j.a)(Object(j.a)({className:n},a),{},{children:Object(y.jsx)(M.a,{className:"h-100",children:t})}))},yi=function(e){var t,n;switch(e.status){case"connected":t="Connected",n="statusConnected";break;case"disconnected":t="Disconnected",n="statusDisconnected";break;case"never_connected":default:t="Never connected",n="statusNeverConnected"}return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(ln,{icon:n,className:"mr-1"}),Object(y.jsx)("span",{children:t})]})},ki=function(e){var t=e.device,n=e.onInhibitCredentialsClick,a=e.onEnableCredentialsClick,r=e.onWipeCredentialsClick;return Object(y.jsxs)(xi,{xs:12,md:6,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Device Info"}),Object(y.jsxs)(M.a.Body,{className:"d-flex flex-column",children:[Object(y.jsx)("h6",{children:"Device ID"}),Object(y.jsx)("p",{className:"text-monospace",children:t.id}),Object(y.jsx)("h6",{children:"Device name"}),Object(y.jsx)("p",{children:t.hasNameAlias?t.name:"No name alias set"}),Object(y.jsx)("h6",{children:"Status"}),Object(y.jsx)("p",{children:Object(y.jsx)(yi,{status:t.connectionStatus})}),Object(y.jsx)("h6",{children:"Credentials inhibited"}),Object(y.jsx)("p",{children:t.hasCredentialsInhibited?"True":"False"}),Object(y.jsxs)("div",{className:"mt-auto",children:[t.hasCredentialsInhibited?Object(y.jsx)(q.a,{variant:"success text-white",className:"mr-1",onClick:a,children:"Enable credentials request"}):Object(y.jsx)(q.a,{variant:"danger",className:"mr-1",onClick:n,children:"Inhibit credentials"}),Object(y.jsx)(q.a,{variant:"danger",onClick:r,children:"Wipe credential secret"})]})]})]})},Ci=function(e){var t=e.aliases,n=e.onEditAliasClick,a=e.onRemoveAliasClick;return Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Tag"}),Object(y.jsx)("th",{children:"Alias"}),Object(y.jsx)("th",{className:"action-column",children:"Actions"})]})}),Object(y.jsx)("tbody",{children:Array.from(t.entries()).map((function(e){var t=Object(h.a)(e,2),r=t[0],i=t[1];return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:r}),Object(y.jsx)("td",{children:i}),Object(y.jsxs)("td",{className:"text-center",children:[Object(y.jsx)(ln,{icon:"edit",className:"color-grey mr-2",onClick:function(){return n(r)}}),Object(y.jsx)(ln,{icon:"erase",onClick:function(){return a({key:r,value:i})}})]})]},r)}))})]})},wi=function(e){var t=e.device,n=e.onNewAliasClick,a=e.onEditAliasClick,r=e.onRemoveAliasClick;return Object(y.jsxs)(xi,{xs:12,md:6,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Aliases"}),Object(y.jsxs)(M.a.Body,{className:"d-flex flex-column",children:[t.aliases.size>0?Object(y.jsx)(Ci,{aliases:t.aliases,onEditAliasClick:a,onRemoveAliasClick:r}):Object(y.jsx)("p",{children:"Device has no aliases"}),Object(y.jsx)("div",{className:"mt-auto",children:Object(y.jsx)(q.a,{variant:"primary",onClick:n,children:"Add new alias"})})]})]})},Ni=function(e){var t=e.metadata,n=e.onEditMetadataClick,a=e.onRemoveMetadataClick;return Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Field"}),Object(y.jsx)("th",{children:"Value"}),Object(y.jsx)("th",{className:"action-column",children:"Actions"})]})}),Object(y.jsx)("tbody",{children:Array.from(t.entries()).map((function(e){var t=Object(h.a)(e,2),r=t[0],i=t[1];return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:r}),Object(y.jsx)("td",{children:i}),Object(y.jsxs)("td",{className:"text-center",children:[Object(y.jsx)(ln,{icon:"edit",className:"color-grey mr-2",onClick:function(){return n(r)}}),Object(y.jsx)(ln,{icon:"erase",onClick:function(){return a({key:r,value:i})}})]})]},r)}))})]})},Ii=function(e){var t=e.device,n=e.onNewMetadataClick,a=e.onEditMetadataClick,r=e.onRemoveMetadataClick;return Object(y.jsxs)(xi,{xs:12,md:6,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Metadata"}),Object(y.jsxs)(M.a.Body,{className:"d-flex flex-column",children:[t.metadata.size>0?Object(y.jsx)(Ni,{metadata:t.metadata,onEditMetadataClick:a,onRemoveMetadataClick:r}):Object(y.jsx)("p",{children:"Device has no metadata"}),Object(y.jsx)("div",{className:"mt-auto",children:Object(y.jsx)(q.a,{variant:"primary",onClick:n,children:"Add new item"})})]})]})},_i=function(e){var t=e.groups;return Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsx)("tr",{children:Object(y.jsx)("th",{children:"Name"})})}),Object(y.jsx)("tbody",{children:t.map((function(e,t){var n=encodeURIComponent(encodeURIComponent(e));return Object(y.jsx)("tr",{children:Object(y.jsx)("td",{children:Object(y.jsx)(s.b,{to:"/groups/".concat(n,"/edit"),children:e})})},t)}))})]})},Si=function(e){var t=e.device,n=e.showAddToGropButton,a=e.onAddToGroupClick;return Object(y.jsxs)(xi,{xs:12,md:6,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Groups"}),Object(y.jsxs)(M.a.Body,{className:"d-flex flex-column",children:[t.groups.length>0?Object(y.jsx)(_i,{groups:t.groups}):Object(y.jsx)("p",{children:"Device does not belong to any group"}),Object(y.jsx)("div",{className:"mt-auto",children:n&&Object(y.jsx)(q.a,{variant:"primary",onClick:a,children:"Add to existing group"})})]})]})},Ai=function(e){var t=e.deviceId,n=e.introspection;return Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Name"}),Object(y.jsx)("th",{children:"Major"}),Object(y.jsx)("th",{children:"Minor"})]})}),Object(y.jsx)("tbody",{children:n.map((function(e){return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)(s.b,{to:"/devices/".concat(t,"/interfaces/").concat(e.name),children:e.name})}),Object(y.jsx)("td",{children:e.major}),Object(y.jsx)("td",{children:e.minor})]},e.name)}))})]})},Ri=function(e){var t=e.device,n=Array.from(t.introspection.values());return Object(y.jsxs)(xi,{xs:12,md:6,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Interfaces"}),Object(y.jsx)(M.a.Body,{className:"d-flex flex-column",children:n.length>0?Object(y.jsx)(Ai,{deviceId:t.id,introspection:n}):Object(y.jsx)("p",{children:"No introspection info"})})]})},Ti=function(e){var t=e.interfaces;return Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Name"}),Object(y.jsx)("th",{children:"Major"}),Object(y.jsx)("th",{children:"Minor"})]})}),Object(y.jsx)("tbody",{children:t.map((function(e){return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:e.name}),Object(y.jsx)("td",{children:e.major}),Object(y.jsx)("td",{children:e.minor})]},"".concat(e.name," v").concat(e.major))}))})]})},Di=function(e){var t=e.device;return Object(y.jsxs)(xi,{className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Previous Interfaces"}),Object(y.jsx)(M.a.Body,{className:"d-flex flex-column",children:t.previousInterfaces.length>0?Object(y.jsx)(Ti,{interfaces:t.previousInterfaces}):Object(y.jsx)("p",{children:"No previous interfaces info"})})]})},Mi=function(e){var t,n=e.stats;return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:n.name}),Object(y.jsx)("td",{className:"text-right",children:(t=n.bytes,t<1024?"".concat(t,"B"):t<1048576?"".concat((t/1024).toFixed(2),"KiB"):"".concat((t/1048576).toFixed(2),"MiB"))}),Object(y.jsx)("td",{className:"d-xl-table-cell d-none text-right",children:"".concat(n.bytesPercent.toFixed(2),"%")}),Object(y.jsx)("td",{className:"text-right",children:n.messages}),Object(y.jsx)("td",{className:"d-xl-table-cell d-none text-right",children:"".concat(n.messagesPercent.toFixed(2),"%")})]})},Pi=function(e){var t=e.astarte,n=e.device,r=Object(a.useMemo)((function(){return Bn(t,{deviceId:n.id,stats:"exchangedBytes"})}),[t]),i=Array.from(n.introspection.values()).concat(n.previousInterfaces),c=n.totalReceivedBytes,s=n.totalReceivedMessages,l=[],u=0,j=0;return i.forEach((function(e){u+=e.exchangedBytes,j+=e.exchangedMessages,l.push({name:"".concat(e.name," v").concat(e.major,".").concat(e.minor),bytes:e.exchangedBytes,bytesPercent:100*e.exchangedBytes/c,messages:e.exchangedMessages,messagesPercent:100*e.exchangedMessages/s})})),l.push({name:"Other",bytes:c-u,bytesPercent:100*(c-u)/c,messages:s-j,messagesPercent:100*(s-j)/s}),l.push({name:"Total",bytes:c,bytesPercent:100,messages:s,messagesPercent:100}),Object(y.jsxs)(xi,{xs:12,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Device Stats"}),Object(y.jsx)(M.a.Body,{className:"d-flex flex-column",children:Object(y.jsxs)(d.a,{className:"mt-3",children:[Object(y.jsx)(o.a,{children:Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Interface"}),Object(y.jsx)("th",{className:"text-right",children:"Bytes"}),Object(y.jsx)("th",{className:"d-xl-table-cell d-none text-right",children:"Bytes (%)"}),Object(y.jsx)("th",{className:"text-right",children:"Messages"}),Object(y.jsx)("th",{className:"d-xl-table-cell d-none text-right",children:"Messages (%)"})]})}),Object(y.jsx)("tbody",{children:l.map((function(e){return Object(y.jsx)(Mi,{stats:e},e.name)}))})]})}),Object(y.jsx)(o.a,{sm:12,xl:4,children:Object(y.jsx)(Yn,{providers:[r]})})]})})]})},qi=function(e){var t,n,a,i,c=e.device,s=[{label:"Last seen IP",value:c.lastSeenIp},{label:"Last credentials request IP",value:c.lastCredentialsRequestIp},{label:"First credentials request",value:null===(t=c.firstCredentialsRequest)||void 0===t?void 0:t.toLocaleString()},{label:"First registration",value:null===(n=c.firstRegistration)||void 0===n?void 0:n.toLocaleString()},{label:"Last connection",value:null===(a=c.lastConnection)||void 0===a?void 0:a.toLocaleString()},{label:"Last disconnection",value:null===(i=c.lastDisconnection)||void 0===i?void 0:i.toLocaleString()}].filter((function(e){return void 0!==e.value}));return Object(y.jsxs)(xi,{xs:12,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Device Status Events"}),Object(y.jsx)(M.a.Body,{className:"d-flex flex-column",children:s.map((function(e){var t=e.label,n=e.value;return Object(y.jsxs)(r.a.Fragment,{children:[Object(y.jsx)("h6",{children:t}),Object(y.jsx)("p",{children:n})]},t)}))})]})};var Ei=function(e){var t=e.children.toISOString().substring(11,23);return Object(y.jsx)("small",{className:"text-secondary text-monospace mr-2",children:"[".concat(t,"]")})},Li=function(e){switch(e){case"write_on_server_owned_interface":return"Write on a server owned interface";case"invalid_interface":return"Invalid interface";case"invalid_path":return"Invalid path";case"mapping_not_found":return"Mapping not found";case"interface_loading_failed":return"Interface loading failed";case"ambiguous_path":return"Ambiguous path";case"undecodable_bson_payload":return"Undecodable BSON payload";case"unexpected_value_type":return"Unexpected value type";case"value_size_exceeded":return"Value size exceeded";case"unexpected_object_key":return"Unexpected object key";case"invalid_introspection":return"Invalid introspection";case"unexpected_control_message":return"Unexpected control message";case"device_session_not_found":return"Device session not found";case"resend_interface_properties_failed":return"Resend interface properties failed";case"empty_cache_error":return"Empty cache error";default:return""}},Ui=function(e){return e instanceof mt?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(P.a,{variant:"success",className:"mr-2",children:"device connected"}),Object(y.jsxs)("span",{children:["IP : ",e.ip]})]}):e instanceof ft?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(P.a,{variant:"warning",className:"mr-2",children:"device disconnected"}),Object(y.jsx)("span",{children:"Device disconnected"})]}):e instanceof zt?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(P.a,{variant:"info",className:"mr-2",children:"incoming data"}),Object(y.jsx)("span",{className:"mr-2",children:e.interfaceName}),Object(y.jsx)("span",{className:"mr-2",children:e.path}),Object(y.jsx)("span",{className:"mr-2 text-monospace",children:e.value})]}):e instanceof Kt?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(P.a,{variant:"info",className:"mr-2",children:"unset property"}),Object(y.jsx)("span",{className:"mr-2",children:e.interfaceName}),Object(y.jsx)("span",{children:e.path})]}):e instanceof Bt?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(P.a,{variant:"danger",className:"mr-2",children:"device error"}),Object(y.jsx)("span",{children:Li(e.errorName)})]}):Object(y.jsx)(y.Fragment,{})},Fi=function(e){var t=e.event;return Object(y.jsxs)("li",{className:"event-device px-2",children:[Object(y.jsx)(Ei,{children:new Date(t.timestamp)}),Ui(t)]})},Gi=function(e){var t=e.event;switch(t.level){case"error":return Object(y.jsxs)("li",{className:"px-2",children:[Object(y.jsx)(Ei,{children:new Date(t.timestamp)}),Object(y.jsx)(P.a,{variant:"secondary",className:"mr-2",children:"channel"}),Object(y.jsx)("span",{className:"text-danger",children:t.message})]});case"info":default:return Object(y.jsxs)("li",{className:"px-2",children:[Object(y.jsx)(Ei,{children:new Date(t.timestamp)}),Object(y.jsx)(P.a,{variant:"secondary",className:"mr-2",children:"channel"}),Object(y.jsx)("span",{className:"text-secondary",children:t.message})]})}},Hi=function(e){var t,n=e.event;return(t=n)&&t.level&&("error"===t.level||"info"===t.level)?Object(y.jsx)(Gi,{event:n}):Object(y.jsx)(Fi,{event:n})},$i=function(e){var t=e.astarte,n=e.deviceId,r=Object(a.useState)([]),i=Object(h.a)(r,2),c=i[0],s=i[1],o=function(e){s((function(t){return[].concat(Object(En.a)(t),[e])}))},l=function(e){return o({message:e,level:"error",timestamp:Date.now()})},d=function(e){return o({message:e,level:"info",timestamp:Date.now()})};return Object(a.useEffect)((function(){var e=function(){return l("Astarte channels communication error")},a=function(){return l("Lost connection with the Astarte channel")};return t.addListener("socketError",e),t.addListener("socketClose",a),function(e){var t=e.astarte,n=e.deviceId,a=e.onEventReceived,r=e.onErrorMessage,i=e.onInfoMessage,c=Math.floor(1e4*Math.random()),s="dashboard_".concat(n,"_").concat(c);t.joinRoom(s).then((function(){i("Joined room for device ".concat(n)),t.listenForEvents(s,(function(e){return a(e)}));var e={name:"connectiontrigger-".concat(n),device_id:n,simple_trigger:{type:"device_trigger",on:"device_connected",device_id:n}},c={name:"disconnectiontrigger-".concat(n),device_id:n,simple_trigger:{type:"device_trigger",on:"device_disconnected",device_id:n}},o={name:"errortrigger-".concat(n),device_id:n,simple_trigger:{type:"device_trigger",on:"device_error",device_id:n}},l={name:"datatrigger-".concat(n),device_id:n,simple_trigger:{type:"data_trigger",on:"incoming_data",interface_name:"*",value_match_operator:"*",match_path:"/*"}};t.registerVolatileTrigger(s,e).then((function(){i("Watching for device connection events")})).catch((function(){r("Coulnd't watch for device connection events")})),t.registerVolatileTrigger(s,c).then((function(){i("Watching for device disconnection events")})).catch((function(){r("Coulnd't watch for device disconnection events")})),t.registerVolatileTrigger(s,o).then((function(){i("Watching for device error events")})).catch((function(){r("Coulnd't watch for device error events")})),t.registerVolatileTrigger(s,l).then((function(){i("Watching for device data events")})).catch((function(){r("Coulnd't watch for device data events")}))})).catch((function(){r("Couldn't join device ".concat(n," room"))}))}({astarte:t,deviceId:n,onEventReceived:o,onErrorMessage:l,onInfoMessage:d}),function(){t.removeListener("socketError",e),t.removeListener("socketClose",a),t.joinedRooms.forEach((function(e){t.leaveRoom(e)}))}}),[n,t]),Object(y.jsx)("div",{className:"device-event-container p-3",children:Object(y.jsx)("ul",{className:"list-unstyled",children:c.map((function(e,t){return Object(y.jsx)(Hi,{event:e},t)}))})})},Vi=function(e){var t=e.astarte,n=e.deviceId;return Object(y.jsxs)(xi,{xs:12,className:"mb-4",children:[Object(y.jsx)(M.a.Header,{as:"h5",children:"Device Live Events"}),Object(y.jsx)(M.a.Body,{className:"d-flex flex-column",children:Object(y.jsx)($i,{astarte:t,deviceId:n})})]})},Bi=function(e){var t=e.onCancel,n=e.onConfirm,r=e.groups,i=e.isAddingToGroup,c=Object(a.useState)(null),s=Object(h.a)(c,2),o=s[0],l=s[1];return Object(y.jsxs)(E.a,{show:!0,centered:!0,size:"lg",onHide:t,children:[Object(y.jsx)(E.a.Header,{closeButton:!0,children:Object(y.jsx)(E.a.Title,{children:"Select Existing Group"})}),Object(y.jsx)(E.a.Body,{children:Object(y.jsx)("ul",{className:"list-unstyled",children:r.map((function(e){return Object(y.jsx)("li",{className:e===o?"p-2 bg-success text-white":"p-2",children:Object(y.jsxs)("span",{onClick:function(){return l(e)},children:[Object(y.jsx)(ln,{icon:"add",className:"mr-2"}),e]})},e)}))})}),Object(y.jsxs)(E.a.Footer,{children:[t&&Object(y.jsx)(q.a,{variant:"secondary",onClick:t,style:{minWidth:"5em"},children:"Cancel"}),Object(y.jsxs)(q.a,{variant:"primary",disabled:i||null===o,onClick:function(){o&&n(o)},style:{minWidth:"5em"},children:[i&&Object(y.jsx)(Ln.a,{className:"mr-2",size:"sm",animation:"border",role:"status"}),"Confirm"]})]})]})},zi={type:"object",required:["key","value"],properties:{key:{title:"Tag",type:"string"},value:{title:"Alias",type:"string"}}},Ki=function(e){var t=e.onCancel,n=e.onConfirm,a=e.isAddingAlias;return Object(y.jsx)(Ha,{title:"Add New Alias",schema:zi,onCancel:t,onConfirm:n,isConfirming:a})},Ji={type:"object",required:["value"],properties:{value:{title:"Alias",type:"string"}}},Wi=function(e){var t=e.onCancel,n=e.onConfirm,a=e.targetAlias,r=e.isUpdatingAlias;return Object(y.jsx)(Ha,{title:'Edit "'.concat(a,'"'),schema:Ji,onCancel:t,onConfirm:n,isConfirming:r})},Zi={type:"object",required:["key"],properties:{key:{title:"Key",type:"string"},value:{title:"Value",type:"string"}}},Yi=function(e){var t=e.onCancel,n=e.onConfirm,a=e.isAddingMetadata;return Object(y.jsx)(Ha,{title:"Add New Item",schema:Zi,onCancel:t,onConfirm:n,isConfirming:a})},Qi={type:"object",required:["value"],properties:{value:{title:"Metadata",type:"string"}}},Xi=function(e){var t=e.onCancel,n=e.onConfirm,a=e.targetMetadata,r=e.isUpdatingMetadata;return Object(y.jsx)(Ha,{title:'Edit "'.concat(a,'"'),schema:Qi,onCancel:t,onConfirm:n,isConfirming:r})};function ec(e){return"add_to_group_modal"===e.kind}function tc(e){return"new_alias_modal"===e.kind}function nc(e){return"edit_alias_modal"===e.kind}function ac(e){return"delete_alias_modal"===e.kind}function rc(e){return"new_metadata_modal"===e.kind}function ic(e){return"edit_metadata_modal"===e.kind}function cc(e){return"delete_metadata_modal"===e.kind}function sc(e){return"reregister_device_modal"===e.kind}var oc=function(){var e,t=Object(wn.i)().deviceId,n=Xn(),r=ta((function(){return n.client.getDeviceInfo(t)})),i=ta((function(){return n.client.getGroupList()})),c=_(),u=Object(a.useState)(null),b=Object(h.a)(u,2),p=b[0],m=b[1],f=Object(a.useMemo)((function(){if("ok"===r.status&&"ok"===i.status){var e=new Set(r.value.groups);return i.value.filter((function(t){return!e.has(t)}))}return[]}),[r.status,i.status]),O=Object(a.useCallback)((function(){m(null)}),[]),g=Object(a.useCallback)((function(e){n.client.inhibitDeviceCredentialsRequests(t,e).then((function(){r.refresh()})).catch((function(){c.showError("Couldn't ".concat(e?"inhibit":"enable"," device credentials requests"))}))}),[n.client,t]),v=Object(a.useCallback)((function(){n.client.wipeDeviceCredentials(t).then((function(){m({kind:"reregister_device_modal"})})).catch((function(){c.showError("Couldn't wipe the device credential secret"),O()}))}),[n.client,t]),x=Object(a.useCallback)((function(e){n.client.addDeviceToGroup({groupName:e,deviceId:t}).then((function(){r.refresh(),O()})).catch((function(){c.showError("Couldn't add the device to the group"),O()}))}),[n.client]),k=Object(a.useCallback)((function(e,a){n.client.insertDeviceAlias(t,e,a).then((function(){O(),r.refresh()})).catch((function(){c.showError("Couldn't update the device alias"),O()}))}),[n.client,t]),C=Object(a.useCallback)((function(e){n.client.deleteDeviceAlias(t,e).then((function(){O(),r.refresh()})).catch((function(){c.showError("Couldn't delete the device alias"),O()}))}),[n.client,t]),w=Object(a.useCallback)((function(e,a){n.client.insertDeviceMetadata(t,e,a).then((function(){O(),r.refresh()})).catch((function(){c.showError("Couldn't update the device metadata"),O()}))}),[n.client,t]),N=Object(a.useCallback)((function(e){n.client.deleteDeviceMetadata(t,e).then((function(){O(),r.refresh()})).catch((function(){c.showError("Couldn't delete the device metadata"),O()}))}),[n.client,t]);return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsx)(d.a,{children:Object(y.jsx)(o.a,{children:Object(y.jsxs)("h2",{className:"pl-2",children:[Object(y.jsx)(ua,{href:"/devices"}),"Device"]})})}),Object(y.jsx)(c.Alerts,{}),Object(y.jsx)(na,{data:r.value,status:r.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load device details",onRetry:r.refresh}),children:function(e){var t=Array.from(e.introspection.values()).concat(e.previousInterfaces);return Object(y.jsxs)(d.a,{children:[Object(y.jsx)(ki,{device:e,onInhibitCredentialsClick:function(){return g(!0)},onEnableCredentialsClick:function(){return g(!1)},onWipeCredentialsClick:function(){return m({kind:"wipe_credentials_modal",isWipingCredentials:!1})}}),Object(y.jsx)(wi,{device:e,onNewAliasClick:function(){return m({kind:"new_alias_modal",isAddingAlias:!1})},onEditAliasClick:function(e){return m({kind:"edit_alias_modal",targetAlias:e,isUpdatingAlias:!1})},onRemoveAliasClick:function(e){var t=e.key,n=e.value;return m({kind:"delete_alias_modal",aliasKey:t,aliasValue:n,isDeletingAlias:!1})}}),Object(y.jsx)(Ii,{device:e,onNewMetadataClick:function(){return m({kind:"new_metadata_modal",isAddingMetadata:!1})},onEditMetadataClick:function(e){return m({kind:"edit_metadata_modal",targetMetadata:e,isUpdatingMetadata:!1})},onRemoveMetadataClick:function(e){var t=e.key,n=e.value;return m({kind:"delete_metadata_modal",metadataKey:t,metadataValue:n,isDeletingMetadata:!1})}}),Object(y.jsx)(Si,{device:e,showAddToGropButton:f.length>0,onAddToGroupClick:function(){return m({kind:"add_to_group_modal",isAddingToGroup:!1})}}),Object(y.jsx)(Ri,{device:e}),Object(y.jsx)(Di,{device:e}),t.length>0&&Object(y.jsx)(Pi,{astarte:n.client,device:e}),Object(y.jsx)(qi,{device:e}),Object(y.jsx)(Vi,{astarte:n.client,deviceId:e.id})]})}}),p&&(e=p,"wipe_credentials_modal"===e.kind)&&Object(y.jsx)(ma,{title:"Wipe Device Credentials",confirmLabel:"Wipe credentials secret",confirmVariant:"danger",onCancel:O,onConfirm:function(){m(Object(j.a)(Object(j.a)({},p),{},{isWipingCredentials:!0})),v()},isConfirming:p.isWipingCredentials,children:Object(y.jsx)("p",{children:"This will remove the current device credential secret from Astarte, forcing the device to register again and store its new credentials secret. Continue?"})}),p&&ec(p)&&Object(y.jsx)(Bi,{onCancel:O,onConfirm:function(e){m(Object(j.a)(Object(j.a)({},p),{},{isAddingToGroup:!0})),x(e)},groups:f,isAddingToGroup:p.isAddingToGroup}),p&&tc(p)&&Object(y.jsx)(Ki,{onCancel:O,onConfirm:function(e){var t=e.key,n=e.value;m(Object(j.a)(Object(j.a)({},p),{},{isAddingAlias:!0})),k(t,n)},isAddingAlias:p.isAddingAlias}),p&&nc(p)&&Object(y.jsx)(Wi,{onCancel:O,onConfirm:function(e){var t=e.value;m(Object(j.a)(Object(j.a)({},p),{},{isUpdatingAlias:!0})),k(p.targetAlias,t)},targetAlias:p.targetAlias,isUpdatingAlias:p.isUpdatingAlias}),p&&ac(p)&&Object(y.jsx)(ma,{title:"Delete Alias",confirmLabel:"Delete",confirmVariant:"danger",onCancel:O,onConfirm:function(){m(Object(j.a)(Object(j.a)({},p),{},{isDeletingAlias:!0})),C(p.aliasKey)},isConfirming:p.isDeletingAlias,children:Object(y.jsx)("p",{children:'Delete alias "'.concat(p.aliasValue,'"?')})}),p&&rc(p)&&Object(y.jsx)(Yi,{onCancel:O,onConfirm:function(e){var t=e.key,n=e.value;m(Object(j.a)(Object(j.a)({},p),{},{isAddingMetadata:!0})),w(t,n)},isAddingMetadata:p.isAddingMetadata}),p&&ic(p)&&Object(y.jsx)(Xi,{onCancel:O,onConfirm:function(e){var t=e.value;m(Object(j.a)(Object(j.a)({},p),{},{isUpdatingMetadata:!0})),w(p.targetMetadata,t)},targetMetadata:p.targetMetadata,isUpdatingMetadata:p.isUpdatingMetadata}),p&&cc(p)&&Object(y.jsx)(ma,{title:"Delete Item",confirmLabel:"Delete",confirmVariant:"danger",onCancel:O,onConfirm:function(){m(Object(j.a)(Object(j.a)({},p),{},{isDeletingMetadata:!0})),N(p.metadataKey)},isConfirming:p.isDeletingMetadata,children:Object(y.jsx)("p",{children:"Do you want to delete ".concat(p.metadataKey," from metadata?")})}),p&&sc(p)&&Object(y.jsx)(ma,{title:"Device Credentials Wiped",confirmLabel:"Ok",onConfirm:O,children:Object(y.jsxs)("p",{children:["The device's credentials secret was wiped from Astarte. You can\xa0",Object(y.jsx)(s.b,{to:"/devices/register?deviceId=".concat(t),children:"click here"})," to register the device again and retrieve its new credentials secret."]})})]})};function lc(e){var t=null===e||void 0===e?void 0:e.value;return null==t?"":Y.a.isArray(t)?JSON.stringify(t):Y.a.isBoolean(t)?t?"true":"false":Y.a.isNumber(t)?t.toString():Y.a.isNull(t)?"":String(t)}var dc=function(e){var t=e.treeNode;return Object(y.jsx)("pre",{children:Object(y.jsx)("code",{children:JSON.stringify(t.toLastValue(),null,2)})})},uc=function(e){var t=e.treeNode.toLinearizedData();return 0===t.length?Object(y.jsx)("p",{children:"No data sent by the device."}):Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Path"}),Object(y.jsx)("th",{children:"Last value"}),Object(y.jsx)("th",{children:"Last timestamp"})]})}),Object(y.jsx)("tbody",{children:t.map((function(e){return Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:e.endpoint}),Object(y.jsx)("td",{children:lc(e)}),Object(y.jsx)("td",{children:new Date(e.timestamp).toLocaleString()})]},e.endpoint)}))})]})},jc=function(e){var t=e.dataTreeNode,n=t.toData();if(0===n.length)return Object(y.jsx)("p",{children:"No data sent by the device."});var a=Object.keys(n[0].value),r=Y.a.orderBy(n,"timestamp","desc");return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("h5",{className:"mb-1",children:"Path"}),Object(y.jsx)("p",{children:t.endpoint}),Object(y.jsxs)(Un.a,{responsive:!0,children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[a.map((function(e){return Object(y.jsx)("th",{children:e},e)})),Object(y.jsx)("th",{children:"Timestamp"})]})}),Object(y.jsx)("tbody",{children:r.slice(0,20).map((function(e){return Object(y.jsxs)("tr",{children:[a.map((function(t){return Object(y.jsx)("td",{children:lc(e.value[t])},t)})),Object(y.jsx)("td",{children:new Date(e.timestamp).toLocaleString()})]},e.timestamp)}))})]})]})},hc=function(e){var t=e.treeNode.getLeaves();return 0===t.length?Object(y.jsx)("p",{children:"No data sent by the device."}):Object(y.jsx)(y.Fragment,{children:t.map((function(e){return Object(y.jsx)(jc,{dataTreeNode:e},e.endpoint)}))})},bc=function(e){var t=e.interfaceData;return"properties"===t.dataKind?Object(y.jsx)(dc,{treeNode:t}):"datastream_individual"===t.dataKind?Object(y.jsx)(uc,{treeNode:t}):Object(y.jsx)(hc,{treeNode:t})},pc=function(){var e=Object(wn.i)(),t=e.deviceId,n=e.interfaceName,a=Xn(),r=ta((function(){return a.client.getDeviceDataTree({deviceId:t,interfaceName:n})}));return Object(y.jsxs)(l.a,{fluid:!0,className:"p-3",children:[Object(y.jsxs)("h2",{children:[Object(y.jsx)(ua,{href:"/devices/".concat(t,"/edit")}),"Interface Data"]}),Object(y.jsxs)(M.a,{className:"mt-4",children:[Object(y.jsxs)(M.a.Header,{children:[Object(y.jsx)("span",{className:"text-monospace",children:t})," /",n]}),Object(y.jsx)(M.a.Body,{children:Object(y.jsx)(na,{data:r.value,status:r.status,fallback:Object(y.jsx)(l.a,{fluid:!0,className:"text-center",children:Object(y.jsx)(Ln.a,{animation:"border",role:"status"})}),errorFallback:Object(y.jsx)(ha,{title:"Couldn't load interface data",onRetry:r.refresh}),children:function(e){return Object(y.jsx)(bc,{interfaceData:e})}})})]})]})};function mc(){var e=Object(wn.g)(),t=e.search,n=e.hash,a=Xn(),r=new URLSearchParams(t),i=new URLSearchParams(n.slice(1)),c=r.get("realm"),s=i.get("access_token"),o=r.get("authUrl"),l=!1;return c&&s&&(l=a.login({realm:c,token:s,authUrl:o})),l?Object(y.jsx)(wn.a,{to:"/"}):Object(y.jsx)(wn.a,{to:"/login"})}function fc(){return Xn().logout(),Object(y.jsx)(wn.a,{to:"/login"})}function Oc(){var e=Object(wn.g)().search,t=Xn(),n=R();if(t.isAuthenticated)return Object(y.jsx)(wn.a,{to:"/"});var a=new URLSearchParams(e).get("type")||"",r=["oauth","token"].includes(a)?a:n.auth.defaultMethod;return Object(y.jsx)(qn,{type:r,canSwitchLoginType:n.auth.methods.length>1,defaultRealm:n.auth.defaultRealm||""})}var gc=function(e){var t=Object.assign({},e);return Xn().isAuthenticated?Object(y.jsx)(wn.b,Object(j.a)({},t)):Object(y.jsx)(wn.a,{to:"/login"})},vc=function(){return Object(y.jsxs)(wn.d,{children:[Object(y.jsx)(gc,{path:"/",element:Object(y.jsx)(da,{})}),Object(y.jsx)(gc,{path:"home",element:Object(y.jsx)(da,{})}),Object(y.jsx)(wn.b,{path:"auth",element:Object(y.jsx)(mc,{})}),Object(y.jsx)(wn.b,{path:"logout",element:Object(y.jsx)(fc,{})}),Object(y.jsx)(wn.b,{path:"login",element:Object(y.jsx)(Oc,{})}),Object(y.jsx)(gc,{path:"triggers",element:Object(y.jsx)(Sa,{})}),Object(y.jsx)(gc,{path:"triggers/new",element:Object(y.jsx)(ar,{})}),Object(y.jsx)(gc,{path:"triggers/:triggerName/edit",element:Object(y.jsx)(ir,{})}),Object(y.jsx)(gc,{path:"interfaces",element:Object(y.jsx)(lr,{})}),Object(y.jsx)(gc,{path:"interfaces/new",element:Object(y.jsx)(hr,{})}),Object(y.jsx)(gc,{path:"interfaces/:interfaceName/:interfaceMajor/edit",element:Object(y.jsx)(ur,{})}),Object(y.jsx)(gc,{path:"devices",element:Object(y.jsx)(wr,{})}),Object(y.jsx)(gc,{path:"devices/register",element:Object(y.jsx)(Pr,{})}),Object(y.jsx)(gc,{path:"devices/:deviceId/edit",element:Object(y.jsx)(oc,{})}),Object(y.jsx)(gc,{path:"devices/:deviceId/interfaces/:interfaceName",element:Object(y.jsx)(pc,{})}),Object(y.jsx)(gc,{path:"groups",element:Object(y.jsx)(pa,{})}),Object(y.jsx)(gc,{path:"groups/new",element:Object(y.jsx)(Ca,{})}),Object(y.jsx)(gc,{path:"groups/:groupName/edit",element:Object(y.jsx)(Oa,{})}),Object(y.jsx)(gc,{path:"flows",element:Object(y.jsx)(Lr,{})}),Object(y.jsx)(gc,{path:"flows/new",element:Object(y.jsx)(Gr,{})}),Object(y.jsx)(gc,{path:"flows/:flowName/edit",element:Object(y.jsx)(Fr,{})}),Object(y.jsx)(gc,{path:"pipelines",element:Object(y.jsx)(Br,{})}),Object(y.jsx)(gc,{path:"pipelines/new",element:Object(y.jsx)(ui,{})}),Object(y.jsx)(gc,{path:"pipelines/:pipelineId/edit",element:Object(y.jsx)(zr,{})}),Object(y.jsx)(gc,{path:"blocks",element:Object(y.jsx)(pi,{})}),Object(y.jsx)(gc,{path:"blocks/new",element:Object(y.jsx)(Oi,{})}),Object(y.jsx)(gc,{path:"blocks/:blockId/edit",element:Object(y.jsx)(fi,{})}),Object(y.jsx)(gc,{path:"settings",element:Object(y.jsx)(vi,{})}),Object(y.jsx)(wn.b,{path:"*",element:Object(y.jsx)(wn.a,{to:"/"})})]})},xc=n(1441),yc=function(e){var t=e.alert,n=Object(u.a)(e,["alert"]),a=x(t.timestamp);return Object(y.jsxs)(xc.a,Object(j.a)(Object(j.a)({},n),{},{onClose:t.close,className:"mx-auto",children:[Object(y.jsx)(xc.a.Header,{className:"bg-".concat(t.options.variant," text-light"),children:Object(y.jsx)("span",{className:"mx-auto",children:a})}),Object(y.jsx)(xc.a.Body,{children:t.message})]}))},kc=function(){var e=Object(a.useContext)(w);return e&&0!==e.length?Object(y.jsx)(l.a,{fluid:!0,className:"fixed-bottom p-3",children:e.map((function(e){return Object(y.jsx)(yc,{alert:e},e.id)}))}):null},Cc=function(){var e=R(),t=Xn(),n=ta((function(){var n=[t.client.getAppengineHealth(),t.client.getRealmManagementHealth(),t.client.getPairingHealth()];return e.features.flow&&n.push(t.client.getFlowHealth()),Promise.all(n)}));v(n.refresh,3e4);var a="err"!==n.status;return t.isAuthenticated?Object(y.jsx)(o.a,{id:"main-navbar",className:"col-auto nav-col",children:Object(y.jsxs)(An,{children:[Object(y.jsx)(An.Brand,{}),Object(y.jsx)(An.Item,{label:"Home",link:"/",icon:"home"}),Object(y.jsx)(An.Separator,{}),Object(y.jsx)(An.Item,{label:"Interfaces",link:"/interfaces",icon:"interfaces"}),Object(y.jsx)(An.Item,{label:"Triggers",link:"/triggers",icon:"triggers"}),Object(y.jsx)(An.Separator,{}),Object(y.jsx)(An.Item,{label:"Devices",link:"/devices",icon:"devices"}),Object(y.jsx)(An.Item,{label:"Groups",link:"/groups",icon:"groups"}),Object(y.jsx)(An.Separator,{}),e.features.flow&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(An.Item,{label:"Flows",link:"/flows",icon:"flows"}),Object(y.jsx)(An.Item,{label:"Pipelines",link:"/pipelines",icon:"pipelines"}),Object(y.jsx)(An.Item,{label:"Blocks",link:"/blocks",icon:"blocks"}),Object(y.jsx)(An.Separator,{})]}),Object(y.jsx)(An.Item,{label:"Realm settings",link:"/settings",icon:"settings"}),Object(y.jsx)(An.Separator,{}),Object(y.jsx)(An.ApiStatus,{healthy:a,realm:t.realm}),Object(y.jsx)(An.Separator,{}),Object(y.jsx)(An.Item,{label:"Logout",link:"/logout",icon:"logout"})]})}):null},wc=function(){return Object(y.jsx)(l.a,{fluid:!0,className:"px-0",children:Object(y.jsxs)(d.a,{className:"no-gutters",children:[Object(y.jsx)(Cc,{}),Object(y.jsx)(o.a,{className:"main-content vh-100 overflow-auto",children:Object(y.jsx)(vc,{})})]})})},Nc=function(){return Object(y.jsx)(l.a,{fluid:!0,className:"px-0",children:Object(y.jsxs)(d.a,{className:"no-gutters",children:[Object(y.jsx)(o.a,{id:"main-navbar",className:"col-auto nav-col",children:Object(y.jsxs)(An,{children:[Object(y.jsx)(An.Brand,{}),Object(y.jsx)(An.Item,{label:"Interface Editor",link:"/",icon:"interfaces"})]})}),Object(y.jsx)(o.a,{className:"main-content vh-100 overflow-auto",children:Object(y.jsx)(Cn,{})})]})})},Ic=function(e){var t=e.config;return Object(y.jsxs)(S,{children:[Object(y.jsx)(s.a,{children:t?Object(y.jsx)(T,{config:t,children:Object(y.jsx)(ea,{config:t,children:Object(y.jsx)(wc,{})})}):Object(y.jsx)(Nc,{})}),Object(y.jsx)(kc,{})]})};fetch("/user-config/config.json").then((function(e){return e.json()})).then((function(e){return{astarteApiUrl:e.astarte_api_url,appEngineApiUrl:e.appengine_api_url,realmManagementApiUrl:e.realm_management_api_url,pairingApiUrl:e.pairing_api_url,flowApiUrl:e.flow_api_url,enableFlowPreview:e.enable_flow_preview,auth:e.auth,defaultAuth:e.default_auth,defaultRealm:e.default_realm}})).catch((function(){return null})).then((function(e){c.a.render(Object(y.jsx)(r.a.StrictMode,{children:Object(y.jsx)(Ic,{config:e})}),document.getElementById("root"))}))},619:function(e){e.exports=JSON.parse('{"beam_module":"Elixir.Astarte.Flow.Blocks.DeviceEventsProducer","name":"astarte_devices_source","schema":{"$id":"https://astarte-platform.org/specs/astarte_flow/blocks/astarte_devices_source.json","$schema":"http://json-schema.org/draft-04/schema#","additionalProperties":false,"description":"This is a producer block that generates messages by polling consuming from an AMQP queue that contains a stream of `SimpleEvent` generated by Data Updater Plant.","properties":{"realm":{"description":"The realm the producer will listen to.","title":"Realm","type":"string"},"amqp_routing_key":{"description":"The routing key used to bind the queue to the exchange.","title":"AMQP routing key","type":"string"},"amqp_exchange":{"description":"The name of the exchange the queue will be bound to. Defaults to `astarte_events`.","title":"AMQP exchange","type":"string"},"target_devices":{"description":"A list of device IDs. If provided, only events coming from these devices will be processed.","items":{"type":"string"},"title":"Target devices","type":"array"}},"required":["amqp_routing_key","realm"],"title":"Astarte Devices Source options","type":"object"},"type":"producer"}')},620:function(e){e.exports=JSON.parse('{"beam_module":"Elixir.Astarte.Flow.Blocks.Container","name":"container","schema":{"$id":"https://astarte-platform.org/specs/astarte_flow/blocks/container.json","$schema":"http://json-schema.org/draft-04/schema#","additionalProperties":false,"description":"This is a block that sends messages to a Docker container.","properties":{"image":{"description":"The tag of the docker image that will be used by the block.","title":"Image","type":"string"},"type":{"description":"How the block should process messages.","enum":["consumer","producer","producer_consumer"],"title":"Type","type":"string"}},"required":["image"],"title":"Container options","type":"object"},"type":"producer_consumer"}')},621:function(e){e.exports=JSON.parse('{"beam_module":"Elixir.Astarte.Flow.Blocks.DynamicVirtualDevicePool","name":"dynamic_virtual_device_pool","schema":{"$id":"https://astarte-platform.org/specs/astarte_flow/blocks/dynamic_virtual_device_pool.json","$schema":"http://json-schema.org/draft-04/schema#","additionalProperties":false,"definitions":{"interface":{"$schema":"http://json-schema.org/draft-04/schema","title":"Astarte Interface Schema","description":"This schema describes how an Astarte interface should be declared","type":"object","properties":{"interface_name":{"type":"string","pattern":"^([a-zA-Z][a-zA-Z0-9]*.([a-zA-Z0-9][a-zA-Z0-9-]*.)*)?[a-zA-Z][a-zA-Z0-9]*$","minLength":1,"maxLength":128,"description":"The name of the interface. This has to be an unique, alphanumeric reverse internet domain name, shorther than 128 characters."},"version_major":{"type":"integer","description":"A Major version qualifier for this interface. Interfaces with the same id and different version_major number are deemed incompatible. It is then acceptable to redefine any property of the interface when changing the major version number."},"version_minor":{"type":"integer","description":"A Minor version qualifier for this interface. Interfaces with the same id and major version number and different version_minor number are deemed compatible between each other. When changing the minor number, it is then only possible to insert further mappings. Any other modification might lead to incompatibilities and undefined behavior."},"type":{"type":"string","enum":["datastream","properties"],"description":"Identifies the type of this Interface. Currently two types are supported: datastream and properties. datastream should be used when dealing with streams of non-persistent data, where a single path receives updates and there\'s no concept of state. properties, instead, are meant to be an actual state and as such they have only a change history, and are retained."},"ownership":{"type":"string","enum":["device","server"],"description":"Identifies the ownership of the interface. Interfaces are meant to be unidirectional, and this property defines who\'s sending or receiving data. device means the device/gateway is sending data to Astarte, server means the device/gateway is receiving data from Astarte. Bidirectional mode is not supported, you should instantiate another interface for that."},"aggregation":{"type":"string","enum":["individual","object"],"default":"individual","description":"Identifies the aggregation of the mappings of the interface. Individual means every mapping changes state or streams data independently, whereas an object aggregation treats the interface as an object, making all the mappings changes interdependent. Choosing the right aggregation might drastically improve performances."},"description":{"type":"string","description":"An optional description of the interface."},"doc":{"type":"string","description":"A string containing documentation that will be injected in the generated client code."},"mappings":{"type":"array","description":"Mappings define the endpoint of the interface, where actual data is stored/streamed. They are defined as relative URLs (e.g. /my/path) and can be parametrized (e.g.: /%{myparam}/path). A valid interface must have no mappings clash, which means that every mapping must resolve to a unique path or collection of paths (including parametrization). Every mapping acquires type, quality and aggregation of the interface.","items":{"$ref":"#/definitions/mapping"},"minItems":1,"maxItems":1024,"uniqueItems":true}},"required":["interface_name","version_minor","version_major","type","ownership","mappings"]},"mapping":{"$schema":"http://json-schema.org/draft-04/schema","title":"Astarte Mapping Schema","type":"object","description":"Identifies a mapping for an interface. A mapping must consist at least of an endpoint and a type.","properties":{"endpoint":{"type":"string","pattern":"^(/(%{([a-zA-Z][a-zA-Z0-9_]*)}|[a-zA-Z][a-zA-Z0-9_]*)){1,64}$","minLength":2,"maxLength":256,"description":"The template of the path. This is a UNIX-like path (e.g. /my/path) and can be parametrized. Parameters are in the %{name} form, and can be used to create interfaces which represent dictionaries of mappings. When the interface aggregation is object, an object is composed by all the mappings for one specific parameter combination. /timestamp is a reserved path for timestamps, so every mapping on a datastream must not have any endpoint that ends with /timestamp."},"type":{"type":"string","enum":["double","integer","boolean","longinteger","string","binaryblob","datetime","doublearray","integerarray","booleanarray","longintegerarray","stringarray","binaryblobarray","datetimearray"],"description":"Defines the type of the mapping."},"reliability":{"type":"string","enum":["unreliable","guaranteed","unique"],"default":"unreliable","description":"Useful only with datastream. Defines whether the sent data should be considered delivered when the transport successfully sends the data (unreliable), when we know that the data has been received at least once (guaranteed) or when we know that the data has been received exactly once (unique). unreliable by default. When using reliable data, consider you might incur in additional resource usage on both the transport and the device\'s end."},"retention":{"type":"string","enum":["discard","volatile","stored"],"default":"discard","description":"Useful only with datastream. Defines whether the sent data should be discarded if the transport is temporarily uncapable of delivering it (discard) or should be kept in a cache in memory (volatile) or on disk (stored), and guaranteed to be delivered in the timeframe defined by the expiry. discard by default."},"expiry":{"type":"integer","default":0,"minimum":0,"description":"Useful when retention is stored. Defines after how many seconds a specific data entry should be kept before giving up and erasing it from the persistent cache. A value <= 0 means the persistent cache never expires, and is the default."},"database_retention_policy":{"type":"string","enum":["no_ttl","use_ttl"],"default":"no_ttl","description":"Useful only with datastream. Defines whether data should expire from the database after a given interval. Valid values are: no_ttl and use_ttl."},"database_retention_ttl":{"type":"integer","minimum":60,"maximum":630719999,"description":"Useful when database_retention_policy is use_ttl. Defines how many seconds a specific data entry should be kept before erasing it from the database."},"allow_unset":{"type":"boolean","default":false,"description":"Used only with properties. Used with producers, it generates a method to unset the property. Used with consumers, it generates code to call an unset method when an empty payload is received."},"explicit_timestamp":{"type":"boolean","default":false,"description":"Allow to set a custom timestamp, otherwise a timestamp is added when the message is received. If true explicit timestamp will also be used for sorting. This feature is only supported on datastreams."},"description":{"type":"string","description":"An optional description of the mapping."},"doc":{"type":"string","description":"A string containing documentation that will be injected in the generated client code."}},"required":["endpoint","type"]}},"description":"This is a consumer block that takes `data` from incoming `Message`s and publishes it as an Astarte device.","properties":{"pairing_url":{"description":"Base URL of the Astarte Pairing API instance the devices will connect to. URL containing the API version suffix (i.e. `/v1`) are *deprecated* and will be removed in a future release.","title":"Pairing URL","type":"string"},"realms":{"items":{"additionalProperties":false,"properties":{"realm":{"description":"The realm devices will register to.","type":"string"},"jwt":{"description":"The pairing JWT with the authorizations needed to register a device in the realm.","type":"string"}},"required":["jwt","realm"],"type":"object"},"title":"Realms","type":"array"},"interfaces":{"default":[],"items":{"$ref":"#/definitions/interface"},"title":"Interfaces","type":"array"}},"required":["pairing_url","realms","interfaces"],"title":"Dynamic Virtual Device Pool options","type":"object"},"type":"consumer"}')},622:function(e){e.exports=JSON.parse('{"beam_module":"Elixir.Astarte.Flow.Blocks.MapSplitter","name":"split_map","schema":{"$id":"https://astarte-platform.org/specs/astarte_flow/blocks/split_map.json","$schema":"http://json-schema.org/draft-04/schema#","additionalProperties":false,"description":"Breaks a map message into several messages, one for each map item.","properties":{"key_action":{"default":"replace","description":"The action to apply to the message key.","enum":["none","replace","append","prepend"],"title":"Key action","type":"string"},"delimiter":{"title":"Delimiter","type":"string"},"fallback_action":{"default":"pass_through","description":"The fallback action that is performed when a message does not have map type.","enum":["discard","replace_key","pass_through"],"title":"Fallback action","type":"string"},"fallback_key":{"title":"Fallback key","type":"string"}},"title":"Split Map options","type":"object"},"type":"producer_consumer"}')},623:function(e){e.exports=JSON.parse('{"beam_module":"Elixir.Astarte.Flow.Blocks.VirtualDevicePool","name":"virtual_device_pool","schema":{"$id":"https://astarte-platform.org/specs/astarte_flow/blocks/virtual_device_pool.json","$schema":"http://json-schema.org/draft-04/schema#","additionalProperties":false,"definitions":{"interface":{"$schema":"http://json-schema.org/draft-04/schema","title":"Astarte Interface Schema","description":"This schema describes how an Astarte interface should be declared","type":"object","properties":{"interface_name":{"type":"string","pattern":"^([a-zA-Z][a-zA-Z0-9]*.([a-zA-Z0-9][a-zA-Z0-9-]*.)*)?[a-zA-Z][a-zA-Z0-9]*$","minLength":1,"maxLength":128,"description":"The name of the interface. This has to be an unique, alphanumeric reverse internet domain name, shorther than 128 characters."},"version_major":{"type":"integer","description":"A Major version qualifier for this interface. Interfaces with the same id and different version_major number are deemed incompatible. It is then acceptable to redefine any property of the interface when changing the major version number."},"version_minor":{"type":"integer","description":"A Minor version qualifier for this interface. Interfaces with the same id and major version number and different version_minor number are deemed compatible between each other. When changing the minor number, it is then only possible to insert further mappings. Any other modification might lead to incompatibilities and undefined behavior."},"type":{"type":"string","enum":["datastream","properties"],"description":"Identifies the type of this Interface. Currently two types are supported: datastream and properties. datastream should be used when dealing with streams of non-persistent data, where a single path receives updates and there\'s no concept of state. properties, instead, are meant to be an actual state and as such they have only a change history, and are retained."},"ownership":{"type":"string","enum":["device","server"],"description":"Identifies the ownership of the interface. Interfaces are meant to be unidirectional, and this property defines who\'s sending or receiving data. device means the device/gateway is sending data to Astarte, server means the device/gateway is receiving data from Astarte. Bidirectional mode is not supported, you should instantiate another interface for that."},"aggregation":{"type":"string","enum":["individual","object"],"default":"individual","description":"Identifies the aggregation of the mappings of the interface. Individual means every mapping changes state or streams data independently, whereas an object aggregation treats the interface as an object, making all the mappings changes interdependent. Choosing the right aggregation might drastically improve performances."},"description":{"type":"string","description":"An optional description of the interface."},"doc":{"type":"string","description":"A string containing documentation that will be injected in the generated client code."},"mappings":{"type":"array","description":"Mappings define the endpoint of the interface, where actual data is stored/streamed. They are defined as relative URLs (e.g. /my/path) and can be parametrized (e.g.: /%{myparam}/path). A valid interface must have no mappings clash, which means that every mapping must resolve to a unique path or collection of paths (including parametrization). Every mapping acquires type, quality and aggregation of the interface.","items":{"$ref":"#/definitions/mapping"},"minItems":1,"maxItems":1024,"uniqueItems":true}},"required":["interface_name","version_minor","version_major","type","ownership","mappings"]},"mapping":{"$schema":"http://json-schema.org/draft-04/schema","title":"Astarte Mapping Schema","type":"object","description":"Identifies a mapping for an interface. A mapping must consist at least of an endpoint and a type.","properties":{"endpoint":{"type":"string","pattern":"^(/(%{([a-zA-Z][a-zA-Z0-9_]*)}|[a-zA-Z][a-zA-Z0-9_]*)){1,64}$","minLength":2,"maxLength":256,"description":"The template of the path. This is a UNIX-like path (e.g. /my/path) and can be parametrized. Parameters are in the %{name} form, and can be used to create interfaces which represent dictionaries of mappings. When the interface aggregation is object, an object is composed by all the mappings for one specific parameter combination. /timestamp is a reserved path for timestamps, so every mapping on a datastream must not have any endpoint that ends with /timestamp."},"type":{"type":"string","enum":["double","integer","boolean","longinteger","string","binaryblob","datetime","doublearray","integerarray","booleanarray","longintegerarray","stringarray","binaryblobarray","datetimearray"],"description":"Defines the type of the mapping."},"reliability":{"type":"string","enum":["unreliable","guaranteed","unique"],"default":"unreliable","description":"Useful only with datastream. Defines whether the sent data should be considered delivered when the transport successfully sends the data (unreliable), when we know that the data has been received at least once (guaranteed) or when we know that the data has been received exactly once (unique). unreliable by default. When using reliable data, consider you might incur in additional resource usage on both the transport and the device\'s end."},"retention":{"type":"string","enum":["discard","volatile","stored"],"default":"discard","description":"Useful only with datastream. Defines whether the sent data should be discarded if the transport is temporarily uncapable of delivering it (discard) or should be kept in a cache in memory (volatile) or on disk (stored), and guaranteed to be delivered in the timeframe defined by the expiry. discard by default."},"expiry":{"type":"integer","default":0,"minimum":0,"description":"Useful when retention is stored. Defines after how many seconds a specific data entry should be kept before giving up and erasing it from the persistent cache. A value <= 0 means the persistent cache never expires, and is the default."},"database_retention_policy":{"type":"string","enum":["no_ttl","use_ttl"],"default":"no_ttl","description":"Useful only with datastream. Defines whether data should expire from the database after a given interval. Valid values are: no_ttl and use_ttl."},"database_retention_ttl":{"type":"integer","minimum":60,"maximum":630719999,"description":"Useful when database_retention_policy is use_ttl. Defines how many seconds a specific data entry should be kept before erasing it from the database."},"allow_unset":{"type":"boolean","default":false,"description":"Used only with properties. Used with producers, it generates a method to unset the property. Used with consumers, it generates code to call an unset method when an empty payload is received."},"explicit_timestamp":{"type":"boolean","default":false,"description":"Allow to set a custom timestamp, otherwise a timestamp is added when the message is received. If true explicit timestamp will also be used for sorting. This feature is only supported on datastreams."},"description":{"type":"string","description":"An optional description of the mapping."},"doc":{"type":"string","description":"A string containing documentation that will be injected in the generated client code."}},"required":["endpoint","type"]}},"description":"This is a consumer block that takes `data` from incoming `Message`s and publishes it as an Astarte device.","properties":{"pairing_url":{"description":"Base URL of the Astarte Pairing API instance the devices will connect to. URL containing the API version suffix (i.e. `/v1`) are *deprecated* and will be removed in a future release.","title":"Pairing URL","type":"string"},"target_devices":{"description":"A list of supported devices.","items":{"additionalProperties":false,"properties":{"credentials_secret":{"title":"Credentials secret","type":"string"},"device_id":{"title":"Device ID","type":"string"},"interfaces":{"type":"array","title":"Interfaces","items":{"$ref":"#/definitions/interface"},"default":[]},"realm":{"title":"Realm","type":"string"}},"required":["credentials_secret","device_id","interfaces","realm"],"type":"object"},"title":"Target devices","type":"array"}},"required":["pairing_url","target_devices"],"title":"Virtual Device Pool options","type":"object"},"type":"consumer"}')},650:function(e,t,n){},675:function(e,t){},677:function(e,t){},691:function(e,t){},693:function(e,t){},721:function(e,t){},723:function(e,t){},724:function(e,t){},729:function(e,t){},731:function(e,t){},737:function(e,t){},739:function(e,t){},758:function(e,t){},770:function(e,t){},773:function(e,t){}},[[1425,1,2]]]);
//# sourceMappingURL=main.87ccc6eb.chunk.js.map